const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-jqVnxm8M.js","assets/index-DLOrLzsJ.js","assets/index-CaqMH8MR.css"])))=>i.map(i=>d[i]);
import{e as hu,j as G,i as Qt,h as lu,f as mo,k as q0,V as Kc,M as j0,K as z0,A as L0,q as Ol,x as B0,H as M0,F as U0,m as $l,$ as H0,t as k0,N as B,p as sr,o as V0,r as K0,J as G0,u as Xn,s as Cl,X as W0,v as J0,E as fu,w as Gf,I as Q0,y as Rl,z as un,B as Ve,U as at,C as ri,D as Et,G as Y0,L as hn,O as Wf,P as Z0,Q as Jf,R as X0,S as ii,T as eb,W as tb,Y as Qf,Z as Yf,a0 as fn,a1 as Gc,a2 as $o,a3 as pn,a4 as rb,a5 as ib,a6 as Co,a7 as nb,a8 as sb,a9 as ob,aa as ab,ab as wo,ac as cb,ad as ub,ae as Ec,af as Tl,ag as hb,ah as lb,ai as fb,aj as Nl,ak as pb,al as db,am as gb,an as yb,ao as vb,ap as mb,aq as wb,ar as Qn,as as Zf,at as Ic,au as bb,av as _b,_ as Eb}from"./index-DLOrLzsJ.js";import{s as jo,a as is,r as Xf,f as xi,g as pu,i as or,b as ns,c as Fl,d as Ib,e as Pb,h as du,p as xb,j as gu,k as zo,l as ti,m as Sb,n as oi}from"./index.es-but6IOId.js";function Ab(s,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const o in n)if(o!=="default"&&!(o in s)){const c=Object.getOwnPropertyDescriptor(n,o);c&&Object.defineProperty(s,o,c.get?c:{enumerable:!0,get:()=>n[o]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}const Ob=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,$b=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Cb=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Rb(s,t){if(s==="__proto__"||s==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Tb(s);return}return t}function Tb(s){console.warn(`[destr] Dropping "${s}" key to prevent prototype pollution.`)}function bo(s,t={}){if(typeof s!="string")return s;if(s[0]==='"'&&s[s.length-1]==='"'&&s.indexOf("\\")===-1)return s.slice(1,-1);const r=s.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Cb.test(s)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return s}try{if(Ob.test(s)||$b.test(s)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(s,Rb)}return JSON.parse(s)}catch(n){if(t.strict)throw n;return s}}function Nb(s){return!s||typeof s.then!="function"?Promise.resolve(s):s}function Ye(s,...t){try{return Nb(s(...t))}catch(r){return Promise.reject(r)}}function Fb(s){const t=typeof s;return s===null||t!=="object"&&t!=="function"}function Db(s){const t=Object.getPrototypeOf(s);return!t||t.isPrototypeOf(Object)}function Ro(s){if(Fb(s))return String(s);if(Db(s)||Array.isArray(s))return JSON.stringify(s);if(typeof s.toJSON=="function")return Ro(s.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Wc="base64:";function qb(s){return typeof s=="string"?s:Wc+Lb(s)}function jb(s){return typeof s!="string"||!s.startsWith(Wc)?s:zb(s.slice(Wc.length))}function zb(s){return globalThis.Buffer?Buffer.from(s,"base64"):Uint8Array.from(globalThis.atob(s),t=>t.codePointAt(0))}function Lb(s){return globalThis.Buffer?Buffer.from(s).toString("base64"):globalThis.btoa(String.fromCodePoint(...s))}function _t(s){var t;return s&&((t=s.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Bb(...s){return _t(s.join(":"))}function _o(s){return s=_t(s),s?s+":":""}function Mb(s,t){if(t===void 0)return!0;let r=0,n=s.indexOf(":");for(;n>-1;)r++,n=s.indexOf(":",n+1);return r<=t}function Ub(s,t){return t?s.startsWith(t)&&s[s.length-1]!=="$":s[s.length-1]!=="$"}const Hb="memory",kb=()=>{const s=new Map;return{name:Hb,getInstance:()=>s,hasItem(t){return s.has(t)},getItem(t){return s.get(t)??null},getItemRaw(t){return s.get(t)??null},setItem(t,r){s.set(t,r)},setItemRaw(t,r){s.set(t,r)},removeItem(t){s.delete(t)},getKeys(){return[...s.keys()]},clear(){s.clear()},dispose(){s.clear()}}};function Vb(s={}){const t={mounts:{"":s.driver||kb()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const v of t.mountpoints)if(g.startsWith(v))return{base:v,relativeKey:g.slice(v.length),driver:t.mounts[v]};return{base:"",relativeKey:g,driver:t.mounts[""]}},n=(g,v)=>t.mountpoints.filter(b=>b.startsWith(g)||v&&g.startsWith(b)).map(b=>({relativeBase:g.length>b.length?g.slice(b.length):void 0,mountpoint:b,driver:t.mounts[b]})),o=(g,v)=>{if(t.watching){v=_t(v);for(const b of t.watchListeners)b(g,v)}},c=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await Dl(t.mounts[g],o,g)}},h=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},p=(g,v,b)=>{const E=new Map,A=S=>{let D=E.get(S.base);return D||(D={driver:S.driver,base:S.base,items:[]},E.set(S.base,D)),D};for(const S of g){const D=typeof S=="string",k=_t(D?S:S.key),U=D?void 0:S.value,J=D||!S.options?v:{...v,...S.options},N=r(k);A(N).items.push({key:k,value:U,relativeKey:N.relativeKey,options:J})}return Promise.all([...E.values()].map(S=>b(S))).then(S=>S.flat())},f={hasItem(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return Ye(E.hasItem,b,v)},getItem(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return Ye(E.getItem,b,v).then(A=>bo(A))},getItems(g,v={}){return p(g,v,b=>b.driver.getItems?Ye(b.driver.getItems,b.items.map(E=>({key:E.relativeKey,options:E.options})),v).then(E=>E.map(A=>({key:Bb(b.base,A.key),value:bo(A.value)}))):Promise.all(b.items.map(E=>Ye(b.driver.getItem,E.relativeKey,E.options).then(A=>({key:E.key,value:bo(A)})))))},getItemRaw(g,v={}){g=_t(g);const{relativeKey:b,driver:E}=r(g);return E.getItemRaw?Ye(E.getItemRaw,b,v):Ye(E.getItem,b,v).then(A=>jb(A))},async setItem(g,v,b={}){if(v===void 0)return f.removeItem(g);g=_t(g);const{relativeKey:E,driver:A}=r(g);A.setItem&&(await Ye(A.setItem,E,Ro(v),b),A.watch||o("update",g))},async setItems(g,v){await p(g,v,async b=>{if(b.driver.setItems)return Ye(b.driver.setItems,b.items.map(E=>({key:E.relativeKey,value:Ro(E.value),options:E.options})),v);b.driver.setItem&&await Promise.all(b.items.map(E=>Ye(b.driver.setItem,E.relativeKey,Ro(E.value),E.options)))})},async setItemRaw(g,v,b={}){if(v===void 0)return f.removeItem(g,b);g=_t(g);const{relativeKey:E,driver:A}=r(g);if(A.setItemRaw)await Ye(A.setItemRaw,E,v,b);else if(A.setItem)await Ye(A.setItem,E,qb(v),b);else return;A.watch||o("update",g)},async removeItem(g,v={}){typeof v=="boolean"&&(v={removeMeta:v}),g=_t(g);const{relativeKey:b,driver:E}=r(g);E.removeItem&&(await Ye(E.removeItem,b,v),(v.removeMeta||v.removeMata)&&await Ye(E.removeItem,b+"$",v),E.watch||o("remove",g))},async getMeta(g,v={}){typeof v=="boolean"&&(v={nativeOnly:v}),g=_t(g);const{relativeKey:b,driver:E}=r(g),A=Object.create(null);if(E.getMeta&&Object.assign(A,await Ye(E.getMeta,b,v)),!v.nativeOnly){const S=await Ye(E.getItem,b+"$",v).then(D=>bo(D));S&&typeof S=="object"&&(typeof S.atime=="string"&&(S.atime=new Date(S.atime)),typeof S.mtime=="string"&&(S.mtime=new Date(S.mtime)),Object.assign(A,S))}return A},setMeta(g,v,b={}){return this.setItem(g+"$",v,b)},removeMeta(g,v={}){return this.removeItem(g+"$",v)},async getKeys(g,v={}){var k;g=_o(g);const b=n(g,!0);let E=[];const A=[];let S=!0;for(const U of b){(k=U.driver.flags)!=null&&k.maxDepth||(S=!1);const J=await Ye(U.driver.getKeys,U.relativeBase,v);for(const N of J){const z=U.mountpoint+_t(N);E.some(Q=>z.startsWith(Q))||A.push(z)}E=[U.mountpoint,...E.filter(N=>!N.startsWith(U.mountpoint))]}const D=v.maxDepth!==void 0&&!S;return A.filter(U=>(!D||Mb(U,v.maxDepth))&&Ub(U,g))},async clear(g,v={}){g=_o(g),await Promise.all(n(g,!1).map(async b=>{if(b.driver.clear)return Ye(b.driver.clear,b.relativeBase,v);if(b.driver.removeItem){const E=await b.driver.getKeys(b.relativeBase||"",v);return Promise.all(E.map(A=>b.driver.removeItem(A,v)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>ql(g)))},async watch(g){return await c(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(v=>v!==g),t.watchListeners.length===0&&await h()}},async unwatch(){t.watchListeners=[],await h()},mount(g,v){if(g=_o(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((b,E)=>E.length-b.length)),t.mounts[g]=v,t.watching&&Promise.resolve(Dl(v,o,g)).then(b=>{t.unwatch[g]=b}).catch(console.error),f},async unmount(g,v=!0){var b,E;g=_o(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&((E=(b=t.unwatch)[g])==null||E.call(b),delete t.unwatch[g]),v&&await ql(t.mounts[g]),t.mountpoints=t.mountpoints.filter(A=>A!==g),delete t.mounts[g])},getMount(g=""){g=_t(g)+":";const v=r(g);return{driver:v.driver,base:v.base}},getMounts(g="",v={}){return g=_t(g),n(g,v.parents).map(E=>({driver:E.driver,base:E.mountpoint}))},keys:(g,v={})=>f.getKeys(g,v),get:(g,v={})=>f.getItem(g,v),set:(g,v,b={})=>f.setItem(g,v,b),has:(g,v={})=>f.hasItem(g,v),del:(g,v={})=>f.removeItem(g,v),remove:(g,v={})=>f.removeItem(g,v)};return f}function Dl(s,t,r){return s.watch?s.watch((n,o)=>t(n,r+o)):()=>{}}async function ql(s){typeof s.dispose=="function"&&await Ye(s.dispose)}function Si(s){return new Promise((t,r)=>{s.oncomplete=s.onsuccess=()=>t(s.result),s.onabort=s.onerror=()=>r(s.error)})}function ep(s,t){let r;const n=()=>{if(r)return r;const o=indexedDB.open(s);return o.onupgradeneeded=()=>o.result.createObjectStore(t),r=Si(o),r.then(c=>{c.onclose=()=>r=void 0},()=>{}),r};return(o,c)=>n().then(h=>c(h.transaction(t,o).objectStore(t)))}let Pc;function ss(){return Pc||(Pc=ep("keyval-store","keyval")),Pc}function jl(s,t=ss()){return t("readonly",r=>Si(r.get(s)))}function Kb(s,t,r=ss()){return r("readwrite",n=>(n.put(t,s),Si(n.transaction)))}function Gb(s,t=ss()){return t("readwrite",r=>(r.delete(s),Si(r.transaction)))}function Wb(s=ss()){return s("readwrite",t=>(t.clear(),Si(t.transaction)))}function Jb(s,t){return s.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Si(s.transaction)}function Qb(s=ss()){return s("readonly",t=>{if(t.getAllKeys)return Si(t.getAllKeys());const r=[];return Jb(t,n=>r.push(n.key)).then(()=>r)})}const Yb="idb-keyval";var Zb=(s={})=>{const t=s.base&&s.base.length>0?`${s.base}:`:"",r=o=>t+o;let n;return s.dbName&&s.storeName&&(n=ep(s.dbName,s.storeName)),{name:Yb,options:s,async hasItem(o){return!(typeof await jl(r(o),n)>"u")},async getItem(o){return await jl(r(o),n)??null},setItem(o,c){return Kb(r(o),c,n)},removeItem(o){return Gb(r(o),n)},getKeys(){return Qb(n)},clear(){return Wb(n)}}};const Xb="WALLET_CONNECT_V2_INDEXED_DB",e1="keyvaluestorage";let t1=class{constructor(){this.indexedDb=Vb({driver:Zb({dbName:Xb,storeName:e1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,is(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var xc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},To={exports:{}};(function(){let s;function t(){}s=t,s.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},s.prototype.setItem=function(r,n){this[r]=String(n)},s.prototype.removeItem=function(r){delete this[r]},s.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},s.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},s.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof xc<"u"&&xc.localStorage?To.exports=xc.localStorage:typeof window<"u"&&window.localStorage?To.exports=window.localStorage:To.exports=new t})();function r1(s){var t;return[s[0],jo((t=s[1])!=null?t:"")]}let i1=class{constructor(){this.localStorage=To.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(r1)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return jo(r)}async setItem(t,r){this.localStorage.setItem(t,is(r))}async removeItem(t){this.localStorage.removeItem(t)}};const n1="wc_storage_version",zl=1,s1=async(s,t,r)=>{const n=n1,o=await t.getItem(n);if(o&&o>=zl){r(t);return}const c=await s.getKeys();if(!c.length){r(t);return}const h=[];for(;c.length;){const p=c.shift();if(!p)continue;const f=p.toLowerCase();if(f.includes("wc@")||f.includes("walletconnect")||f.includes("wc_")||f.includes("wallet_connect")){const g=await s.getItem(p);await t.setItem(p,g),h.push(p)}}await t.setItem(n,zl),r(t),o1(s,h)},o1=async(s,t)=>{t.length&&t.forEach(async r=>{await s.removeItem(r)})};let a1=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new i1;this.storage=t;try{const r=new t1;s1(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var dn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Jc=function(s,t){return Jc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},Jc(s,t)};function c1(s,t){Jc(s,t);function r(){this.constructor=s}s.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Qc=function(){return Qc=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(t[c]=r[c])}return t},Qc.apply(this,arguments)};function u1(s,t){var r={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(r[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(s);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(s,n[o])&&(r[n[o]]=s[n[o]]);return r}function h1(s,t,r,n){var o=arguments.length,c=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(s,t,r,n);else for(var p=s.length-1;p>=0;p--)(h=s[p])&&(c=(o<3?h(c):o>3?h(t,r,c):h(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c}function l1(s,t){return function(r,n){t(r,n,s)}}function f1(s,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,t)}function p1(s,t,r,n){function o(c){return c instanceof r?c:new r(function(h){h(c)})}return new(r||(r=Promise))(function(c,h){function p(v){try{g(n.next(v))}catch(b){h(b)}}function f(v){try{g(n.throw(v))}catch(b){h(b)}}function g(v){v.done?c(v.value):o(v.value).then(p,f)}g((n=n.apply(s,t||[])).next())})}function d1(s,t){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,o,c,h;return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(g){return function(v){return f([g,v])}}function f(g){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(c=g[0]&2?o.return:g[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,g[1])).done)return c;switch(o=0,c&&(g=[g[0]&2,c.value]),g[0]){case 0:case 1:c=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,o=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!c||g[1]>c[0]&&g[1]<c[3])){r.label=g[1];break}if(g[0]===6&&r.label<c[1]){r.label=c[1],c=g;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(g);break}c[2]&&r.ops.pop(),r.trys.pop();continue}g=t.call(s,r)}catch(v){g=[6,v],o=0}finally{n=c=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function g1(s,t,r,n){n===void 0&&(n=r),s[n]=t[r]}function y1(s,t){for(var r in s)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=s[r])}function Yc(s){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&s[t],n=0;if(r)return r.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tp(s,t){var r=typeof Symbol=="function"&&s[Symbol.iterator];if(!r)return s;var n=r.call(s),o,c=[],h;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)c.push(o.value)}catch(p){h={error:p}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(h)throw h.error}}return c}function v1(){for(var s=[],t=0;t<arguments.length;t++)s=s.concat(tp(arguments[t]));return s}function m1(){for(var s=0,t=0,r=arguments.length;t<r;t++)s+=arguments[t].length;for(var n=Array(s),o=0,t=0;t<r;t++)for(var c=arguments[t],h=0,p=c.length;h<p;h++,o++)n[o]=c[h];return n}function es(s){return this instanceof es?(this.v=s,this):new es(s)}function w1(s,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(s,t||[]),o,c=[];return o={},h("next"),h("throw"),h("return"),o[Symbol.asyncIterator]=function(){return this},o;function h(E){n[E]&&(o[E]=function(A){return new Promise(function(S,D){c.push([E,A,S,D])>1||p(E,A)})})}function p(E,A){try{f(n[E](A))}catch(S){b(c[0][3],S)}}function f(E){E.value instanceof es?Promise.resolve(E.value.v).then(g,v):b(c[0][2],E)}function g(E){p("next",E)}function v(E){p("throw",E)}function b(E,A){E(A),c.shift(),c.length&&p(c[0][0],c[0][1])}}function b1(s){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,c){t[o]=s[o]?function(h){return(r=!r)?{value:es(s[o](h)),done:o==="return"}:c?c(h):h}:c}}function _1(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=s[Symbol.asyncIterator],r;return t?t.call(s):(s=typeof Yc=="function"?Yc(s):s[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(c){r[c]=s[c]&&function(h){return new Promise(function(p,f){h=s[c](h),o(p,f,h.done,h.value)})}}function o(c,h,p,f){Promise.resolve(f).then(function(g){c({value:g,done:p})},h)}}function E1(s,t){return Object.defineProperty?Object.defineProperty(s,"raw",{value:t}):s.raw=t,s}function I1(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var r in s)Object.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t.default=s,t}function P1(s){return s&&s.__esModule?s:{default:s}}function x1(s,t){if(!t.has(s))throw new TypeError("attempted to get private field on non-instance");return t.get(s)}function S1(s,t,r){if(!t.has(s))throw new TypeError("attempted to set private field on non-instance");return t.set(s,r),r}const A1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Qc},__asyncDelegator:b1,__asyncGenerator:w1,__asyncValues:_1,__await:es,__awaiter:p1,__classPrivateFieldGet:x1,__classPrivateFieldSet:S1,__createBinding:g1,__decorate:h1,__exportStar:y1,__extends:c1,__generator:d1,__importDefault:P1,__importStar:I1,__makeTemplateObject:E1,__metadata:f1,__param:l1,__read:tp,__rest:u1,__spread:v1,__spreadArrays:m1,__values:Yc},Symbol.toStringTag,{value:"Module"})),Lo=hu(A1);var Un={},Sc={},Hn={};class Ai{}const O1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ai},Symbol.toStringTag,{value:"Module"})),$1=hu(O1);var Ll;function C1(){if(Ll)return Hn;Ll=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.IHeartBeat=void 0;const s=$1;class t extends s.IEvents{constructor(n){super()}}return Hn.IHeartBeat=t,Hn}var Bl;function rp(){return Bl||(Bl=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Lo.__exportStar(C1(),s)}(Sc)),Sc}var Ac={},Ii={},Ml;function R1(){if(Ml)return Ii;Ml=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.HEARTBEAT_EVENTS=Ii.HEARTBEAT_INTERVAL=void 0;const s=G;return Ii.HEARTBEAT_INTERVAL=s.FIVE_SECONDS,Ii.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ii}var Ul;function ip(){return Ul||(Ul=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),Lo.__exportStar(R1(),s)}(Ac)),Ac}var Hl;function T1(){if(Hl)return Un;Hl=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.HeartBeat=void 0;const s=Lo,t=Qt,r=G,n=rp(),o=ip();class c extends n.IHeartBeat{constructor(p){super(p),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(p==null?void 0:p.interval)||o.HEARTBEAT_INTERVAL}static init(p){return s.__awaiter(this,void 0,void 0,function*(){const f=new c(p);return yield f.init(),f})}init(){return s.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(p,f){this.events.on(p,f)}once(p,f){this.events.once(p,f)}off(p,f){this.events.off(p,f)}removeListener(p,f){this.events.removeListener(p,f)}initialize(){return s.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Un.HeartBeat=c,Un}(function(s){Object.defineProperty(s,"__esModule",{value:!0});const t=Lo;t.__exportStar(T1(),s),t.__exportStar(rp(),s),t.__exportStar(ip(),s)})(dn);function N1(s){try{return JSON.stringify(s)}catch{return'"[Circular]"'}}var F1=D1;function D1(s,t,r){var n=r&&r.stringify||N1,o=1;if(typeof s=="object"&&s!==null){var c=t.length+o;if(c===1)return s;var h=new Array(c);h[0]=n(s);for(var p=1;p<c;p++)h[p]=n(t[p]);return h.join(" ")}if(typeof s!="string")return s;var f=t.length;if(f===0)return s;for(var g="",v=1-o,b=-1,E=s&&s.length||0,A=0;A<E;){if(s.charCodeAt(A)===37&&A+1<E){switch(b=b>-1?b:0,s.charCodeAt(A+1)){case 100:case 102:if(v>=f||t[v]==null)break;b<A&&(g+=s.slice(b,A)),g+=Number(t[v]),b=A+2,A++;break;case 105:if(v>=f||t[v]==null)break;b<A&&(g+=s.slice(b,A)),g+=Math.floor(Number(t[v])),b=A+2,A++;break;case 79:case 111:case 106:if(v>=f||t[v]===void 0)break;b<A&&(g+=s.slice(b,A));var S=typeof t[v];if(S==="string"){g+="'"+t[v]+"'",b=A+2,A++;break}if(S==="function"){g+=t[v].name||"<anonymous>",b=A+2,A++;break}g+=n(t[v]),b=A+2,A++;break;case 115:if(v>=f)break;b<A&&(g+=s.slice(b,A)),g+=String(t[v]),b=A+2,A++;break;case 37:b<A&&(g+=s.slice(b,A)),g+="%",b=A+2,A++,v--;break}++v}++A}return b===-1?s:(b<E&&(g+=s.slice(b)),g)}const kl=F1;var np=vr;const ts=V1().console||{},q1={mapHttpRequest:Eo,mapHttpResponse:Eo,wrapRequestSerializer:Oc,wrapResponseSerializer:Oc,wrapErrorSerializer:Oc,req:Eo,res:Eo,err:M1};function j1(s,t){return Array.isArray(s)?s.filter(function(n){return n!=="!stdSerializers.err"}):s===!0?Object.keys(t):!1}function vr(s){s=s||{},s.browser=s.browser||{};const t=s.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=s.browser.write||ts;s.browser.write&&(s.browser.asObject=!0);const n=s.serializers||{},o=j1(s.browser.serialize,n);let c=s.browser.serialize;Array.isArray(s.browser.serialize)&&s.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const h=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),s.enabled===!1&&(s.level="silent");const p=s.level||"info",f=Object.create(r);f.log||(f.log=rs),Object.defineProperty(f,"levelVal",{get:v}),Object.defineProperty(f,"level",{get:b,set:E});const g={transmit:t,serialize:o,asObject:s.browser.asObject,levels:h,timestamp:U1(s)};f.levels=vr.levels,f.level=p,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=rs,f.serializers=n,f._serialize=o,f._stdErrSerialize=c,f.child=A,t&&(f._logEvent=Zc());function v(){return this.level==="silent"?1/0:this.levels.values[this.level]}function b(){return this._level}function E(S){if(S!=="silent"&&!this.levels.values[S])throw Error("unknown level "+S);this._level=S,on(g,f,"error","log"),on(g,f,"fatal","error"),on(g,f,"warn","error"),on(g,f,"info","log"),on(g,f,"debug","log"),on(g,f,"trace","log")}function A(S,D){if(!S)throw new Error("missing bindings for child Pino");D=D||{},o&&S.serializers&&(D.serializers=S.serializers);const k=D.serializers;if(o&&k){var U=Object.assign({},n,k),J=s.browser.serialize===!0?Object.keys(U):o;delete S.serializers,Bo([S],J,U,this._stdErrSerialize)}function N(z){this._childLevel=(z._childLevel|0)+1,this.error=an(z,S,"error"),this.fatal=an(z,S,"fatal"),this.warn=an(z,S,"warn"),this.info=an(z,S,"info"),this.debug=an(z,S,"debug"),this.trace=an(z,S,"trace"),U&&(this.serializers=U,this._serialize=J),t&&(this._logEvent=Zc([].concat(z._logEvent.bindings,S)))}return N.prototype=this,new N(this)}return f}vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};vr.stdSerializers=q1;vr.stdTimeFunctions=Object.assign({},{nullTime:sp,epochTime:op,unixTime:H1,isoTime:k1});function on(s,t,r,n){const o=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?rs:o[r]?o[r]:ts[r]||ts[n]||rs,z1(s,t,r)}function z1(s,t,r){!s.transmit&&t[r]===rs||(t[r]=function(n){return function(){const c=s.timestamp(),h=new Array(arguments.length),p=Object.getPrototypeOf&&Object.getPrototypeOf(this)===ts?ts:this;for(var f=0;f<h.length;f++)h[f]=arguments[f];if(s.serialize&&!s.asObject&&Bo(h,this._serialize,this.serializers,this._stdErrSerialize),s.asObject?n.call(p,L1(this,r,h,c)):n.apply(p,h),s.transmit){const g=s.transmit.level||t.level,v=vr.levels.values[g],b=vr.levels.values[r];if(b<v)return;B1(this,{ts:c,methodLevel:r,methodValue:b,transmitValue:vr.levels.values[s.transmit.level||t.level],send:s.transmit.send,val:t.levelVal},h)}}}(t[r]))}function L1(s,t,r,n){s._serialize&&Bo(r,s._serialize,s.serializers,s._stdErrSerialize);const o=r.slice();let c=o[0];const h={};n&&(h.time=n),h.level=vr.levels.values[t];let p=(s._childLevel|0)+1;if(p<1&&(p=1),c!==null&&typeof c=="object"){for(;p--&&typeof o[0]=="object";)Object.assign(h,o.shift());c=o.length?kl(o.shift(),o):void 0}else typeof c=="string"&&(c=kl(o.shift(),o));return c!==void 0&&(h.msg=c),h}function Bo(s,t,r,n){for(const o in s)if(n&&s[o]instanceof Error)s[o]=vr.stdSerializers.err(s[o]);else if(typeof s[o]=="object"&&!Array.isArray(s[o]))for(const c in s[o])t&&t.indexOf(c)>-1&&c in r&&(s[o][c]=r[c](s[o][c]))}function an(s,t,r){return function(){const n=new Array(1+arguments.length);n[0]=t;for(var o=1;o<n.length;o++)n[o]=arguments[o-1];return s[r].apply(this,n)}}function B1(s,t,r){const n=t.send,o=t.ts,c=t.methodLevel,h=t.methodValue,p=t.val,f=s._logEvent.bindings;Bo(r,s._serialize||Object.keys(s.serializers),s.serializers,s._stdErrSerialize===void 0?!0:s._stdErrSerialize),s._logEvent.ts=o,s._logEvent.messages=r.filter(function(g){return f.indexOf(g)===-1}),s._logEvent.level.label=c,s._logEvent.level.value=h,n(c,s._logEvent,p),s._logEvent=Zc(f)}function Zc(s){return{ts:0,messages:[],bindings:s||[],level:{label:"",value:0}}}function M1(s){const t={type:s.constructor.name,msg:s.message,stack:s.stack};for(const r in s)t[r]===void 0&&(t[r]=s[r]);return t}function U1(s){return typeof s.timestamp=="function"?s.timestamp:s.timestamp===!1?sp:op}function Eo(){return{}}function Oc(s){return s}function rs(){}function sp(){return!1}function op(){return Date.now()}function H1(){return Math.round(Date.now()/1e3)}function k1(){return new Date(Date.now()).toISOString()}function V1(){function s(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return s(self)||s(window)||s(this)||{}}}const ap=lu(np),K1=Ab({__proto__:null,default:ap},[np]),G1={level:"info"},os="custom_context";var W1=Object.defineProperty,J1=Object.defineProperties,Q1=Object.getOwnPropertyDescriptors,Vl=Object.getOwnPropertySymbols,Y1=Object.prototype.hasOwnProperty,Z1=Object.prototype.propertyIsEnumerable,Kl=(s,t,r)=>t in s?W1(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,X1=(s,t)=>{for(var r in t||(t={}))Y1.call(t,r)&&Kl(s,r,t[r]);if(Vl)for(var r of Vl(t))Z1.call(t,r)&&Kl(s,r,t[r]);return s},e_=(s,t)=>J1(s,Q1(t));function Mo(s){return e_(X1({},s),{level:(s==null?void 0:s.level)||G1.level})}function t_(s,t=os){return s[t]||""}function r_(s,t,r=os){return s[r]=t,s}function It(s,t=os){let r="";return typeof s.bindings>"u"?r=t_(s,t):r=s.bindings().context||"",r}function i_(s,t,r=os){const n=It(s,r);return n.trim()?`${n}/${t}`:t}function Pt(s,t,r=os){const n=i_(s,t,r),o=s.child({context:n});return r_(o,n,r)}var Gl;const Uo=(Gl=ap)!=null?Gl:K1;class n_ extends Ai{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let s_=class extends Ai{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},o_=class{constructor(t,r){this.logger=t,this.core=r}},a_=class extends Ai{constructor(t,r){super(),this.relayer=t,this.logger=r}},c_=class extends Ai{constructor(t){super()}},u_=class{constructor(t,r,n,o){this.core=t,this.logger=r,this.name=n}};class h_ extends Ai{constructor(t,r){super(),this.relayer=t,this.logger=r}}let l_=class extends Ai{constructor(t,r){super(),this.core=t,this.logger=r}},f_=class{constructor(t,r){this.projectId=t,this.logger=r}},p_=class{constructor(t,r){this.projectId=t,this.logger=r}},d_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},g_=class{constructor(t){this.client=t}};function y_(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function cp(s,...t){if(!y_(s))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(s.length))throw new Error("Uint8Array expected of length "+t+", got length="+s.length)}function Wl(s,t=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(t&&s.finished)throw new Error("Hash#digest() has already been called")}function v_(s,t){cp(s);const r=t.outputLen;if(s.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const cn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $c=s=>new DataView(s.buffer,s.byteOffset,s.byteLength);function m_(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function up(s){return typeof s=="string"&&(s=m_(s)),cp(s),s}class w_{clone(){return this._cloneInto()}}function b_(s){const t=n=>s().update(up(n)).digest(),r=s();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>s(),t}function hp(s=32){if(cn&&typeof cn.getRandomValues=="function")return cn.getRandomValues(new Uint8Array(s));if(cn&&typeof cn.randomBytes=="function")return cn.randomBytes(s);throw new Error("crypto.getRandomValues must be defined")}function __(s,t,r,n){if(typeof s.setBigUint64=="function")return s.setBigUint64(t,r,n);const o=BigInt(32),c=BigInt(4294967295),h=Number(r>>o&c),p=Number(r&c),f=n?4:0,g=n?0:4;s.setUint32(t+f,h,n),s.setUint32(t+g,p,n)}class E_ extends w_{constructor(t,r,n,o){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=$c(this.buffer)}update(t){Wl(this);const{view:r,buffer:n,blockLen:o}=this;t=up(t);const c=t.length;for(let h=0;h<c;){const p=Math.min(o-this.pos,c-h);if(p===o){const f=$c(t);for(;o<=c-h;h+=o)this.process(f,h);continue}n.set(t.subarray(h,h+p),this.pos),this.pos+=p,h+=p,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Wl(this),v_(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:o,isLE:c}=this;let{pos:h}=this;r[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(n,0),h=0);for(let b=h;b<o;b++)r[b]=0;__(n,o-8,BigInt(this.length*8),c),this.process(n,0);const p=$c(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=f/4,v=this.get();if(g>v.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<g;b++)p.setUint32(4*b,v[b],c)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:o,finished:c,destroyed:h,pos:p}=this;return t.length=o,t.pos=p,t.finished=c,t.destroyed=h,o%r&&t.buffer.set(n),t}}const Io=BigInt(2**32-1),Xc=BigInt(32);function lp(s,t=!1){return t?{h:Number(s&Io),l:Number(s>>Xc&Io)}:{h:Number(s>>Xc&Io)|0,l:Number(s&Io)|0}}function I_(s,t=!1){let r=new Uint32Array(s.length),n=new Uint32Array(s.length);for(let o=0;o<s.length;o++){const{h:c,l:h}=lp(s[o],t);[r[o],n[o]]=[c,h]}return[r,n]}const P_=(s,t)=>BigInt(s>>>0)<<Xc|BigInt(t>>>0),x_=(s,t,r)=>s>>>r,S_=(s,t,r)=>s<<32-r|t>>>r,A_=(s,t,r)=>s>>>r|t<<32-r,O_=(s,t,r)=>s<<32-r|t>>>r,$_=(s,t,r)=>s<<64-r|t>>>r-32,C_=(s,t,r)=>s>>>r-32|t<<64-r,R_=(s,t)=>t,T_=(s,t)=>s,N_=(s,t,r)=>s<<r|t>>>32-r,F_=(s,t,r)=>t<<r|s>>>32-r,D_=(s,t,r)=>t<<r-32|s>>>64-r,q_=(s,t,r)=>s<<r-32|t>>>64-r;function j_(s,t,r,n){const o=(t>>>0)+(n>>>0);return{h:s+r+(o/2**32|0)|0,l:o|0}}const z_=(s,t,r)=>(s>>>0)+(t>>>0)+(r>>>0),L_=(s,t,r,n)=>t+r+n+(s/2**32|0)|0,B_=(s,t,r,n)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0),M_=(s,t,r,n,o)=>t+r+n+o+(s/2**32|0)|0,U_=(s,t,r,n,o)=>(s>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),H_=(s,t,r,n,o,c)=>t+r+n+o+c+(s/2**32|0)|0,ue={fromBig:lp,split:I_,toBig:P_,shrSH:x_,shrSL:S_,rotrSH:A_,rotrSL:O_,rotrBH:$_,rotrBL:C_,rotr32H:R_,rotr32L:T_,rotlSH:N_,rotlSL:F_,rotlBH:D_,rotlBL:q_,add:j_,add3L:z_,add3H:L_,add4L:B_,add4H:M_,add5H:H_,add5L:U_},[k_,V_]=ue.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))),Xr=new Uint32Array(80),ei=new Uint32Array(80);class K_ extends E_{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:r,Bh:n,Bl:o,Ch:c,Cl:h,Dh:p,Dl:f,Eh:g,El:v,Fh:b,Fl:E,Gh:A,Gl:S,Hh:D,Hl:k}=this;return[t,r,n,o,c,h,p,f,g,v,b,E,A,S,D,k]}set(t,r,n,o,c,h,p,f,g,v,b,E,A,S,D,k){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=c|0,this.Cl=h|0,this.Dh=p|0,this.Dl=f|0,this.Eh=g|0,this.El=v|0,this.Fh=b|0,this.Fl=E|0,this.Gh=A|0,this.Gl=S|0,this.Hh=D|0,this.Hl=k|0}process(t,r){for(let N=0;N<16;N++,r+=4)Xr[N]=t.getUint32(r),ei[N]=t.getUint32(r+=4);for(let N=16;N<80;N++){const z=Xr[N-15]|0,Q=ei[N-15]|0,fe=ue.rotrSH(z,Q,1)^ue.rotrSH(z,Q,8)^ue.shrSH(z,Q,7),re=ue.rotrSL(z,Q,1)^ue.rotrSL(z,Q,8)^ue.shrSL(z,Q,7),oe=Xr[N-2]|0,we=ei[N-2]|0,qt=ue.rotrSH(oe,we,19)^ue.rotrBH(oe,we,61)^ue.shrSH(oe,we,6),jt=ue.rotrSL(oe,we,19)^ue.rotrBL(oe,we,61)^ue.shrSL(oe,we,6),xt=ue.add4L(re,jt,ei[N-7],ei[N-16]),mr=ue.add4H(xt,fe,qt,Xr[N-7],Xr[N-16]);Xr[N]=mr|0,ei[N]=xt|0}let{Ah:n,Al:o,Bh:c,Bl:h,Ch:p,Cl:f,Dh:g,Dl:v,Eh:b,El:E,Fh:A,Fl:S,Gh:D,Gl:k,Hh:U,Hl:J}=this;for(let N=0;N<80;N++){const z=ue.rotrSH(b,E,14)^ue.rotrSH(b,E,18)^ue.rotrBH(b,E,41),Q=ue.rotrSL(b,E,14)^ue.rotrSL(b,E,18)^ue.rotrBL(b,E,41),fe=b&A^~b&D,re=E&S^~E&k,oe=ue.add5L(J,Q,re,V_[N],ei[N]),we=ue.add5H(oe,U,z,fe,k_[N],Xr[N]),qt=oe|0,jt=ue.rotrSH(n,o,28)^ue.rotrBH(n,o,34)^ue.rotrBH(n,o,39),xt=ue.rotrSL(n,o,28)^ue.rotrBL(n,o,34)^ue.rotrBL(n,o,39),mr=n&c^n&p^c&p,Lr=o&h^o&f^h&f;U=D|0,J=k|0,D=A|0,k=S|0,A=b|0,S=E|0,{h:b,l:E}=ue.add(g|0,v|0,we|0,qt|0),g=p|0,v=f|0,p=c|0,f=h|0,c=n|0,h=o|0;const ee=ue.add3L(qt,xt,Lr);n=ue.add3H(ee,we,jt,mr),o=ee|0}({h:n,l:o}=ue.add(this.Ah|0,this.Al|0,n|0,o|0)),{h:c,l:h}=ue.add(this.Bh|0,this.Bl|0,c|0,h|0),{h:p,l:f}=ue.add(this.Ch|0,this.Cl|0,p|0,f|0),{h:g,l:v}=ue.add(this.Dh|0,this.Dl|0,g|0,v|0),{h:b,l:E}=ue.add(this.Eh|0,this.El|0,b|0,E|0),{h:A,l:S}=ue.add(this.Fh|0,this.Fl|0,A|0,S|0),{h:D,l:k}=ue.add(this.Gh|0,this.Gl|0,D|0,k|0),{h:U,l:J}=ue.add(this.Hh|0,this.Hl|0,U|0,J|0),this.set(n,o,c,h,p,f,g,v,b,E,A,S,D,k,U,J)}roundClean(){Xr.fill(0),ei.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const G_=b_(()=>new K_);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yu=BigInt(0),fp=BigInt(1),W_=BigInt(2);function vu(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function mu(s){if(!vu(s))throw new Error("Uint8Array expected")}function Cc(s,t){if(typeof t!="boolean")throw new Error(s+" boolean expected, got "+t)}const J_=Array.from({length:256},(s,t)=>t.toString(16).padStart(2,"0"));function wu(s){mu(s);let t="";for(let r=0;r<s.length;r++)t+=J_[s[r]];return t}function pp(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);return s===""?yu:BigInt("0x"+s)}const Fr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jl(s){if(s>=Fr._0&&s<=Fr._9)return s-Fr._0;if(s>=Fr.A&&s<=Fr.F)return s-(Fr.A-10);if(s>=Fr.a&&s<=Fr.f)return s-(Fr.a-10)}function dp(s){if(typeof s!="string")throw new Error("hex string expected, got "+typeof s);const t=s.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let o=0,c=0;o<r;o++,c+=2){const h=Jl(s.charCodeAt(c)),p=Jl(s.charCodeAt(c+1));if(h===void 0||p===void 0){const f=s[c]+s[c+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+c)}n[o]=h*16+p}return n}function Q_(s){return pp(wu(s))}function No(s){return mu(s),pp(wu(Uint8Array.from(s).reverse()))}function gp(s,t){return dp(s.toString(16).padStart(t*2,"0"))}function eu(s,t){return gp(s,t).reverse()}function Dr(s,t,r){let n;if(typeof t=="string")try{n=dp(t)}catch(c){throw new Error(s+" must be hex string or Uint8Array, cause: "+c)}else if(vu(t))n=Uint8Array.from(t);else throw new Error(s+" must be hex string or Uint8Array");const o=n.length;if(typeof r=="number"&&o!==r)throw new Error(s+" of length "+r+" expected, got "+o);return n}function Ql(...s){let t=0;for(let n=0;n<s.length;n++){const o=s[n];mu(o),t+=o.length}const r=new Uint8Array(t);for(let n=0,o=0;n<s.length;n++){const c=s[n];r.set(c,o),o+=c.length}return r}const Rc=s=>typeof s=="bigint"&&yu<=s;function Y_(s,t,r){return Rc(s)&&Rc(t)&&Rc(r)&&t<=s&&s<r}function kn(s,t,r,n){if(!Y_(t,r,n))throw new Error("expected valid "+s+": "+r+" <= n < "+n+", got "+t)}function Z_(s){let t;for(t=0;s>yu;s>>=fp,t+=1);return t}const X_=s=>(W_<<BigInt(s-1))-fp,eE={bigint:s=>typeof s=="bigint",function:s=>typeof s=="function",boolean:s=>typeof s=="boolean",string:s=>typeof s=="string",stringOrUint8Array:s=>typeof s=="string"||vu(s),isSafeInteger:s=>Number.isSafeInteger(s),array:s=>Array.isArray(s),field:(s,t)=>t.Fp.isValid(s),hash:s=>typeof s=="function"&&Number.isSafeInteger(s.outputLen)};function bu(s,t,r={}){const n=(o,c,h)=>{const p=eE[c];if(typeof p!="function")throw new Error("invalid validator function");const f=s[o];if(!(h&&f===void 0)&&!p(f,s))throw new Error("param "+String(o)+" is invalid. Expected "+c+", got "+f)};for(const[o,c]of Object.entries(t))n(o,c,!1);for(const[o,c]of Object.entries(r))n(o,c,!0);return s}function Yl(s){const t=new WeakMap;return(r,...n)=>{const o=t.get(r);if(o!==void 0)return o;const c=s(r,...n);return t.set(r,c),c}}const Ze=BigInt(0),Ue=BigInt(1),Pi=BigInt(2),tE=BigInt(3),tu=BigInt(4),Zl=BigInt(5),Xl=BigInt(8);function We(s,t){const r=s%t;return r>=Ze?r:t+r}function rE(s,t,r){if(t<Ze)throw new Error("invalid exponent, negatives unsupported");if(r<=Ze)throw new Error("invalid modulus");if(r===Ue)return Ze;let n=Ue;for(;t>Ze;)t&Ue&&(n=n*s%r),s=s*s%r,t>>=Ue;return n}function gr(s,t,r){let n=s;for(;t-- >Ze;)n*=n,n%=r;return n}function ef(s,t){if(s===Ze)throw new Error("invert: expected non-zero number");if(t<=Ze)throw new Error("invert: expected positive modulus, got "+t);let r=We(s,t),n=t,o=Ze,c=Ue;for(;r!==Ze;){const h=n/r,p=n%r,f=o-c*h;n=r,r=p,o=c,c=f}if(n!==Ue)throw new Error("invert: does not exist");return We(o,t)}function iE(s){const t=(s-Ue)/Pi;let r,n,o;for(r=s-Ue,n=0;r%Pi===Ze;r/=Pi,n++);for(o=Pi;o<s&&rE(o,t,s)!==s-Ue;o++)if(o>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const h=(s+Ue)/tu;return function(p,f){const g=p.pow(f,h);if(!p.eql(p.sqr(g),f))throw new Error("Cannot find square root");return g}}const c=(r+Ue)/Pi;return function(h,p){if(h.pow(p,t)===h.neg(h.ONE))throw new Error("Cannot find square root");let f=n,g=h.pow(h.mul(h.ONE,o),r),v=h.pow(p,c),b=h.pow(p,r);for(;!h.eql(b,h.ONE);){if(h.eql(b,h.ZERO))return h.ZERO;let E=1;for(let S=h.sqr(b);E<f&&!h.eql(S,h.ONE);E++)S=h.sqr(S);const A=h.pow(g,Ue<<BigInt(f-E-1));g=h.sqr(A),v=h.mul(v,A),b=h.mul(b,g),f=E}return v}}function nE(s){if(s%tu===tE){const t=(s+Ue)/tu;return function(r,n){const o=r.pow(n,t);if(!r.eql(r.sqr(o),n))throw new Error("Cannot find square root");return o}}if(s%Xl===Zl){const t=(s-Zl)/Xl;return function(r,n){const o=r.mul(n,Pi),c=r.pow(o,t),h=r.mul(n,c),p=r.mul(r.mul(h,Pi),c),f=r.mul(h,r.sub(p,r.ONE));if(!r.eql(r.sqr(f),n))throw new Error("Cannot find square root");return f}}return iE(s)}const sE=(s,t)=>(We(s,t)&Ue)===Ue,oE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function aE(s){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=oE.reduce((n,o)=>(n[o]="function",n),t);return bu(s,r)}function cE(s,t,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return s.ONE;if(r===Ue)return t;let n=s.ONE,o=t;for(;r>Ze;)r&Ue&&(n=s.mul(n,o)),o=s.sqr(o),r>>=Ue;return n}function uE(s,t){const r=new Array(t.length),n=t.reduce((c,h,p)=>s.is0(h)?c:(r[p]=c,s.mul(c,h)),s.ONE),o=s.inv(n);return t.reduceRight((c,h,p)=>s.is0(h)?c:(r[p]=s.mul(c,r[p]),s.mul(c,h)),o),r}function yp(s,t){const r=t!==void 0?t:s.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function vp(s,t,r=!1,n={}){if(s<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+s);const{nBitLength:o,nByteLength:c}=yp(s,t);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h;const p=Object.freeze({ORDER:s,isLE:r,BITS:o,BYTES:c,MASK:X_(o),ZERO:Ze,ONE:Ue,create:f=>We(f,s),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ze<=f&&f<s},is0:f=>f===Ze,isOdd:f=>(f&Ue)===Ue,neg:f=>We(-f,s),eql:(f,g)=>f===g,sqr:f=>We(f*f,s),add:(f,g)=>We(f+g,s),sub:(f,g)=>We(f-g,s),mul:(f,g)=>We(f*g,s),pow:(f,g)=>cE(p,f,g),div:(f,g)=>We(f*ef(g,s),s),sqrN:f=>f*f,addN:(f,g)=>f+g,subN:(f,g)=>f-g,mulN:(f,g)=>f*g,inv:f=>ef(f,s),sqrt:n.sqrt||(f=>(h||(h=nE(s)),h(p,f))),invertBatch:f=>uE(p,f),cmov:(f,g,v)=>v?g:f,toBytes:f=>r?eu(f,c):gp(f,c),fromBytes:f=>{if(f.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);return r?No(f):Q_(f)}});return Object.freeze(p)}const tf=BigInt(0),Po=BigInt(1);function Tc(s,t){const r=t.negate();return s?r:t}function mp(s,t){if(!Number.isSafeInteger(s)||s<=0||s>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+s)}function Nc(s,t){mp(s,t);const r=Math.ceil(t/s)+1,n=2**(s-1);return{windows:r,windowSize:n}}function hE(s,t){if(!Array.isArray(s))throw new Error("array expected");s.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function lE(s,t){if(!Array.isArray(s))throw new Error("array of scalars expected");s.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}const Fc=new WeakMap,wp=new WeakMap;function Dc(s){return wp.get(s)||1}function fE(s,t){return{constTimeNegate:Tc,hasPrecomputes(r){return Dc(r)!==1},unsafeLadder(r,n,o=s.ZERO){let c=r;for(;n>tf;)n&Po&&(o=o.add(c)),c=c.double(),n>>=Po;return o},precomputeWindow(r,n){const{windows:o,windowSize:c}=Nc(n,t),h=[];let p=r,f=p;for(let g=0;g<o;g++){f=p,h.push(f);for(let v=1;v<c;v++)f=f.add(p),h.push(f);p=f.double()}return h},wNAF(r,n,o){const{windows:c,windowSize:h}=Nc(r,t);let p=s.ZERO,f=s.BASE;const g=BigInt(2**r-1),v=2**r,b=BigInt(r);for(let E=0;E<c;E++){const A=E*h;let S=Number(o&g);o>>=b,S>h&&(S-=v,o+=Po);const D=A,k=A+Math.abs(S)-1,U=E%2!==0,J=S<0;S===0?f=f.add(Tc(U,n[D])):p=p.add(Tc(J,n[k]))}return{p,f}},wNAFUnsafe(r,n,o,c=s.ZERO){const{windows:h,windowSize:p}=Nc(r,t),f=BigInt(2**r-1),g=2**r,v=BigInt(r);for(let b=0;b<h;b++){const E=b*p;if(o===tf)break;let A=Number(o&f);if(o>>=v,A>p&&(A-=g,o+=Po),A===0)continue;let S=n[E+Math.abs(A)-1];A<0&&(S=S.negate()),c=c.add(S)}return c},getPrecomputes(r,n,o){let c=Fc.get(n);return c||(c=this.precomputeWindow(n,r),r!==1&&Fc.set(n,o(c))),c},wNAFCached(r,n,o){const c=Dc(r);return this.wNAF(c,this.getPrecomputes(c,r,o),n)},wNAFCachedUnsafe(r,n,o,c){const h=Dc(r);return h===1?this.unsafeLadder(r,n,c):this.wNAFUnsafe(h,this.getPrecomputes(h,r,o),n,c)},setWindowSize(r,n){mp(n,t),wp.set(r,n),Fc.delete(r)}}}function pE(s,t,r,n){if(hE(r,s),lE(n,t),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const o=s.ZERO,c=Z_(BigInt(r.length)),h=c>12?c-3:c>4?c-2:c?2:1,p=(1<<h)-1,f=new Array(p+1).fill(o),g=Math.floor((t.BITS-1)/h)*h;let v=o;for(let b=g;b>=0;b-=h){f.fill(o);for(let A=0;A<n.length;A++){const S=n[A],D=Number(S>>BigInt(b)&BigInt(p));f[D]=f[D].add(r[A])}let E=o;for(let A=f.length-1,S=o;A>0;A--)S=S.add(f[A]),E=E.add(S);if(v=v.add(E),b!==0)for(let A=0;A<h;A++)v=v.double()}return v}function dE(s){return aE(s.Fp),bu(s,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...yp(s.n,s.nBitLength),...s,p:s.Fp.ORDER})}const ir=BigInt(0),wt=BigInt(1),xo=BigInt(2),gE=BigInt(8),yE={zip215:!0};function vE(s){const t=dE(s);return bu(s,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function mE(s){const t=vE(s),{Fp:r,n,prehash:o,hash:c,randomBytes:h,nByteLength:p,h:f}=t,g=xo<<BigInt(p*8)-wt,v=r.create,b=vp(t.n,t.nBitLength),E=t.uvRatio||((ee,q)=>{try{return{isValid:!0,value:r.sqrt(ee*r.inv(q))}}catch{return{isValid:!1,value:ir}}}),A=t.adjustScalarBytes||(ee=>ee),S=t.domain||((ee,q,V)=>{if(Cc("phflag",V),q.length||V)throw new Error("Contexts/pre-hash are not supported");return ee});function D(ee,q){kn("coordinate "+ee,q,ir,g)}function k(ee){if(!(ee instanceof N))throw new Error("ExtendedPoint expected")}const U=Yl((ee,q)=>{const{ex:V,ey:K,ez:de}=ee,le=ee.is0();q==null&&(q=le?gE:r.inv(de));const ae=v(V*q),Oe=v(K*q),be=v(de*q);if(le)return{x:ir,y:wt};if(be!==wt)throw new Error("invZ was invalid");return{x:ae,y:Oe}}),J=Yl(ee=>{const{a:q,d:V}=t;if(ee.is0())throw new Error("bad point: ZERO");const{ex:K,ey:de,ez:le,et:ae}=ee,Oe=v(K*K),be=v(de*de),$e=v(le*le),Y=v($e*$e),qe=v(Oe*q),St=v($e*v(qe+be)),Ce=v(Y+v(V*v(Oe*be)));if(St!==Ce)throw new Error("bad point: equation left != right (1)");const ze=v(K*de),At=v(le*ae);if(ze!==At)throw new Error("bad point: equation left != right (2)");return!0});class N{constructor(q,V,K,de){this.ex=q,this.ey=V,this.ez=K,this.et=de,D("x",q),D("y",V),D("z",K),D("t",de),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(q){if(q instanceof N)throw new Error("extended point not allowed");const{x:V,y:K}=q||{};return D("x",V),D("y",K),new N(V,K,wt,v(V*K))}static normalizeZ(q){const V=r.invertBatch(q.map(K=>K.ez));return q.map((K,de)=>K.toAffine(V[de])).map(N.fromAffine)}static msm(q,V){return pE(N,b,q,V)}_setWindowSize(q){fe.setWindowSize(this,q)}assertValidity(){J(this)}equals(q){k(q);const{ex:V,ey:K,ez:de}=this,{ex:le,ey:ae,ez:Oe}=q,be=v(V*Oe),$e=v(le*de),Y=v(K*Oe),qe=v(ae*de);return be===$e&&Y===qe}is0(){return this.equals(N.ZERO)}negate(){return new N(v(-this.ex),this.ey,this.ez,v(-this.et))}double(){const{a:q}=t,{ex:V,ey:K,ez:de}=this,le=v(V*V),ae=v(K*K),Oe=v(xo*v(de*de)),be=v(q*le),$e=V+K,Y=v(v($e*$e)-le-ae),qe=be+ae,St=qe-Oe,Ce=be-ae,ze=v(Y*St),At=v(qe*Ce),ut=v(Y*Ce),Ot=v(St*qe);return new N(ze,At,Ot,ut)}add(q){k(q);const{a:V,d:K}=t,{ex:de,ey:le,ez:ae,et:Oe}=this,{ex:be,ey:$e,ez:Y,et:qe}=q;if(V===BigInt(-1)){const Ci=v((le-de)*($e+be)),ar=v((le+de)*($e-be)),et=v(ar-Ci);if(et===ir)return this.double();const cr=v(ae*xo*qe),br=v(Oe*xo*Y),Ri=br+cr,ur=ar+Ci,Ti=br-cr,zt=v(Ri*et),Lt=v(ur*Ti),Mr=v(Ri*Ti),nt=v(et*ur);return new N(zt,Lt,nt,Mr)}const St=v(de*be),Ce=v(le*$e),ze=v(Oe*K*qe),At=v(ae*Y),ut=v((de+le)*(be+$e)-St-Ce),Ot=At-ze,Br=At+ze,Xe=v(Ce-V*St),wr=v(ut*Ot),gn=v(Br*Xe),$t=v(ut*Xe),$i=v(Ot*Br);return new N(wr,gn,$i,$t)}subtract(q){return this.add(q.negate())}wNAF(q){return fe.wNAFCached(this,q,N.normalizeZ)}multiply(q){const V=q;kn("scalar",V,wt,n);const{p:K,f:de}=this.wNAF(V);return N.normalizeZ([K,de])[0]}multiplyUnsafe(q,V=N.ZERO){const K=q;return kn("scalar",K,ir,n),K===ir?Q:this.is0()||K===wt?this:fe.wNAFCachedUnsafe(this,K,N.normalizeZ,V)}isSmallOrder(){return this.multiplyUnsafe(f).is0()}isTorsionFree(){return fe.unsafeLadder(this,n).is0()}toAffine(q){return U(this,q)}clearCofactor(){const{h:q}=t;return q===wt?this:this.multiplyUnsafe(q)}static fromHex(q,V=!1){const{d:K,a:de}=t,le=r.BYTES;q=Dr("pointHex",q,le),Cc("zip215",V);const ae=q.slice(),Oe=q[le-1];ae[le-1]=Oe&-129;const be=No(ae),$e=V?g:r.ORDER;kn("pointHex.y",be,ir,$e);const Y=v(be*be),qe=v(Y-wt),St=v(K*Y-de);let{isValid:Ce,value:ze}=E(qe,St);if(!Ce)throw new Error("Point.fromHex: invalid y coordinate");const At=(ze&wt)===wt,ut=(Oe&128)!==0;if(!V&&ze===ir&&ut)throw new Error("Point.fromHex: x=0 and x_0=1");return ut!==At&&(ze=v(-ze)),N.fromAffine({x:ze,y:be})}static fromPrivateKey(q){return we(q).point}toRawBytes(){const{x:q,y:V}=this.toAffine(),K=eu(V,r.BYTES);return K[K.length-1]|=q&wt?128:0,K}toHex(){return wu(this.toRawBytes())}}N.BASE=new N(t.Gx,t.Gy,wt,v(t.Gx*t.Gy)),N.ZERO=new N(ir,wt,wt,ir);const{BASE:z,ZERO:Q}=N,fe=fE(N,p*8);function re(ee){return We(ee,n)}function oe(ee){return re(No(ee))}function we(ee){const q=r.BYTES;ee=Dr("private key",ee,q);const V=Dr("hashed private key",c(ee),2*q),K=A(V.slice(0,q)),de=V.slice(q,2*q),le=oe(K),ae=z.multiply(le),Oe=ae.toRawBytes();return{head:K,prefix:de,scalar:le,point:ae,pointBytes:Oe}}function qt(ee){return we(ee).pointBytes}function jt(ee=new Uint8Array,...q){const V=Ql(...q);return oe(c(S(V,Dr("context",ee),!!o)))}function xt(ee,q,V={}){ee=Dr("message",ee),o&&(ee=o(ee));const{prefix:K,scalar:de,pointBytes:le}=we(q),ae=jt(V.context,K,ee),Oe=z.multiply(ae).toRawBytes(),be=jt(V.context,Oe,le,ee),$e=re(ae+be*de);kn("signature.s",$e,ir,n);const Y=Ql(Oe,eu($e,r.BYTES));return Dr("result",Y,r.BYTES*2)}const mr=yE;function Lr(ee,q,V,K=mr){const{context:de,zip215:le}=K,ae=r.BYTES;ee=Dr("signature",ee,2*ae),q=Dr("message",q),V=Dr("publicKey",V,ae),le!==void 0&&Cc("zip215",le),o&&(q=o(q));const Oe=No(ee.slice(ae,2*ae));let be,$e,Y;try{be=N.fromHex(V,le),$e=N.fromHex(ee.slice(0,ae),le),Y=z.multiplyUnsafe(Oe)}catch{return!1}if(!le&&be.isSmallOrder())return!1;const qe=jt(de,$e.toRawBytes(),be.toRawBytes(),q);return $e.add(be.multiplyUnsafe(qe)).subtract(Y).clearCofactor().equals(N.ZERO)}return z._setWindowSize(8),{CURVE:t,getPublicKey:qt,sign:xt,verify:Lr,ExtendedPoint:N,utils:{getExtendedPublicKey:we,randomPrivateKey:()=>h(r.BYTES),precompute(ee=8,q=N.BASE){return q._setWindowSize(ee),q.multiply(BigInt(3)),q}}}}BigInt(0),BigInt(1);const _u=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),rf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const wE=BigInt(1),nf=BigInt(2);BigInt(3);const bE=BigInt(5),_E=BigInt(8);function EE(s){const t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),c=_u,h=s*s%c*s%c,p=gr(h,nf,c)*h%c,f=gr(p,wE,c)*s%c,g=gr(f,bE,c)*f%c,v=gr(g,t,c)*g%c,b=gr(v,r,c)*v%c,E=gr(b,n,c)*b%c,A=gr(E,o,c)*E%c,S=gr(A,o,c)*E%c,D=gr(S,t,c)*g%c;return{pow_p_5_8:gr(D,nf,c)*s%c,b2:h}}function IE(s){return s[0]&=248,s[31]&=127,s[31]|=64,s}function PE(s,t){const r=_u,n=We(t*t*t,r),o=We(n*n*t,r),c=EE(s*o).pow_p_5_8;let h=We(s*n*c,r);const p=We(t*h*h,r),f=h,g=We(h*rf,r),v=p===s,b=p===We(-s,r),E=p===We(-s*rf,r);return v&&(h=f),(b||E)&&(h=g),sE(h,r)&&(h=We(-h,r)),{isValid:v||b,value:h}}const xE=vp(_u,void 0,!0),SE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:xE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:_E,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:G_,randomBytes:hp,adjustScalarBytes:IE,uvRatio:PE},bp=mE(SE),AE="EdDSA",OE="JWT",_p=".",Ep="base64url",$E="utf8",CE="utf8",RE=":",TE="did",NE="key",sf="base58btc",FE="z",DE="K36",qE=32;function Eu(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function Ip(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Eu(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Pp(s,t){t||(t=s.reduce((o,c)=>o+c.length,0));const r=Ip(t);let n=0;for(const o of s)r.set(o,n),n+=o.length;return Eu(r)}function jE(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=s.length,f=s.charAt(0),g=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,k=0,U=0,J=S.length;U!==J&&S[U]===0;)U++,D++;for(var N=(J-U)*v+1>>>0,z=new Uint8Array(N);U!==J;){for(var Q=S[U],fe=0,re=N-1;(Q!==0||fe<k)&&re!==-1;re--,fe++)Q+=256*z[re]>>>0,z[re]=Q%p>>>0,Q=Q/p>>>0;if(Q!==0)throw new Error("Non-zero carry");k=fe,U++}for(var oe=N-k;oe!==N&&z[oe]===0;)oe++;for(var we=f.repeat(D);oe<N;++oe)we+=s.charAt(z[oe]);return we}function E(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var k=0,U=0;S[D]===f;)k++,D++;for(var J=(S.length-D)*g+1>>>0,N=new Uint8Array(J);S[D];){var z=r[S.charCodeAt(D)];if(z===255)return;for(var Q=0,fe=J-1;(z!==0||Q<U)&&fe!==-1;fe--,Q++)z+=p*N[fe]>>>0,N[fe]=z%256>>>0,z=z/256>>>0;if(z!==0)throw new Error("Non-zero carry");U=Q,D++}if(S[D]!==" "){for(var re=J-U;re!==J&&N[re]===0;)re++;for(var oe=new Uint8Array(k+(J-re)),we=k;re!==J;)oe[we++]=N[re++];return oe}}}function A(S){var D=E(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:E,decode:A}}var zE=jE,LE=zE;const xp=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},BE=s=>new TextEncoder().encode(s),ME=s=>new TextDecoder().decode(s);let UE=class{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},HE=class{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Sp(this,t)}};class kE{constructor(t){this.decoders=t}or(t){return Sp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Sp=(s,t)=>new kE({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});let VE=class{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new UE(t,r,n),this.decoder=new HE(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Ho=({name:s,prefix:t,encode:r,decode:n})=>new VE(s,t,r,n),as=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=LE(r,t);return Ho({prefix:s,name:t,encode:n,decode:c=>xp(o(c))})},KE=(s,t,r,n)=>{const o={};for(let v=0;v<t.length;++v)o[t[v]]=v;let c=s.length;for(;s[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,g=0;for(let v=0;v<c;++v){const b=o[s[v]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[g++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},GE=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<s.length;++f)for(p=p<<8|s[f],h+=8;h>r;)h-=r,c+=t[o&p>>h];if(h&&(c+=t[o&p<<r-h]),n)for(;c.length*r&7;)c+="=";return c},rt=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>Ho({prefix:t,name:s,encode(o){return GE(o,n,r)},decode(o){return KE(o,n,r,s)}}),WE=Ho({prefix:"\0",name:"identity",encode:s=>ME(s),decode:s=>BE(s)});var JE=Object.freeze({__proto__:null,identity:WE});const QE=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var YE=Object.freeze({__proto__:null,base2:QE});const ZE=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var XE=Object.freeze({__proto__:null,base8:ZE});const eI=as({prefix:"9",name:"base10",alphabet:"0123456789"});var tI=Object.freeze({__proto__:null,base10:eI});const rI=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),iI=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var nI=Object.freeze({__proto__:null,base16:rI,base16upper:iI});const sI=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),oI=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),aI=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),cI=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),uI=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hI=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),lI=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fI=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),pI=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dI=Object.freeze({__proto__:null,base32:sI,base32upper:oI,base32pad:aI,base32padupper:cI,base32hex:uI,base32hexupper:hI,base32hexpad:lI,base32hexpadupper:fI,base32z:pI});const gI=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yI=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vI=Object.freeze({__proto__:null,base36:gI,base36upper:yI});const mI=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wI=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var bI=Object.freeze({__proto__:null,base58btc:mI,base58flickr:wI});const _I=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),EI=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),II=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),PI=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var xI=Object.freeze({__proto__:null,base64:_I,base64pad:EI,base64url:II,base64urlpad:PI});const Ap=Array.from(""),SI=Ap.reduce((s,t,r)=>(s[r]=t,s),[]),AI=Ap.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function OI(s){return s.reduce((t,r)=>(t+=SI[r],t),"")}function $I(s){const t=[];for(const r of s){const n=AI[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const CI=Ho({prefix:"",name:"base256emoji",encode:OI,decode:$I});var RI=Object.freeze({__proto__:null,base256emoji:CI}),TI=Op,of=128,NI=-128,FI=Math.pow(2,31);function Op(s,t,r){t=t||[],r=r||0;for(var n=r;s>=FI;)t[r++]=s&255|of,s/=128;for(;s&NI;)t[r++]=s&255|of,s>>>=7;return t[r]=s|0,Op.bytes=r-n+1,t}var DI=ru,qI=128,af=127;function ru(s,n){var r=0,n=n||0,o=0,c=n,h,p=s.length;do{if(c>=p)throw ru.bytes=0,new RangeError("Could not decode varint");h=s[c++],r+=o<28?(h&af)<<o:(h&af)*Math.pow(2,o),o+=7}while(h>=qI);return ru.bytes=c-n,r}var jI=Math.pow(2,7),zI=Math.pow(2,14),LI=Math.pow(2,21),BI=Math.pow(2,28),MI=Math.pow(2,35),UI=Math.pow(2,42),HI=Math.pow(2,49),kI=Math.pow(2,56),VI=Math.pow(2,63),KI=function(s){return s<jI?1:s<zI?2:s<LI?3:s<BI?4:s<MI?5:s<UI?6:s<HI?7:s<kI?8:s<VI?9:10},GI={encode:TI,decode:DI,encodingLength:KI},$p=GI;const cf=(s,t,r=0)=>($p.encode(s,t,r),t),uf=s=>$p.encodingLength(s),iu=(s,t)=>{const r=t.byteLength,n=uf(s),o=n+uf(r),c=new Uint8Array(o+r);return cf(s,c,0),cf(r,c,n),c.set(t,o),new WI(s,r,t,c)};class WI{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const Cp=({name:s,code:t,encode:r})=>new JI(s,t,r);class JI{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?iu(this.code,r):r.then(n=>iu(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Rp=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),QI=Cp({name:"sha2-256",code:18,encode:Rp("SHA-256")}),YI=Cp({name:"sha2-512",code:19,encode:Rp("SHA-512")});var ZI=Object.freeze({__proto__:null,sha256:QI,sha512:YI});const Tp=0,XI="identity",Np=xp,eP=s=>iu(Tp,Np(s)),tP={code:Tp,name:XI,encode:Np,digest:eP};var rP=Object.freeze({__proto__:null,identity:tP});new TextEncoder,new TextDecoder;const hf={...JE,...YE,...XE,...tI,...nI,...dI,...vI,...bI,...xI,...RI};({...ZI,...rP});function Fp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const lf=Fp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),qc=Fp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=Ip(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Dp={utf8:lf,"utf-8":lf,hex:hf.base16,latin1:qc,ascii:qc,binary:qc,...hf};function Iu(s,t="utf8"){const r=Dp[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s.buffer,s.byteOffset,s.byteLength).toString("utf8"):r.encoder.encode(s).substring(1)}function Pu(s,t="utf8"){const r=Dp[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Eu(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}function Fo(s){return Iu(Pu(is(s),$E),Ep)}function qp(s){const t=Pu(DE,sf),r=FE+Iu(Pp([t,s]),sf);return[TE,NE,r].join(RE)}function iP(s){return Iu(s,Ep)}function nP(s){return Pu([Fo(s.header),Fo(s.payload)].join(_p),CE)}function sP(s){return[Fo(s.header),Fo(s.payload),iP(s.signature)].join(_p)}function ff(s=hp(qE)){const t=bp.getPublicKey(s);return{secretKey:Pp([s,t]),publicKey:t}}async function oP(s,t,r,n,o=G.fromMiliseconds(Date.now())){const c={alg:AE,typ:OE},h=qp(n.publicKey),p=o+r,f={iss:h,sub:s,aud:t,iat:o,exp:p},g=nP({header:c,payload:f}),v=bp.sign(g,n.secretKey.slice(0,32));return sP({header:c,payload:f,signature:v})}let aP=class extends Xf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||pu().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{or(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ns(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const cP=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),uP=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",pf=s=>s.split("?")[0],df=10,hP=cP();let lP=class{constructor(t){if(this.url=t,this.events=new Qt.EventEmitter,this.registering=!1,!Fl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(is(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Fl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,o)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),o(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,n)=>{const o=new URLSearchParams(t).get("origin"),c=Ib.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!Pb(t)},h=new hP(t,[],c);uP()?h.onerror=p=>{const f=p;n(this.emitError(f.error))}:h.on("error",p=>{n(this.emitError(p))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?jo(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const n=this.parseError(r),o=n.message||n.toString(),c=du(t,o);this.events.emit("payload",c)}parseError(t,r=this.url){return xb(t,pf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>df&&this.events.setMaxListeners(df)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${pf(this.url)}`));return this.events.emit("register_error",r),r}};var Do={exports:{}};Do.exports;(function(s,t){var r=200,n="__lodash_hash_undefined__",o=1,c=2,h=9007199254740991,p="[object Arguments]",f="[object Array]",g="[object AsyncFunction]",v="[object Boolean]",b="[object Date]",E="[object Error]",A="[object Function]",S="[object GeneratorFunction]",D="[object Map]",k="[object Number]",U="[object Null]",J="[object Object]",N="[object Promise]",z="[object Proxy]",Q="[object RegExp]",fe="[object Set]",re="[object String]",oe="[object Symbol]",we="[object Undefined]",qt="[object WeakMap]",jt="[object ArrayBuffer]",xt="[object DataView]",mr="[object Float32Array]",Lr="[object Float64Array]",ee="[object Int8Array]",q="[object Int16Array]",V="[object Int32Array]",K="[object Uint8Array]",de="[object Uint8ClampedArray]",le="[object Uint16Array]",ae="[object Uint32Array]",Oe=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,$e=/^(?:0|[1-9]\d*)$/,Y={};Y[mr]=Y[Lr]=Y[ee]=Y[q]=Y[V]=Y[K]=Y[de]=Y[le]=Y[ae]=!0,Y[p]=Y[f]=Y[jt]=Y[v]=Y[xt]=Y[b]=Y[E]=Y[A]=Y[D]=Y[k]=Y[J]=Y[Q]=Y[fe]=Y[re]=Y[qt]=!1;var qe=typeof mo=="object"&&mo&&mo.Object===Object&&mo,St=typeof self=="object"&&self&&self.Object===Object&&self,Ce=qe||St||Function("return this")(),ze=t&&!t.nodeType&&t,At=ze&&!0&&s&&!s.nodeType&&s,ut=At&&At.exports===ze,Ot=ut&&qe.process,Br=function(){try{return Ot&&Ot.binding&&Ot.binding("util")}catch{}}(),Xe=Br&&Br.isTypedArray;function wr(m,I){for(var T=-1,L=m==null?0:m.length,xe=0,ie=[];++T<L;){var Re=m[T];I(Re,T,m)&&(ie[xe++]=Re)}return ie}function gn(m,I){for(var T=-1,L=I.length,xe=m.length;++T<L;)m[xe+T]=I[T];return m}function $t(m,I){for(var T=-1,L=m==null?0:m.length;++T<L;)if(I(m[T],T,m))return!0;return!1}function $i(m,I){for(var T=-1,L=Array(m);++T<m;)L[T]=I(T);return L}function Ci(m){return function(I){return m(I)}}function ar(m,I){return m.has(I)}function et(m,I){return m==null?void 0:m[I]}function cr(m){var I=-1,T=Array(m.size);return m.forEach(function(L,xe){T[++I]=[xe,L]}),T}function br(m,I){return function(T){return m(I(T))}}function Ri(m){var I=-1,T=Array(m.size);return m.forEach(function(L){T[++I]=L}),T}var ur=Array.prototype,Ti=Function.prototype,zt=Object.prototype,Lt=Ce["__core-js_shared__"],Mr=Ti.toString,nt=zt.hasOwnProperty,Ni=function(){var m=/[^.]+$/.exec(Lt&&Lt.keys&&Lt.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Fi=zt.toString,yn=RegExp("^"+Mr.call(nt).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Di=ut?Ce.Buffer:void 0,Ur=Ce.Symbol,qi=Ce.Uint8Array,ji=zt.propertyIsEnumerable,Ko=ur.splice,_r=Ur?Ur.toStringTag:void 0,us=Object.getOwnPropertySymbols,hs=Di?Di.isBuffer:void 0,ls=br(Object.keys,Object),vn=Ct(Ce,"DataView"),ci=Ct(Ce,"Map"),mn=Ct(Ce,"Promise"),wn=Ct(Ce,"Set"),zi=Ct(Ce,"WeakMap"),ui=Ct(Object,"create"),Go=Pr(vn),Wo=Pr(ci),bn=Pr(mn),Jo=Pr(wn),_n=Pr(zi),fs=Ur?Ur.prototype:void 0,En=fs?fs.valueOf:void 0;function Er(m){var I=-1,T=m==null?0:m.length;for(this.clear();++I<T;){var L=m[I];this.set(L[0],L[1])}}function Qo(){this.__data__=ui?ui(null):{},this.size=0}function Yo(m){var I=this.has(m)&&delete this.__data__[m];return this.size-=I?1:0,I}function Zo(m){var I=this.__data__;if(ui){var T=I[m];return T===n?void 0:T}return nt.call(I,m)?I[m]:void 0}function Xo(m){var I=this.__data__;return ui?I[m]!==void 0:nt.call(I,m)}function ea(m,I){var T=this.__data__;return this.size+=this.has(m)?0:1,T[m]=ui&&I===void 0?n:I,this}Er.prototype.clear=Qo,Er.prototype.delete=Yo,Er.prototype.get=Zo,Er.prototype.has=Xo,Er.prototype.set=ea;function Bt(m){var I=-1,T=m==null?0:m.length;for(this.clear();++I<T;){var L=m[I];this.set(L[0],L[1])}}function ta(){this.__data__=[],this.size=0}function ra(m){var I=this.__data__,T=hi(I,m);if(T<0)return!1;var L=I.length-1;return T==L?I.pop():Ko.call(I,T,1),--this.size,!0}function ia(m){var I=this.__data__,T=hi(I,m);return T<0?void 0:I[T][1]}function na(m){return hi(this.__data__,m)>-1}function sa(m,I){var T=this.__data__,L=hi(T,m);return L<0?(++this.size,T.push([m,I])):T[L][1]=I,this}Bt.prototype.clear=ta,Bt.prototype.delete=ra,Bt.prototype.get=ia,Bt.prototype.has=na,Bt.prototype.set=sa;function Ir(m){var I=-1,T=m==null?0:m.length;for(this.clear();++I<T;){var L=m[I];this.set(L[0],L[1])}}function Li(){this.size=0,this.__data__={hash:new Er,map:new(ci||Bt),string:new Er}}function oa(m){var I=Hr(this,m).delete(m);return this.size-=I?1:0,I}function Bi(m){return Hr(this,m).get(m)}function aa(m){return Hr(this,m).has(m)}function ca(m,I){var T=Hr(this,m),L=T.size;return T.set(m,I),this.size+=T.size==L?0:1,this}Ir.prototype.clear=Li,Ir.prototype.delete=oa,Ir.prototype.get=Bi,Ir.prototype.has=aa,Ir.prototype.set=ca;function Mi(m){var I=-1,T=m==null?0:m.length;for(this.__data__=new Ir;++I<T;)this.add(m[I])}function ps(m){return this.__data__.set(m,n),this}function ds(m){return this.__data__.has(m)}Mi.prototype.add=Mi.prototype.push=ps,Mi.prototype.has=ds;function Yt(m){var I=this.__data__=new Bt(m);this.size=I.size}function ua(){this.__data__=new Bt,this.size=0}function ha(m){var I=this.__data__,T=I.delete(m);return this.size=I.size,T}function la(m){return this.__data__.get(m)}function fa(m){return this.__data__.has(m)}function gs(m,I){var T=this.__data__;if(T instanceof Bt){var L=T.__data__;if(!ci||L.length<r-1)return L.push([m,I]),this.size=++T.size,this;T=this.__data__=new Ir(L)}return T.set(m,I),this.size=T.size,this}Yt.prototype.clear=ua,Yt.prototype.delete=ha,Yt.prototype.get=la,Yt.prototype.has=fa,Yt.prototype.set=gs;function ys(m,I){var T=ki(m),L=!T&&Os(m),xe=!T&&!L&&xn(m),ie=!T&&!L&&!xe&&Rs(m),Re=T||L||xe||ie,He=Re?$i(m.length,String):[],ye=He.length;for(var Se in m)nt.call(m,Se)&&!(Re&&(Se=="length"||xe&&(Se=="offset"||Se=="parent")||ie&&(Se=="buffer"||Se=="byteLength"||Se=="byteOffset")||Is(Se,ye)))&&He.push(Se);return He}function hi(m,I){for(var T=m.length;T--;)if(As(m[T][0],I))return T;return-1}function In(m,I,T){var L=I(m);return ki(m)?L:gn(L,T(m))}function li(m){return m==null?m===void 0?we:U:_r&&_r in Object(m)?_s(m):ga(m)}function Pn(m){return pi(m)&&li(m)==p}function fi(m,I,T,L,xe){return m===I?!0:m==null||I==null||!pi(m)&&!pi(I)?m!==m&&I!==I:vs(m,I,T,L,fi,xe)}function vs(m,I,T,L,xe,ie){var Re=ki(m),He=ki(I),ye=Re?f:hr(m),Se=He?f:hr(I);ye=ye==p?J:ye,Se=Se==p?J:Se;var Le=ye==J,dt=Se==J,ke=ye==Se;if(ke&&xn(m)){if(!xn(I))return!1;Re=!0,Le=!1}if(ke&&!Le)return ie||(ie=new Yt),Re||Rs(m)?Ui(m,I,T,L,xe,ie):da(m,I,ye,T,L,xe,ie);if(!(T&o)){var Te=Le&&nt.call(m,"__wrapped__"),ht=dt&&nt.call(I,"__wrapped__");if(Te||ht){var Zt=Te?m.value():m,Mt=ht?I.value():I;return ie||(ie=new Yt),xe(Zt,Mt,T,L,ie)}}return ke?(ie||(ie=new Yt),bs(m,I,T,L,xe,ie)):!1}function pa(m){if(!Cs(m)||xs(m))return!1;var I=Vi(m)?yn:be;return I.test(Pr(m))}function ms(m){return pi(m)&&$s(m.length)&&!!Y[li(m)]}function ws(m){if(!Ss(m))return ls(m);var I=[];for(var T in Object(m))nt.call(m,T)&&T!="constructor"&&I.push(T);return I}function Ui(m,I,T,L,xe,ie){var Re=T&o,He=m.length,ye=I.length;if(He!=ye&&!(Re&&ye>He))return!1;var Se=ie.get(m);if(Se&&ie.get(I))return Se==I;var Le=-1,dt=!0,ke=T&c?new Mi:void 0;for(ie.set(m,I),ie.set(I,m);++Le<He;){var Te=m[Le],ht=I[Le];if(L)var Zt=Re?L(ht,Te,Le,I,m,ie):L(Te,ht,Le,m,I,ie);if(Zt!==void 0){if(Zt)continue;dt=!1;break}if(ke){if(!$t(I,function(Mt,lr){if(!ar(ke,lr)&&(Te===Mt||xe(Te,Mt,T,L,ie)))return ke.push(lr)})){dt=!1;break}}else if(!(Te===ht||xe(Te,ht,T,L,ie))){dt=!1;break}}return ie.delete(m),ie.delete(I),dt}function da(m,I,T,L,xe,ie,Re){switch(T){case xt:if(m.byteLength!=I.byteLength||m.byteOffset!=I.byteOffset)return!1;m=m.buffer,I=I.buffer;case jt:return!(m.byteLength!=I.byteLength||!ie(new qi(m),new qi(I)));case v:case b:case k:return As(+m,+I);case E:return m.name==I.name&&m.message==I.message;case Q:case re:return m==I+"";case D:var He=cr;case fe:var ye=L&o;if(He||(He=Ri),m.size!=I.size&&!ye)return!1;var Se=Re.get(m);if(Se)return Se==I;L|=c,Re.set(m,I);var Le=Ui(He(m),He(I),L,xe,ie,Re);return Re.delete(m),Le;case oe:if(En)return En.call(m)==En.call(I)}return!1}function bs(m,I,T,L,xe,ie){var Re=T&o,He=Hi(m),ye=He.length,Se=Hi(I),Le=Se.length;if(ye!=Le&&!Re)return!1;for(var dt=ye;dt--;){var ke=He[dt];if(!(Re?ke in I:nt.call(I,ke)))return!1}var Te=ie.get(m);if(Te&&ie.get(I))return Te==I;var ht=!0;ie.set(m,I),ie.set(I,m);for(var Zt=Re;++dt<ye;){ke=He[dt];var Mt=m[ke],lr=I[ke];if(L)var Sn=Re?L(lr,Mt,ke,I,m,ie):L(Mt,lr,ke,m,I,ie);if(!(Sn===void 0?Mt===lr||xe(Mt,lr,T,L,ie):Sn)){ht=!1;break}Zt||(Zt=ke=="constructor")}if(ht&&!Zt){var di=m.constructor,Je=I.constructor;di!=Je&&"constructor"in m&&"constructor"in I&&!(typeof di=="function"&&di instanceof di&&typeof Je=="function"&&Je instanceof Je)&&(ht=!1)}return ie.delete(m),ie.delete(I),ht}function Hi(m){return In(m,ma,Es)}function Hr(m,I){var T=m.__data__;return Ps(I)?T[typeof I=="string"?"string":"hash"]:T.map}function Ct(m,I){var T=et(m,I);return pa(T)?T:void 0}function _s(m){var I=nt.call(m,_r),T=m[_r];try{m[_r]=void 0;var L=!0}catch{}var xe=Fi.call(m);return L&&(I?m[_r]=T:delete m[_r]),xe}var Es=us?function(m){return m==null?[]:(m=Object(m),wr(us(m),function(I){return ji.call(m,I)}))}:Pe,hr=li;(vn&&hr(new vn(new ArrayBuffer(1)))!=xt||ci&&hr(new ci)!=D||mn&&hr(mn.resolve())!=N||wn&&hr(new wn)!=fe||zi&&hr(new zi)!=qt)&&(hr=function(m){var I=li(m),T=I==J?m.constructor:void 0,L=T?Pr(T):"";if(L)switch(L){case Go:return xt;case Wo:return D;case bn:return N;case Jo:return fe;case _n:return qt}return I});function Is(m,I){return I=I??h,!!I&&(typeof m=="number"||$e.test(m))&&m>-1&&m%1==0&&m<I}function Ps(m){var I=typeof m;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?m!=="__proto__":m===null}function xs(m){return!!Ni&&Ni in m}function Ss(m){var I=m&&m.constructor,T=typeof I=="function"&&I.prototype||zt;return m===T}function ga(m){return Fi.call(m)}function Pr(m){if(m!=null){try{return Mr.call(m)}catch{}try{return m+""}catch{}}return""}function As(m,I){return m===I||m!==m&&I!==I}var Os=Pn(function(){return arguments}())?Pn:function(m){return pi(m)&&nt.call(m,"callee")&&!ji.call(m,"callee")},ki=Array.isArray;function ya(m){return m!=null&&$s(m.length)&&!Vi(m)}var xn=hs||Ie;function va(m,I){return fi(m,I)}function Vi(m){if(!Cs(m))return!1;var I=li(m);return I==A||I==S||I==g||I==z}function $s(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=h}function Cs(m){var I=typeof m;return m!=null&&(I=="object"||I=="function")}function pi(m){return m!=null&&typeof m=="object"}var Rs=Xe?Ci(Xe):ms;function ma(m){return ya(m)?ys(m):ws(m)}function Pe(){return[]}function Ie(){return!1}s.exports=va})(Do,Do.exports);var fP=Do.exports;const pP=lu(fP);function dP(s,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest,c=[],h=[],p={},f=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:f,headers:{keys:function(){return c},entries:function(){return h},get:function(v){return p[v.toLowerCase()]},has:function(v){return v.toLowerCase()in p}}}};for(var g in o.open(t.method||"get",s,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(v,b,E){c.push(b=b.toLowerCase()),h.push([b,E]),p[b]=p[b]?p[b]+","+E:E}),r(f())},o.onerror=n,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(g,t.headers[g]);o.send(t.body||null)})}const gP=Object.freeze(Object.defineProperty({__proto__:null,default:dP},Symbol.toStringTag,{value:"Module"})),gf=hu(gP);var yP=self.fetch||(self.fetch=gf.default||gf);const vP=lu(yP);var mP={};function wP(s,t){if(s.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<s.length;o++){var c=s.charAt(o),h=c.charCodeAt(0);if(r[h]!==255)throw new TypeError(c+" is ambiguous");r[h]=o}var p=s.length,f=s.charAt(0),g=Math.log(p)/Math.log(256),v=Math.log(256)/Math.log(p);function b(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var D=0,k=0,U=0,J=S.length;U!==J&&S[U]===0;)U++,D++;for(var N=(J-U)*v+1>>>0,z=new Uint8Array(N);U!==J;){for(var Q=S[U],fe=0,re=N-1;(Q!==0||fe<k)&&re!==-1;re--,fe++)Q+=256*z[re]>>>0,z[re]=Q%p>>>0,Q=Q/p>>>0;if(Q!==0)throw new Error("Non-zero carry");k=fe,U++}for(var oe=N-k;oe!==N&&z[oe]===0;)oe++;for(var we=f.repeat(D);oe<N;++oe)we+=s.charAt(z[oe]);return we}function E(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var D=0;if(S[D]!==" "){for(var k=0,U=0;S[D]===f;)k++,D++;for(var J=(S.length-D)*g+1>>>0,N=new Uint8Array(J);S[D];){var z=r[S.charCodeAt(D)];if(z===255)return;for(var Q=0,fe=J-1;(z!==0||Q<U)&&fe!==-1;fe--,Q++)z+=p*N[fe]>>>0,N[fe]=z%256>>>0,z=z/256>>>0;if(z!==0)throw new Error("Non-zero carry");U=Q,D++}if(S[D]!==" "){for(var re=J-U;re!==J&&N[re]===0;)re++;for(var oe=new Uint8Array(k+(J-re)),we=k;re!==J;)oe[we++]=N[re++];return oe}}}function A(S){var D=E(S);if(D)return D;throw new Error(`Non-${t} character`)}return{encode:b,decodeUnsafe:E,decode:A}}var bP=wP,_P=bP;const jp=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},EP=s=>new TextEncoder().encode(s),IP=s=>new TextDecoder().decode(s);class PP{constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class xP{constructor(t,r,n){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return zp(this,t)}}class SP{constructor(t){this.decoders=t}or(t){return zp(this,t)}decode(t){const r=t[0],n=this.decoders[r];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const zp=(s,t)=>new SP({...s.decoders||{[s.prefix]:s},...t.decoders||{[t.prefix]:t}});class AP{constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new PP(t,r,n),this.decoder=new xP(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ko=({name:s,prefix:t,encode:r,decode:n})=>new AP(s,t,r,n),cs=({prefix:s,name:t,alphabet:r})=>{const{encode:n,decode:o}=_P(r,t);return ko({prefix:s,name:t,encode:n,decode:c=>jp(o(c))})},OP=(s,t,r,n)=>{const o={};for(let v=0;v<t.length;++v)o[t[v]]=v;let c=s.length;for(;s[c-1]==="=";)--c;const h=new Uint8Array(c*r/8|0);let p=0,f=0,g=0;for(let v=0;v<c;++v){const b=o[s[v]];if(b===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|b,p+=r,p>=8&&(p-=8,h[g++]=255&f>>p)}if(p>=r||255&f<<8-p)throw new SyntaxError("Unexpected end of data");return h},$P=(s,t,r)=>{const n=t[t.length-1]==="=",o=(1<<r)-1;let c="",h=0,p=0;for(let f=0;f<s.length;++f)for(p=p<<8|s[f],h+=8;h>r;)h-=r,c+=t[o&p>>h];if(h&&(c+=t[o&p<<r-h]),n)for(;c.length*r&7;)c+="=";return c},it=({name:s,prefix:t,bitsPerChar:r,alphabet:n})=>ko({prefix:t,name:s,encode(o){return $P(o,n,r)},decode(o){return OP(o,n,r,s)}}),CP=ko({prefix:"\0",name:"identity",encode:s=>IP(s),decode:s=>EP(s)});var RP=Object.freeze({__proto__:null,identity:CP});const TP=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var NP=Object.freeze({__proto__:null,base2:TP});const FP=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var DP=Object.freeze({__proto__:null,base8:FP});const qP=cs({prefix:"9",name:"base10",alphabet:"0123456789"});var jP=Object.freeze({__proto__:null,base10:qP});const zP=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),LP=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var BP=Object.freeze({__proto__:null,base16:zP,base16upper:LP});const MP=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),UP=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),HP=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kP=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),VP=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),KP=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),GP=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),WP=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),JP=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var QP=Object.freeze({__proto__:null,base32:MP,base32upper:UP,base32pad:HP,base32padupper:kP,base32hex:VP,base32hexupper:KP,base32hexpad:GP,base32hexpadupper:WP,base32z:JP});const YP=cs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ZP=cs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var XP=Object.freeze({__proto__:null,base36:YP,base36upper:ZP});const ex=cs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),tx=cs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var rx=Object.freeze({__proto__:null,base58btc:ex,base58flickr:tx});const ix=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),nx=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sx=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ox=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ax=Object.freeze({__proto__:null,base64:ix,base64pad:nx,base64url:sx,base64urlpad:ox});const Lp=Array.from(""),cx=Lp.reduce((s,t,r)=>(s[r]=t,s),[]),ux=Lp.reduce((s,t,r)=>(s[t.codePointAt(0)]=r,s),[]);function hx(s){return s.reduce((t,r)=>(t+=cx[r],t),"")}function lx(s){const t=[];for(const r of s){const n=ux[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(n)}return new Uint8Array(t)}const fx=ko({prefix:"",name:"base256emoji",encode:hx,decode:lx});var px=Object.freeze({__proto__:null,base256emoji:fx}),dx=Bp,yf=128,gx=-128,yx=Math.pow(2,31);function Bp(s,t,r){t=t||[],r=r||0;for(var n=r;s>=yx;)t[r++]=s&255|yf,s/=128;for(;s&gx;)t[r++]=s&255|yf,s>>>=7;return t[r]=s|0,Bp.bytes=r-n+1,t}var vx=nu,mx=128,vf=127;function nu(s,n){var r=0,n=n||0,o=0,c=n,h,p=s.length;do{if(c>=p)throw nu.bytes=0,new RangeError("Could not decode varint");h=s[c++],r+=o<28?(h&vf)<<o:(h&vf)*Math.pow(2,o),o+=7}while(h>=mx);return nu.bytes=c-n,r}var wx=Math.pow(2,7),bx=Math.pow(2,14),_x=Math.pow(2,21),Ex=Math.pow(2,28),Ix=Math.pow(2,35),Px=Math.pow(2,42),xx=Math.pow(2,49),Sx=Math.pow(2,56),Ax=Math.pow(2,63),Ox=function(s){return s<wx?1:s<bx?2:s<_x?3:s<Ex?4:s<Ix?5:s<Px?6:s<xx?7:s<Sx?8:s<Ax?9:10},$x={encode:dx,decode:vx,encodingLength:Ox},Mp=$x;const mf=(s,t,r=0)=>(Mp.encode(s,t,r),t),wf=s=>Mp.encodingLength(s),su=(s,t)=>{const r=t.byteLength,n=wf(s),o=n+wf(r),c=new Uint8Array(o+r);return mf(s,c,0),mf(r,c,n),c.set(t,o),new Cx(s,r,t,c)};class Cx{constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}}const Up=({name:s,code:t,encode:r})=>new Rx(s,t,r);class Rx{constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?su(this.code,r):r.then(n=>su(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Hp=s=>async t=>new Uint8Array(await crypto.subtle.digest(s,t)),Tx=Up({name:"sha2-256",code:18,encode:Hp("SHA-256")}),Nx=Up({name:"sha2-512",code:19,encode:Hp("SHA-512")});var Fx=Object.freeze({__proto__:null,sha256:Tx,sha512:Nx});const kp=0,Dx="identity",Vp=jp,qx=s=>su(kp,Vp(s)),jx={code:kp,name:Dx,encode:Vp,digest:qx};var zx=Object.freeze({__proto__:null,identity:jx});new TextEncoder,new TextDecoder;const bf={...RP,...NP,...DP,...jP,...BP,...QP,...XP,...rx,...ax,...px};({...Fx,...zx});function Kp(s){return globalThis.Buffer!=null?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):s}function Lx(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Kp(globalThis.Buffer.allocUnsafe(s)):new Uint8Array(s)}function Gp(s,t,r,n){return{name:s,prefix:t,encoder:{name:s,prefix:t,encode:r},decoder:{decode:n}}}const _f=Gp("utf8","u",s=>"u"+new TextDecoder("utf8").decode(s),s=>new TextEncoder().encode(s.substring(1))),jc=Gp("ascii","a",s=>{let t="a";for(let r=0;r<s.length;r++)t+=String.fromCharCode(s[r]);return t},s=>{s=s.substring(1);const t=Lx(s.length);for(let r=0;r<s.length;r++)t[r]=s.charCodeAt(r);return t}),Bx={utf8:_f,"utf-8":_f,hex:bf.base16,latin1:jc,ascii:jc,binary:jc,...bf};function Mx(s,t="utf8"){const r=Bx[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Kp(globalThis.Buffer.from(s,"utf-8")):r.decoder.decode(`${r.prefix}${s}`)}const Wp="wc",Ux=2,Jp="core",ni=`${Wp}@2:${Jp}:`,Hx={logger:"error"},kx={database:":memory:"},Vx="crypto",Ef="client_ed25519_seed",Kx=G.ONE_DAY,Gx="keychain",Wx="0.3",Jx="messages",Qx="0.3",Yx=G.SIX_HOURS,Zx="publisher",Qp="irn",Xx="error",Yp="wss://relay.walletconnect.com",If="wss://relay.walletconnect.org",eS="relayer",ct={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},tS="_subscription",qr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},rS=G.ONE_SECOND,iS="2.11.0",nS=1e4,sS="0.3",oS="WALLETCONNECT_CLIENT_ID",nr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},aS="subscription",cS="0.3",uS=G.FIVE_SECONDS*1e3,hS="pairing",lS="0.3",Vn={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},Yn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},fS="history",pS="0.3",dS="expirer",Jt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},gS="0.3",zc="verify-api",ln="https://verify.walletconnect.com",ou="https://verify.walletconnect.org",yS=[ln,ou],vS="echo",mS="https://echo.walletconnect.com";class wS{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=Gx,this.version=Wx,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:c}=B("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=t,this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Qf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Yf(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class bS{constructor(t,r,n){this.core=t,this.logger=r,this.name=Vx,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),c=ff(o);return qp(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=q0();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const c=await this.getClientSeed(),h=ff(c),p=Kc();return await oP(p,o,Kx,h)},this.generateSharedKey=(o,c,h)=>{this.isInitialized();const p=this.getPrivateKey(o),f=j0(p,c);return this.setSymKey(f,h)},this.setSymKey=async(o,c)=>{this.isInitialized();const h=c||z0(o);return await this.keychain.set(h,o),h},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,c,h)=>{this.isInitialized();const p=L0(h),f=is(c);if(Ol(p)){const E=p.senderPublicKey,A=p.receiverPublicKey;o=await this.generateSharedKey(E,A)}const g=this.getSymKey(o),{type:v,senderPublicKey:b}=p;return B0({type:v,symKey:g,message:f,senderPublicKey:b})},this.decode=async(o,c,h)=>{this.isInitialized();const p=M0(c,h);if(Ol(p)){const f=p.receiverPublicKey,g=p.senderPublicKey;o=await this.generateSharedKey(f,g)}try{const f=this.getSymKey(o),g=U0({symKey:f,encoded:c});return jo(g)}catch(f){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(f)}},this.getPayloadType=o=>{const c=$l(o);return H0(c.type)},this.getPayloadSenderPublicKey=o=>{const c=$l(o);return c.senderPublicKey?k0(c.senderPublicKey,rb):void 0},this.core=t,this.logger=Pt(r,this.name),this.keychain=n||new wS(this.core,this.logger)}get context(){return It(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Ef)}catch{t=Kc(),await this.keychain.set(Ef,t)}return Mx(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class _S extends o_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=Jx,this.version=Qx,this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const c=fn(o);let h=this.messages.get(n);return typeof h>"u"&&(h={}),typeof h[c]<"u"||(h[c]=o,this.messages.set(n,h),await this.persist()),c},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const c=this.get(n),h=fn(o);return typeof c[h]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Pt(t,this.name),this.core=r}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Qf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Yf(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class ES extends a_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qt.EventEmitter,this.name=Zx,this.queue=new Map,this.publishTimeout=G.toMiliseconds(G.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,c)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}});try{const p=(c==null?void 0:c.ttl)||Yx,f=Gc(c),g=(c==null?void 0:c.prompt)||!1,v=(c==null?void 0:c.tag)||0,b=(c==null?void 0:c.id)||pu().toString(),E={topic:n,message:o,opts:{ttl:p,relay:f,prompt:g,tag:v,id:b}},A=setTimeout(()=>this.queue.set(b,E),this.publishTimeout);try{await await Xn(this.rpcPublish(n,o,p,f,g,v,b),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(b),this.relayer.events.emit(ct.publish,E)}catch(S){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=c==null?void 0:c.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(b),S;return}finally{clearTimeout(A)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=t,this.logger=Pt(r,this.name),this.registerEventListeners()}get context(){return It(this.logger)}rpcPublish(t,r,n,o,c,h,p){var f,g,v,b;const E={method:$o(o.protocol).publish,params:{topic:t,message:r,ttl:n,prompt:c,tag:h},id:p};return ii((f=E.params)==null?void 0:f.prompt)&&((g=E.params)==null||delete g.prompt),ii((v=E.params)==null?void 0:v.tag)&&((b=E.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.request(E)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:n,opts:o}=t;await this.publish(r,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ct.connection_stalled);return}this.checkQueue()}),this.relayer.on(ct.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class IS{constructor(){this.map=new Map,this.set=(t,r)=>{const n=this.get(t);this.exists(t,r)||this.map.set(t,[...n,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const n=this.get(t);if(!this.exists(t,r))return;const o=n.filter(c=>c!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var PS=Object.defineProperty,xS=Object.defineProperties,SS=Object.getOwnPropertyDescriptors,Pf=Object.getOwnPropertySymbols,AS=Object.prototype.hasOwnProperty,OS=Object.prototype.propertyIsEnumerable,xf=(s,t,r)=>t in s?PS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Kn=(s,t)=>{for(var r in t||(t={}))AS.call(t,r)&&xf(s,r,t[r]);if(Pf)for(var r of Pf(t))OS.call(t,r)&&xf(s,r,t[r]);return s},Lc=(s,t)=>xS(s,SS(t));class $S extends h_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new IS,this.events=new Qt.EventEmitter,this.name=aS,this.version=cS,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ni,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const c=Gc(o),h={topic:n,relay:c};this.pending.set(n,h);const p=await this.rpcSubscribe(n,c);return this.onSubscribe(p,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),p}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,c)=>{const h=new G.Watch;h.start(this.pendingSubscriptionWatchLabel);const p=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),o(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=uS&&(clearInterval(p),h.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Pt(r,this.name),this.clientId=""}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let n=!1;try{n=this.getSubscription(t).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const n=this.topicMap.get(t);await Promise.all(n.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}});try{const o=Gc(n);await this.rpcUnsubscribe(t,r,o);const c=at("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const n={method:$o(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}return fn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,n={method:$o(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ct.connection_stalled)}}rpcUnsubscribe(t,r,n){const o={method:$o(n.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,Lc(Kn({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Kn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,n),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Kn({},r)),this.topicMap.set(r.topic,t),this.events.emit(nr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const n=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(n.topic,t),this.events.emit(nr.deleted,Lc(Kn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(nr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(nr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);pn(r)&&this.onBatchSubscribe(r.map((n,o)=>Lc(Kn({},t[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ct.connect,async()=>{await this.onConnect()}),this.relayer.on(ct.disconnect,()=>{this.onDisconnect()}),this.events.on(nr.created,async t=>{const r=nr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(nr.deleted,async t=>{const r=nr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var CS=Object.defineProperty,Sf=Object.getOwnPropertySymbols,RS=Object.prototype.hasOwnProperty,TS=Object.prototype.propertyIsEnumerable,Af=(s,t,r)=>t in s?CS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,NS=(s,t)=>{for(var r in t||(t={}))RS.call(t,r)&&Af(s,r,t[r]);if(Sf)for(var r of Sf(t))TS.call(t,r)&&Af(s,r,t[r]);return s};class FS extends c_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qt.EventEmitter,this.name=eS,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(ct.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(ct.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(qr.payload,this.onPayloadHandler),this.provider.on(qr.connect,this.onConnectHandler),this.provider.on(qr.disconnect,this.onDisconnectHandler),this.provider.on(qr.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Pt(t.logger,this.name):Uo(Mo({level:t.logger||Xx})),this.messages=new _S(this.logger,t.core),this.subscriber=new $S(this,this.logger),this.publisher=new ES(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Yp,this.projectId=t.projectId,this.bundleId=G0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${If}...`),await this.restartTransport(If)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},nS)}get context(){return It(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,n){this.isInitialized(),await this.publisher.publish(t,r,n),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(t))==null?void 0:n[0])||"";if(o)return o;let c;const h=p=>{p.topic===t&&(this.subscriber.off(nr.created,h),c())};return await Promise.all([new Promise(p=>{c=p,this.subscriber.on(nr.created,h)}),new Promise(async p=>{o=await this.subscriber.subscribe(t,r),p()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(nr.resubscribed,()=>{r()})}),new Promise(async(r,n)=>{try{await Xn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}r()})])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.provider.events.emit(qr.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Cl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new aP(new lP(W0({sdkVersion:iS,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:n}=t;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(t){const{topic:r,message:n}=t;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),gu(t)){if(!t.method.endsWith(tS))return;const r=t.params,{topic:n,message:o,publishedAt:c}=r.data,h={topic:n,message:o,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(NS({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(t),await this.onMessageEvent(h)}else ns(t)&&this.events.emit(ct.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(ct.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=zo(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(qr.payload,this.onPayloadHandler),this.provider.off(qr.connect,this.onConnectHandler),this.provider.off(qr.disconnect,this.onDisconnectHandler),this.provider.off(qr.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(ct.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Cl();J0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(ct.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},G.toMiliseconds(rS)))}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var DS=Object.defineProperty,Of=Object.getOwnPropertySymbols,qS=Object.prototype.hasOwnProperty,jS=Object.prototype.propertyIsEnumerable,$f=(s,t,r)=>t in s?DS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Cf=(s,t)=>{for(var r in t||(t={}))qS.call(t,r)&&$f(s,r,t[r]);if(Of)for(var r of Of(t))jS.call(t,r)&&$f(s,r,t[r]);return s};class Vo extends u_{constructor(t,r,n,o=ni,c=void 0){super(t,r,n,o),this.core=t,this.logger=r,this.name=n,this.map=new Map,this.version=sS,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!ii(h)?this.map.set(this.getKey(h),h):eb(h)?this.map.set(h.id,h):tb(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,p)=>{this.isInitialized(),this.map.has(h)?await this.update(h,p):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:p}),this.map.set(h,p),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(p=>Object.keys(h).every(f=>pP(p[f],h[f]))):this.values),this.update=async(h,p)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:p});const f=Cf(Cf({},this.getData(h)),p);this.map.set(h,f),await this.persist()},this.delete=async(h,p)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:p}),this.map.delete(h),await this.persist())},this.logger=Pt(r,this.name),this.storagePrefix=o,this.getKey=c}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class zS{constructor(t,r){this.core=t,this.logger=r,this.name=hS,this.version=lS,this.events=new fu,this.initialized=!1,this.storagePrefix=ni,this.ignoredPayloadTypes=[Gf],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Kc(),o=await this.core.crypto.setSymKey(n),c=sr(G.FIVE_MINUTES),h={protocol:Qp},p={topic:o,expiry:c,relay:h,active:!1},f=Q0({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:h});return await this.pairings.set(o,p),await this.core.relayer.subscribe(o),this.core.expirer.set(o,c),{topic:o,uri:f}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:c,relay:h}=Rl(n.uri);let p;if(this.pairings.keys.includes(o)&&(p=this.pairings.get(o),p.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const f=sr(G.FIVE_MINUTES),g={topic:o,relay:h,expiry:f,active:!1};return await this.pairings.set(o,g),this.core.expirer.set(o,f),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Yn.create,g),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(c,o),await this.core.relayer.subscribe(o,{relay:h})),g},this.activate=async({topic:n})=>{this.isInitialized();const o=sr(G.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const c=await this.sendRequest(o,"wc_pairingPing",{}),{done:h,resolve:p,reject:f}=un();this.events.once(Ve("pairing_ping",c),({error:g})=>{g?f(g):p()}),await h()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",at("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,c)=>{const h=xi(o,c),p=await this.core.crypto.encode(n,h),f=Vn[o].req;return this.core.history.set(n,h),this.core.relayer.publish(n,p,f),h.id},this.sendResult=async(n,o,c)=>{const h=zo(n,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,n),g=Vn[f.request.method].res;await this.core.relayer.publish(o,p,g),await this.core.history.resolve(h)},this.sendError=async(n,o,c)=>{const h=du(n,c),p=await this.core.crypto.encode(o,h),f=await this.core.history.get(o,n),g=Vn[f.request.method]?Vn[f.request.method].res:Vn.unregistered_method.res;await this.core.relayer.publish(o,p,g),await this.core.history.resolve(h)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,at("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>ri(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(o,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,c);default:return this.onUnknownRpcMethodRequest(o,c)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:c}=n,h=(await this.core.history.get(o,c.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(o,c);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(n,o)=>{const{id:c}=o;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Yn.ping,{id:c,topic:n})}catch(h){await this.sendError(c,n,h),this.logger.error(h)}},this.onPairingPingResponse=(n,o)=>{const{id:c}=o;setTimeout(()=>{ti(o)?this.events.emit(Ve("pairing_ping",c),{}):or(o)&&this.events.emit(Ve("pairing_ping",c),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:c}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Yn.delete,{id:c,topic:n})}catch(h){await this.sendError(c,n,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:c,method:h}=o;try{if(this.registeredMethods.includes(h))return;const p=at("WC_METHOD_UNSUPPORTED",h);await this.sendError(c,n,p),this.logger.error(p)}catch(p){await this.sendError(c,n,p),this.logger.error(p)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(at("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!Et(n)){const{message:h}=B("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(h)}if(!Y0(n.uri)){const{message:h}=B("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(h)}const c=Rl(n.uri);if(!((o=c==null?void 0:c.relay)!=null&&o.protocol)){const{message:h}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(c!=null&&c.symKey)){const{message:h}=B("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async n=>{if(!Et(n)){const{message:c}=B("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Et(n)){const{message:c}=B("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!hn(n,!1)){const{message:o}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(ri(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=B("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=t,this.logger=Pt(r,this.name),this.pairings=new Vo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return It(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(r,n);try{gu(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):ns(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Jt.expired,async t=>{const{topic:r}=Wf(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Yn.expire,{topic:r}))})}}class LS extends s_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qt.EventEmitter,this.name=fS,this.version=pS,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:c}),this.records.has(o.id))return;const h={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:c,expiry:sr(G.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(yr.created,h)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=or(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(yr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(c=>{if(c.topic===n){if(typeof o<"u"&&c.id!==o)return;this.records.delete(c.id),this.events.emit(yr.deleted,c)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:xi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(n)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(yr.created,t=>{const r=yr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.updated,t=>{const r=yr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(yr.deleted,t=>{const r=yr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{G.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class BS extends l_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qt.EventEmitter,this.name=dS,this.version=gS,this.cached=[],this.initialized=!1,this.storagePrefix=ni,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const c=this.formatTarget(n),h={target:c,expiry:o};this.expirations.set(c,h),this.checkExpiry(c,h),this.events.emit(Jt.created,{target:c,expiration:h})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),c=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Jt.deleted,{target:o,expiration:c})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Pt(r,this.name)}get context(){return It(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return V0(t);if(typeof t=="number")return K0(t);const{message:r}=B("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Jt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(t,r){const{expiry:n}=r;G.toMiliseconds(n)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Jt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(dn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Jt.created,t=>{const r=Jt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.expired,t=>{const r=Jt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Jt.deleted,t=>{const r=Jt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class MS extends f_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=zc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||Z0()||!Jf())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ou;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let c;try{c=await this.fetchAttestation(n.attestationId,o)}catch(h){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(h),c=await this.fetchAttestation(n.attestationId,ou)}return c},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const c=this.startAbortTimer(G.ONE_SECOND*2),h=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),h.status===200?await h.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(c=>{if(document.getElementById(zc))return c();window.addEventListener("message",o);const h=document.createElement("iframe");h.id=zc,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,n=c}),new Promise((c,h)=>setTimeout(()=>{window.removeEventListener("message",o),h("verify iframe load timeout")},G.toMiliseconds(G.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||ln;return yS.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${ln}`),o=ln),o},this.logger=Pt(r,this.name),this.verifyUrl=ln,this.abortController=new AbortController,this.isDevEnv=X0()&&mP.IS_VITEST}get context(){return It(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(t))}}class US extends p_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=vS,this.registerDeviceToken=async n=>{const{clientId:o,token:c,notificationType:h,enableEncrypted:p=!1}=n,f=`${mS}/${this.projectId}/clients`;await vP(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:h,token:c,always_raw:p})})},this.logger=Pt(r,this.context)}}var HS=Object.defineProperty,Rf=Object.getOwnPropertySymbols,kS=Object.prototype.hasOwnProperty,VS=Object.prototype.propertyIsEnumerable,Tf=(s,t,r)=>t in s?HS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Nf=(s,t)=>{for(var r in t||(t={}))kS.call(t,r)&&Tf(s,r,t[r]);if(Rf)for(var r of Rf(t))VS.call(t,r)&&Tf(s,r,t[r]);return s};class xu extends n_{constructor(t){super(t),this.protocol=Wp,this.version=Ux,this.name=Jp,this.events=new Qt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Yp,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Uo(Mo({level:(t==null?void 0:t.logger)||Hx.logger}));this.logger=Pt(r,this.name),this.heartbeat=new dn.HeartBeat,this.crypto=new bS(this,this.logger,t==null?void 0:t.keychain),this.history=new LS(this,this.logger),this.expirer=new BS(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new a1(Nf(Nf({},kx),t==null?void 0:t.storageOptions)),this.relayer=new FS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new zS(this,this.logger),this.verify=new MS(this.projectId||"",this.logger),this.echoClient=new US(this.projectId||"",this.logger)}static async init(t){const r=new xu(t);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(oS,n),r}get context(){return It(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const KS=xu,Zp="wc",Xp=2,ed="client",Su=`${Zp}@${Xp}:${ed}:`,Bc={name:ed,logger:"error"},Ff="WALLETCONNECT_DEEPLINK_CHOICE",GS="proposal",td="Proposal expired",WS="session",So=G.SEVEN_DAYS,JS="engine",Gn={wc_sessionPropose:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1104},res:{ttl:G.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1106},res:{ttl:G.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1112},res:{ttl:G.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1115}}},Mc={min:G.FIVE_MINUTES,max:G.SEVEN_DAYS},jr={idle:"IDLE",active:"ACTIVE"},QS="request",YS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var ZS=Object.defineProperty,XS=Object.defineProperties,e2=Object.getOwnPropertyDescriptors,Df=Object.getOwnPropertySymbols,t2=Object.prototype.hasOwnProperty,r2=Object.prototype.propertyIsEnumerable,qf=(s,t,r)=>t in s?ZS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,bt=(s,t)=>{for(var r in t||(t={}))t2.call(t,r)&&qf(s,r,t[r]);if(Df)for(var r of Df(t))r2.call(t,r)&&qf(s,r,t[r]);return s},Wn=(s,t)=>XS(s,e2(t));class i2 extends g_{constructor(t){super(t),this.name=JS,this.events=new fu,this.initialized=!1,this.ignoredPayloadTypes=[Gf],this.requestQueue={state:jr.idle,queue:[]},this.sessionRequestQueue={state:jr.idle,queue:[]},this.requestQueueDelay=G.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Gn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const n=Wn(bt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:c,optionalNamespaces:h,sessionProperties:p,relays:f}=n;let g=o,v,b=!1;if(g&&(b=this.client.core.pairing.pairings.get(g).active),!g||!b){const{topic:N,uri:z}=await this.client.core.pairing.create();g=N,v=z}const E=await this.client.core.crypto.generateKeyPair(),A=bt({requiredNamespaces:c,optionalNamespaces:h,relays:f??[{protocol:Qp}],proposer:{publicKey:E,metadata:this.client.metadata}},p&&{sessionProperties:p}),{reject:S,resolve:D,done:k}=un(G.FIVE_MINUTES,td);if(this.events.once(Ve("session_connect"),async({error:N,session:z})=>{if(N)S(N);else if(z){z.self.publicKey=E;const Q=Wn(bt({},z),{requiredNamespaces:z.requiredNamespaces,optionalNamespaces:z.optionalNamespaces});await this.client.session.set(z.topic,Q),await this.setExpiry(z.topic,z.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:z.peer.metadata}),D(Q)}}),!g){const{message:N}=B("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(N)}const U=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:A}),J=sr(G.FIVE_MINUTES);return await this.setProposal(U,bt({id:U,expiry:J},A)),{uri:v,approval:k}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:o,namespaces:c,sessionProperties:h}=r,p=this.client.proposal.get(n);let{pairingTopic:f,proposer:g,requiredNamespaces:v,optionalNamespaces:b}=p;f=f||"",Co(v)||(v=nb(c,"approve()"));const E=await this.client.core.crypto.generateKeyPair(),A=g.publicKey,S=await this.client.core.crypto.generateSharedKey(E,A);f&&n&&(await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.sendResult({id:n,topic:f,result:{relay:{protocol:o??"irn"},responderPublicKey:E}}),await this.client.proposal.delete(n,at("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:f}));const D=bt({relay:{protocol:o??"irn"},namespaces:c,requiredNamespaces:v,optionalNamespaces:b,pairingTopic:f,controller:{publicKey:E,metadata:this.client.metadata},expiry:sr(So)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(S),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:D,throwOnFailedPublish:!0});const k=Wn(bt({},D),{topic:S,pairingTopic:f,acknowledged:!1,self:D.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:E});return await this.client.session.set(S,k),await this.setExpiry(S,sr(So)),{topic:S,acknowledged:()=>new Promise(U=>setTimeout(()=>U(this.client.session.get(S)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:n,reason:o}=r,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,o),await this.client.proposal.delete(n,at("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:o}=r,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:h,resolve:p,reject:f}=un();return this.events.once(Ve("session_update",c),({error:g})=>{g?f(g):p()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:h,reject:p}=un();return this.events.once(Ve("session_extend",o),({error:f})=>{f?p(f):h()}),await this.setExpiry(n,sr(So)),{acknowledged:c}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:o,topic:c,expiry:h}=r,p=Sb(),{done:f,resolve:g,reject:v}=un(h,"Request expired. Please try again.");return this.events.once(Ve("session_request",p),({error:b,result:E})=>{b?v(b):g(E)}),await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:p,topic:c,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:h,throwOnFailedPublish:!0}).catch(E=>v(E)),this.client.events.emit("session_request_sent",{topic:c,request:o,chainId:n,id:p}),b()}),new Promise(async b=>{const E=await sb(this.client.core.storage,Ff);ob({id:p,topic:c,wcDeepLink:E}),b()}),f()]).then(b=>b[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:o}=r,{id:c}=o;ti(o)?await this.sendResult({id:c,topic:n,result:o.result,throwOnFailedPublish:!0}):or(o)&&await this.sendError(c,n,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:h,reject:p}=un();this.events.once(Ve("session_ping",o),({error:f})=>{f?p(f):h()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:o,chainId:c}=r;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:c}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:at("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>ab(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(c=>{var h,p;return((h=c.peerMetadata)==null?void 0:h.url)&&((p=c.peerMetadata)==null?void 0:p.url)===r.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,at("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Ff).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===r&&this.deletePendingSessionRequest(c.id,at("USER_DISCONNECTED"))})},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,at("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==r),o&&(this.sessionRequestQueue.state=jr.idle)},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Gn.wc_sessionRequest.req.ttl,{id:o,topic:c,params:h,verifyContext:p}=r;await this.client.pendingRequest.set(o,{id:o,topic:c,params:h,verifyContext:p}),n&&this.client.core.expirer.set(o,sr(n))},this.sendRequest=async r=>{const{topic:n,method:o,params:c,expiry:h,relayRpcId:p,clientRpcId:f,throwOnFailedPublish:g}=r,v=xi(o,c,f);if(Jf()&&YS.includes(o)){const A=fn(JSON.stringify(v));this.client.core.verify.register({attestationId:A})}const b=await this.client.core.crypto.encode(n,v),E=Gn[o].req;return h&&(E.ttl=h),p&&(E.id=p),this.client.core.history.set(n,v),g?(E.internal=Wn(bt({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,b,E)):this.client.core.relayer.publish(n,b,E).catch(A=>this.client.logger.error(A)),v.id},this.sendResult=async r=>{const{id:n,topic:o,result:c,throwOnFailedPublish:h}=r,p=zo(n,c),f=await this.client.core.crypto.encode(o,p),g=await this.client.core.history.get(o,n),v=Gn[g.request.method].res;h?(v.internal=Wn(bt({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,f,v)):this.client.core.relayer.publish(o,f,v).catch(b=>this.client.logger.error(b)),await this.client.core.history.resolve(p)},this.sendError=async(r,n,o)=>{const c=du(r,o),h=await this.client.core.crypto.encode(n,c),p=await this.client.core.history.get(n,r),f=Gn[p.request.method].res;this.client.core.relayer.publish(n,h,f),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(o=>{ri(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{ri(o.expiry)&&n.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===jr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=jr.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=jr.idle},this.processRequest=r=>{const{topic:n,payload:o}=r,c=o.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:o}=r,c=(await this.client.core.history.get(n,o.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:o}=B("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,n)=>{const{params:o,id:c}=n;try{this.isValidConnect(bt({},n.params));const h=sr(G.FIVE_MINUTES),p=bt({id:c,pairingTopic:r,expiry:h},o);await this.setProposal(c,p);const f=fn(JSON.stringify(n)),g=await this.getVerifyContext(f,p.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:p,verifyContext:g})}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,n)=>{const{id:o}=n;if(ti(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const h=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const p=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:p});const f=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const g=await this.client.core.crypto.generateSharedKey(p,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const v=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:v}),await this.client.core.pairing.activate({topic:r})}else or(n)&&(await this.client.proposal.delete(o,at("USER_DISCONNECTED")),this.events.emit(Ve("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:h,controller:p,expiry:f,namespaces:g,requiredNamespaces:v,optionalNamespaces:b,sessionProperties:E,pairingTopic:A}=n.params,S=bt({topic:r,relay:h,expiry:f,namespaces:g,acknowledged:!0,pairingTopic:A,requiredNamespaces:v,optionalNamespaces:b,controller:p.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:p.publicKey,metadata:p.metadata}},E&&{sessionProperties:E});await this.sendResult({id:n.id,topic:r,result:!0}),this.events.emit(Ve("session_connect"),{session:S}),this.cleanupDuplicatePairings(S)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,n)=>{const{id:o}=n;ti(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ve("session_approve",o),{})):or(n)&&(await this.client.session.delete(r,at("USER_DISCONNECTED")),this.events.emit(Ve("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:o,id:c}=n;try{const h=`${r}_session_update`,p=wo.get(h);if(p&&this.isRequestOutOfSync(p,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(bt({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:c,topic:r,result:!0}),this.client.events.emit("session_update",{id:c,topic:r,params:o}),wo.set(h,c)}catch(h){await this.sendError(c,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ve("session_update",o),{}):or(n)&&this.events.emit(Ve("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:o}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,sr(So)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ve("session_extend",o),{}):or(n)&&this.events.emit(Ve("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:o}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,n)=>{const{id:o}=n;setTimeout(()=>{ti(n)?this.events.emit(Ve("session_ping",o),{}):or(n)&&this.events.emit(Ve("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(ct.publish,async()=>{c(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(r,n)=>{const{id:o,params:c}=n;try{this.isValidRequest(bt({topic:r},c));const h=fn(JSON.stringify(xi("wc_sessionRequest",c,o))),p=this.client.session.get(r),f=await this.getVerifyContext(h,p.peer.metadata),g={id:o,topic:r,params:c,verifyContext:f};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,n)=>{const{id:o}=n;ti(n)?this.events.emit(Ve("session_request",o),{result:n.result}):or(n)&&this.events.emit(Ve("session_request",o),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:o,params:c}=n;try{const h=`${r}_session_event_${c.event.name}`,p=wo.get(h);if(p&&this.isRequestOutOfSync(p,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(bt({topic:r},c)),this.client.events.emit("session_event",{id:o,topic:r,params:c}),wo.set(h,o)}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=jr.idle,this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===jr.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=jr.active,this.client.events.emit("session_request",r)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=r=>{if(r.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);n&&this.onSessionProposeRequest(r.topic,xi("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async r=>{if(!Et(r)){const{message:f}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(f)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:c,sessionProperties:h,relays:p}=r;if(ii(n)||await this.isValidPairingTopic(n),!cb(p)){const{message:f}=B("MISSING_OR_INVALID",`connect() relays: ${p}`);throw new Error(f)}!ii(o)&&Co(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!ii(c)&&Co(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),ii(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,n)=>{const o=ub(r,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!Et(r))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:o,relayProtocol:c,sessionProperties:h}=r;await this.isValidProposalId(n);const p=this.client.proposal.get(n),f=Ec(o,"approve()");if(f)throw new Error(f.message);const g=Tl(p.requiredNamespaces,o,"approve()");if(g)throw new Error(g.message);if(!hn(c,!0)){const{message:v}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(v)}ii(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!Et(r)){const{message:c}=B("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:n,reason:o}=r;if(await this.isValidProposalId(n),!hb(o)){const{message:c}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!Et(r)){const{message:g}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:n,controller:o,namespaces:c,expiry:h}=r;if(!lb(n)){const{message:g}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const p=fb(o,"onSessionSettleRequest()");if(p)throw new Error(p.message);const f=Ec(c,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(ri(h)){const{message:g}=B("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!Et(r)){const{message:f}=B("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:n,namespaces:o}=r;await this.isValidSessionTopic(n);const c=this.client.session.get(n),h=Ec(o,"update()");if(h)throw new Error(h.message);const p=Tl(c.requiredNamespaces,o,"update()");if(p)throw new Error(p.message)},this.isValidExtend=async r=>{if(!Et(r)){const{message:o}=B("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!Et(r)){const{message:f}=B("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:n,request:o,chainId:c,expiry:h}=r;await this.isValidSessionTopic(n);const{namespaces:p}=this.client.session.get(n);if(!Nl(p,c)){const{message:f}=B("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(f)}if(!pb(o)){const{message:f}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(f)}if(!db(p,c,o.method)){const{message:f}=B("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(f)}if(h&&!gb(h,Mc)){const{message:f}=B("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${Mc.min} and ${Mc.max}`);throw new Error(f)}},this.isValidRespond=async r=>{var n;if(!Et(r)){const{message:h}=B("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:o,response:c}=r;try{await this.isValidSessionTopic(o)}catch(h){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),h}if(!yb(c)){const{message:h}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!Et(r)){const{message:o}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!Et(r)){const{message:p}=B("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(p)}const{topic:n,event:o,chainId:c}=r;await this.isValidSessionTopic(n);const{namespaces:h}=this.client.session.get(n);if(!Nl(h,c)){const{message:p}=B("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(p)}if(!vb(o)){const{message:p}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}if(!mb(h,c,o.name)){const{message:p}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(p)}},this.isValidDisconnect=async r=>{if(!Et(r)){const{message:o}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const o={verified:{verifyUrl:n.verifyUrl||ln,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});c&&(o.verified.origin=c.origin,o.verified.isScam=c.isScam,o.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(o=>{if(!hn(o,!1)){const{message:c}=B("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ct.message,async t=>{const{topic:r,message:n}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(r,n);try{gu(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):ns(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Jt.expired,async t=>{const{topic:r,id:n}=Wf(t.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,B("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Yn.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!hn(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=B("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!hn(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=B("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(hn(t,!1)){const{message:r}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!wb(t)){const{message:r}=B("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(ri(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=B("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class n2 extends Vo{constructor(t,r){super(t,r,GS,Su),this.core=t,this.logger=r}}class s2 extends Vo{constructor(t,r){super(t,r,WS,Su),this.core=t,this.logger=r}}class o2 extends Vo{constructor(t,r){super(t,r,QS,Su,n=>n.id),this.core=t,this.logger=r}}let a2=class rd extends d_{constructor(t){super(t),this.protocol=Zp,this.version=Xp,this.name=Bc.name,this.events=new Qt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(t==null?void 0:t.name)||Bc.name,this.metadata=(t==null?void 0:t.metadata)||ib();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Uo(Mo({level:(t==null?void 0:t.logger)||Bc.logger}));this.core=(t==null?void 0:t.core)||new KS(t),this.logger=Pt(r,this.name),this.session=new s2(this.core,this.logger),this.proposal=new n2(this.core,this.logger),this.pendingRequest=new o2(this.core,this.logger),this.engine=new i2(this)}static async init(t){const r=new rd(t);return await r.initialize(),r}get context(){return It(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class ai extends Xf{constructor(t){super(t),this.events=new Qt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(xi(t.method,t.params||[],t.id||pu().toString()),r)}async requestStrict(t,r){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(c){o(c)}this.events.on(`${t.id}`,c=>{or(c)?o(c.error):n(c.result)});try{await this.connection.send(t,r)}catch(c){o(c)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ns(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const jf="error",c2="wss://relay.walletconnect.com",u2="wc",h2="universal_provider",zf=`${u2}@2:${h2}:`,l2="https://rpc.walletconnect.com/v1/",zr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Jn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},au={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(s,t){(function(){var r,n="4.17.21",o=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",p="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",g=500,v="__lodash_placeholder__",b=1,E=2,A=4,S=1,D=2,k=1,U=2,J=4,N=8,z=16,Q=32,fe=64,re=128,oe=256,we=512,qt=30,jt="...",xt=800,mr=16,Lr=1,ee=2,q=3,V=1/0,K=9007199254740991,de=17976931348623157e292,le=NaN,ae=4294967295,Oe=ae-1,be=ae>>>1,$e=[["ary",re],["bind",k],["bindKey",U],["curry",N],["curryRight",z],["flip",we],["partial",Q],["partialRight",fe],["rearg",oe]],Y="[object Arguments]",qe="[object Array]",St="[object AsyncFunction]",Ce="[object Boolean]",ze="[object Date]",At="[object DOMException]",ut="[object Error]",Ot="[object Function]",Br="[object GeneratorFunction]",Xe="[object Map]",wr="[object Number]",gn="[object Null]",$t="[object Object]",$i="[object Promise]",Ci="[object Proxy]",ar="[object RegExp]",et="[object Set]",cr="[object String]",br="[object Symbol]",Ri="[object Undefined]",ur="[object WeakMap]",Ti="[object WeakSet]",zt="[object ArrayBuffer]",Lt="[object DataView]",Mr="[object Float32Array]",nt="[object Float64Array]",Ni="[object Int8Array]",Fi="[object Int16Array]",yn="[object Int32Array]",Di="[object Uint8Array]",Ur="[object Uint8ClampedArray]",qi="[object Uint16Array]",ji="[object Uint32Array]",Ko=/\b__p \+= '';/g,_r=/\b(__p \+=) '' \+/g,us=/(__e\(.*?\)|\b__t\)) \+\n'';/g,hs=/&(?:amp|lt|gt|quot|#39);/g,ls=/[&<>"']/g,vn=RegExp(hs.source),ci=RegExp(ls.source),mn=/<%-([\s\S]+?)%>/g,wn=/<%([\s\S]+?)%>/g,zi=/<%=([\s\S]+?)%>/g,ui=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Go=/^\w*$/,Wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bn=/[\\^$.*+?()[\]{}|]/g,Jo=RegExp(bn.source),_n=/^\s+/,fs=/\s/,En=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Er=/\{\n\/\* \[wrapped with (.+)\] \*/,Qo=/,? & /,Yo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zo=/[()=,{}\[\]\/\s]/,Xo=/\\(\\)?/g,ea=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Bt=/\w*$/,ta=/^[-+]0x[0-9a-f]+$/i,ra=/^0b[01]+$/i,ia=/^\[object .+?Constructor\]$/,na=/^0o[0-7]+$/i,sa=/^(?:0|[1-9]\d*)$/,Ir=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Li=/($^)/,oa=/['\n\r\u2028\u2029\\]/g,Bi="\\ud800-\\udfff",aa="\\u0300-\\u036f",ca="\\ufe20-\\ufe2f",Mi="\\u20d0-\\u20ff",ps=aa+ca+Mi,ds="\\u2700-\\u27bf",Yt="a-z\\xdf-\\xf6\\xf8-\\xff",ua="\\xac\\xb1\\xd7\\xf7",ha="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",la="\\u2000-\\u206f",fa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",gs="A-Z\\xc0-\\xd6\\xd8-\\xde",ys="\\ufe0e\\ufe0f",hi=ua+ha+la+fa,In="[']",li="["+Bi+"]",Pn="["+hi+"]",fi="["+ps+"]",vs="\\d+",pa="["+ds+"]",ms="["+Yt+"]",ws="[^"+Bi+hi+vs+ds+Yt+gs+"]",Ui="\\ud83c[\\udffb-\\udfff]",da="(?:"+fi+"|"+Ui+")",bs="[^"+Bi+"]",Hi="(?:\\ud83c[\\udde6-\\uddff]){2}",Hr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ct="["+gs+"]",_s="\\u200d",Es="(?:"+ms+"|"+ws+")",hr="(?:"+Ct+"|"+ws+")",Is="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",Ps="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",xs=da+"?",Ss="["+ys+"]?",ga="(?:"+_s+"(?:"+[bs,Hi,Hr].join("|")+")"+Ss+xs+")*",Pr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",As="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Os=Ss+xs+ga,ki="(?:"+[pa,Hi,Hr].join("|")+")"+Os,ya="(?:"+[bs+fi+"?",fi,Hi,Hr,li].join("|")+")",xn=RegExp(In,"g"),va=RegExp(fi,"g"),Vi=RegExp(Ui+"(?="+Ui+")|"+ya+Os,"g"),$s=RegExp([Ct+"?"+ms+"+"+Is+"(?="+[Pn,Ct,"$"].join("|")+")",hr+"+"+Ps+"(?="+[Pn,Ct+Es,"$"].join("|")+")",Ct+"?"+Es+"+"+Is,Ct+"+"+Ps,As,Pr,vs,ki].join("|"),"g"),Cs=RegExp("["+_s+Bi+ps+ys+"]"),pi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ma=-1,Pe={};Pe[Mr]=Pe[nt]=Pe[Ni]=Pe[Fi]=Pe[yn]=Pe[Di]=Pe[Ur]=Pe[qi]=Pe[ji]=!0,Pe[Y]=Pe[qe]=Pe[zt]=Pe[Ce]=Pe[Lt]=Pe[ze]=Pe[ut]=Pe[Ot]=Pe[Xe]=Pe[wr]=Pe[$t]=Pe[ar]=Pe[et]=Pe[cr]=Pe[ur]=!1;var Ie={};Ie[Y]=Ie[qe]=Ie[zt]=Ie[Lt]=Ie[Ce]=Ie[ze]=Ie[Mr]=Ie[nt]=Ie[Ni]=Ie[Fi]=Ie[yn]=Ie[Xe]=Ie[wr]=Ie[$t]=Ie[ar]=Ie[et]=Ie[cr]=Ie[br]=Ie[Di]=Ie[Ur]=Ie[qi]=Ie[ji]=!0,Ie[ut]=Ie[Ot]=Ie[ur]=!1;var m={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},T={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},L={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xe=parseFloat,ie=parseInt,Re=typeof Jn=="object"&&Jn&&Jn.Object===Object&&Jn,He=typeof self=="object"&&self&&self.Object===Object&&self,ye=Re||He||Function("return this")(),Se=t&&!t.nodeType&&t,Le=Se&&!0&&s&&!s.nodeType&&s,dt=Le&&Le.exports===Se,ke=dt&&Re.process,Te=function(){try{var P=Le&&Le.require&&Le.require("util").types;return P||ke&&ke.binding&&ke.binding("util")}catch{}}(),ht=Te&&Te.isArrayBuffer,Zt=Te&&Te.isDate,Mt=Te&&Te.isMap,lr=Te&&Te.isRegExp,Sn=Te&&Te.isSet,di=Te&&Te.isTypedArray;function Je(P,$,O){switch(O.length){case 0:return P.call($);case 1:return P.call($,O[0]);case 2:return P.call($,O[0],O[1]);case 3:return P.call($,O[0],O[1],O[2])}return P.apply($,O)}function sd(P,$,O,M){for(var te=-1,me=P==null?0:P.length;++te<me;){var Ke=P[te];$(M,Ke,O(Ke),P)}return M}function Ut(P,$){for(var O=-1,M=P==null?0:P.length;++O<M&&$(P[O],O,P)!==!1;);return P}function od(P,$){for(var O=P==null?0:P.length;O--&&$(P[O],O,P)!==!1;);return P}function $u(P,$){for(var O=-1,M=P==null?0:P.length;++O<M;)if(!$(P[O],O,P))return!1;return!0}function kr(P,$){for(var O=-1,M=P==null?0:P.length,te=0,me=[];++O<M;){var Ke=P[O];$(Ke,O,P)&&(me[te++]=Ke)}return me}function Ts(P,$){var O=P==null?0:P.length;return!!O&&Ki(P,$,0)>-1}function wa(P,$,O){for(var M=-1,te=P==null?0:P.length;++M<te;)if(O($,P[M]))return!0;return!1}function Ne(P,$){for(var O=-1,M=P==null?0:P.length,te=Array(M);++O<M;)te[O]=$(P[O],O,P);return te}function Vr(P,$){for(var O=-1,M=$.length,te=P.length;++O<M;)P[te+O]=$[O];return P}function ba(P,$,O,M){var te=-1,me=P==null?0:P.length;for(M&&me&&(O=P[++te]);++te<me;)O=$(O,P[te],te,P);return O}function ad(P,$,O,M){var te=P==null?0:P.length;for(M&&te&&(O=P[--te]);te--;)O=$(O,P[te],te,P);return O}function _a(P,$){for(var O=-1,M=P==null?0:P.length;++O<M;)if($(P[O],O,P))return!0;return!1}var cd=Ea("length");function ud(P){return P.split("")}function hd(P){return P.match(Yo)||[]}function Cu(P,$,O){var M;return O(P,function(te,me,Ke){if($(te,me,Ke))return M=me,!1}),M}function Ns(P,$,O,M){for(var te=P.length,me=O+(M?1:-1);M?me--:++me<te;)if($(P[me],me,P))return me;return-1}function Ki(P,$,O){return $===$?Ed(P,$,O):Ns(P,Ru,O)}function ld(P,$,O,M){for(var te=O-1,me=P.length;++te<me;)if(M(P[te],$))return te;return-1}function Ru(P){return P!==P}function Tu(P,$){var O=P==null?0:P.length;return O?Pa(P,$)/O:le}function Ea(P){return function($){return $==null?r:$[P]}}function Ia(P){return function($){return P==null?r:P[$]}}function Nu(P,$,O,M,te){return te(P,function(me,Ke,Ae){O=M?(M=!1,me):$(O,me,Ke,Ae)}),O}function fd(P,$){var O=P.length;for(P.sort($);O--;)P[O]=P[O].value;return P}function Pa(P,$){for(var O,M=-1,te=P.length;++M<te;){var me=$(P[M]);me!==r&&(O=O===r?me:O+me)}return O}function xa(P,$){for(var O=-1,M=Array(P);++O<P;)M[O]=$(O);return M}function pd(P,$){return Ne($,function(O){return[O,P[O]]})}function Fu(P){return P&&P.slice(0,zu(P)+1).replace(_n,"")}function Rt(P){return function($){return P($)}}function Sa(P,$){return Ne($,function(O){return P[O]})}function An(P,$){return P.has($)}function Du(P,$){for(var O=-1,M=P.length;++O<M&&Ki($,P[O],0)>-1;);return O}function qu(P,$){for(var O=P.length;O--&&Ki($,P[O],0)>-1;);return O}function dd(P,$){for(var O=P.length,M=0;O--;)P[O]===$&&++M;return M}var gd=Ia(m),yd=Ia(I);function vd(P){return"\\"+L[P]}function md(P,$){return P==null?r:P[$]}function Gi(P){return Cs.test(P)}function wd(P){return pi.test(P)}function bd(P){for(var $,O=[];!($=P.next()).done;)O.push($.value);return O}function Aa(P){var $=-1,O=Array(P.size);return P.forEach(function(M,te){O[++$]=[te,M]}),O}function ju(P,$){return function(O){return P($(O))}}function Kr(P,$){for(var O=-1,M=P.length,te=0,me=[];++O<M;){var Ke=P[O];(Ke===$||Ke===v)&&(P[O]=v,me[te++]=O)}return me}function Fs(P){var $=-1,O=Array(P.size);return P.forEach(function(M){O[++$]=M}),O}function _d(P){var $=-1,O=Array(P.size);return P.forEach(function(M){O[++$]=[M,M]}),O}function Ed(P,$,O){for(var M=O-1,te=P.length;++M<te;)if(P[M]===$)return M;return-1}function Id(P,$,O){for(var M=O+1;M--;)if(P[M]===$)return M;return M}function Wi(P){return Gi(P)?xd(P):cd(P)}function Xt(P){return Gi(P)?Sd(P):ud(P)}function zu(P){for(var $=P.length;$--&&fs.test(P.charAt($)););return $}var Pd=Ia(T);function xd(P){for(var $=Vi.lastIndex=0;Vi.test(P);)++$;return $}function Sd(P){return P.match(Vi)||[]}function Ad(P){return P.match($s)||[]}var Od=function P($){$=$==null?ye:Ji.defaults(ye.Object(),$,Ji.pick(ye,Rs));var O=$.Array,M=$.Date,te=$.Error,me=$.Function,Ke=$.Math,Ae=$.Object,Oa=$.RegExp,$d=$.String,Ht=$.TypeError,Ds=O.prototype,Cd=me.prototype,Qi=Ae.prototype,qs=$["__core-js_shared__"],js=Cd.toString,Ee=Qi.hasOwnProperty,Rd=0,Lu=function(){var e=/[^.]+$/.exec(qs&&qs.keys&&qs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),zs=Qi.toString,Td=js.call(Ae),Nd=ye._,Fd=Oa("^"+js.call(Ee).replace(bn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ls=dt?$.Buffer:r,Gr=$.Symbol,Bs=$.Uint8Array,Bu=Ls?Ls.allocUnsafe:r,Ms=ju(Ae.getPrototypeOf,Ae),Mu=Ae.create,Uu=Qi.propertyIsEnumerable,Us=Ds.splice,Hu=Gr?Gr.isConcatSpreadable:r,On=Gr?Gr.iterator:r,gi=Gr?Gr.toStringTag:r,Hs=function(){try{var e=bi(Ae,"defineProperty");return e({},"",{}),e}catch{}}(),Dd=$.clearTimeout!==ye.clearTimeout&&$.clearTimeout,qd=M&&M.now!==ye.Date.now&&M.now,jd=$.setTimeout!==ye.setTimeout&&$.setTimeout,ks=Ke.ceil,Vs=Ke.floor,$a=Ae.getOwnPropertySymbols,zd=Ls?Ls.isBuffer:r,ku=$.isFinite,Ld=Ds.join,Bd=ju(Ae.keys,Ae),Ge=Ke.max,st=Ke.min,Md=M.now,Ud=$.parseInt,Vu=Ke.random,Hd=Ds.reverse,Ca=bi($,"DataView"),$n=bi($,"Map"),Ra=bi($,"Promise"),Yi=bi($,"Set"),Cn=bi($,"WeakMap"),Rn=bi(Ae,"create"),Ks=Cn&&new Cn,Zi={},kd=_i(Ca),Vd=_i($n),Kd=_i(Ra),Gd=_i(Yi),Wd=_i(Cn),Gs=Gr?Gr.prototype:r,Tn=Gs?Gs.valueOf:r,Ku=Gs?Gs.toString:r;function d(e){if(je(e)&&!ne(e)&&!(e instanceof ge)){if(e instanceof kt)return e;if(Ee.call(e,"__wrapped__"))return Gh(e)}return new kt(e)}var Xi=function(){function e(){}return function(i){if(!De(i))return{};if(Mu)return Mu(i);e.prototype=i;var a=new e;return e.prototype=r,a}}();function Ws(){}function kt(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}d.templateSettings={escape:mn,evaluate:wn,interpolate:zi,variable:"",imports:{_:d}},d.prototype=Ws.prototype,d.prototype.constructor=d,kt.prototype=Xi(Ws.prototype),kt.prototype.constructor=kt;function ge(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ae,this.__views__=[]}function Jd(){var e=new ge(this.__wrapped__);return e.__actions__=gt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=gt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=gt(this.__views__),e}function Qd(){if(this.__filtered__){var e=new ge(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Yd(){var e=this.__wrapped__.value(),i=this.__dir__,a=ne(e),u=i<0,l=a?e.length:0,y=uy(0,l,this.__views__),w=y.start,_=y.end,x=_-w,C=u?_:w-1,R=this.__iteratees__,F=R.length,j=0,H=st(x,this.__takeCount__);if(!a||!u&&l==x&&H==x)return yh(e,this.__actions__);var Z=[];e:for(;x--&&j<H;){C+=i;for(var ce=-1,X=e[C];++ce<F;){var pe=R[ce],ve=pe.iteratee,Ft=pe.type,pt=ve(X);if(Ft==ee)X=pt;else if(!pt){if(Ft==Lr)continue e;break e}}Z[j++]=X}return Z}ge.prototype=Xi(Ws.prototype),ge.prototype.constructor=ge;function yi(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function Zd(){this.__data__=Rn?Rn(null):{},this.size=0}function Xd(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function eg(e){var i=this.__data__;if(Rn){var a=i[e];return a===f?r:a}return Ee.call(i,e)?i[e]:r}function tg(e){var i=this.__data__;return Rn?i[e]!==r:Ee.call(i,e)}function rg(e,i){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Rn&&i===r?f:i,this}yi.prototype.clear=Zd,yi.prototype.delete=Xd,yi.prototype.get=eg,yi.prototype.has=tg,yi.prototype.set=rg;function xr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function ig(){this.__data__=[],this.size=0}function ng(e){var i=this.__data__,a=Js(i,e);if(a<0)return!1;var u=i.length-1;return a==u?i.pop():Us.call(i,a,1),--this.size,!0}function sg(e){var i=this.__data__,a=Js(i,e);return a<0?r:i[a][1]}function og(e){return Js(this.__data__,e)>-1}function ag(e,i){var a=this.__data__,u=Js(a,e);return u<0?(++this.size,a.push([e,i])):a[u][1]=i,this}xr.prototype.clear=ig,xr.prototype.delete=ng,xr.prototype.get=sg,xr.prototype.has=og,xr.prototype.set=ag;function Sr(e){var i=-1,a=e==null?0:e.length;for(this.clear();++i<a;){var u=e[i];this.set(u[0],u[1])}}function cg(){this.size=0,this.__data__={hash:new yi,map:new($n||xr),string:new yi}}function ug(e){var i=ao(this,e).delete(e);return this.size-=i?1:0,i}function hg(e){return ao(this,e).get(e)}function lg(e){return ao(this,e).has(e)}function fg(e,i){var a=ao(this,e),u=a.size;return a.set(e,i),this.size+=a.size==u?0:1,this}Sr.prototype.clear=cg,Sr.prototype.delete=ug,Sr.prototype.get=hg,Sr.prototype.has=lg,Sr.prototype.set=fg;function vi(e){var i=-1,a=e==null?0:e.length;for(this.__data__=new Sr;++i<a;)this.add(e[i])}function pg(e){return this.__data__.set(e,f),this}function dg(e){return this.__data__.has(e)}vi.prototype.add=vi.prototype.push=pg,vi.prototype.has=dg;function er(e){var i=this.__data__=new xr(e);this.size=i.size}function gg(){this.__data__=new xr,this.size=0}function yg(e){var i=this.__data__,a=i.delete(e);return this.size=i.size,a}function vg(e){return this.__data__.get(e)}function mg(e){return this.__data__.has(e)}function wg(e,i){var a=this.__data__;if(a instanceof xr){var u=a.__data__;if(!$n||u.length<o-1)return u.push([e,i]),this.size=++a.size,this;a=this.__data__=new Sr(u)}return a.set(e,i),this.size=a.size,this}er.prototype.clear=gg,er.prototype.delete=yg,er.prototype.get=vg,er.prototype.has=mg,er.prototype.set=wg;function Gu(e,i){var a=ne(e),u=!a&&Ei(e),l=!a&&!u&&Zr(e),y=!a&&!u&&!l&&nn(e),w=a||u||l||y,_=w?xa(e.length,$d):[],x=_.length;for(var C in e)(i||Ee.call(e,C))&&!(w&&(C=="length"||l&&(C=="offset"||C=="parent")||y&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Cr(C,x)))&&_.push(C);return _}function Wu(e){var i=e.length;return i?e[Ua(0,i-1)]:r}function bg(e,i){return co(gt(e),mi(i,0,e.length))}function _g(e){return co(gt(e))}function Ta(e,i,a){(a!==r&&!tr(e[i],a)||a===r&&!(i in e))&&Ar(e,i,a)}function Nn(e,i,a){var u=e[i];(!(Ee.call(e,i)&&tr(u,a))||a===r&&!(i in e))&&Ar(e,i,a)}function Js(e,i){for(var a=e.length;a--;)if(tr(e[a][0],i))return a;return-1}function Eg(e,i,a,u){return Wr(e,function(l,y,w){i(u,l,a(l),w)}),u}function Ju(e,i){return e&&pr(i,Qe(i),e)}function Ig(e,i){return e&&pr(i,vt(i),e)}function Ar(e,i,a){i=="__proto__"&&Hs?Hs(e,i,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[i]=a}function Na(e,i){for(var a=-1,u=i.length,l=O(u),y=e==null;++a<u;)l[a]=y?r:pc(e,i[a]);return l}function mi(e,i,a){return e===e&&(a!==r&&(e=e<=a?e:a),i!==r&&(e=e>=i?e:i)),e}function Vt(e,i,a,u,l,y){var w,_=i&b,x=i&E,C=i&A;if(a&&(w=l?a(e,u,l,y):a(e)),w!==r)return w;if(!De(e))return e;var R=ne(e);if(R){if(w=ly(e),!_)return gt(e,w)}else{var F=ot(e),j=F==Ot||F==Br;if(Zr(e))return wh(e,_);if(F==$t||F==Y||j&&!l){if(w=x||j?{}:zh(e),!_)return x?ey(e,Ig(w,e)):Xg(e,Ju(w,e))}else{if(!Ie[F])return l?e:{};w=fy(e,F,_)}}y||(y=new er);var H=y.get(e);if(H)return H;y.set(e,w),pl(e)?e.forEach(function(X){w.add(Vt(X,i,a,X,e,y))}):ll(e)&&e.forEach(function(X,pe){w.set(pe,Vt(X,i,a,pe,e,y))});var Z=C?x?Xa:Za:x?vt:Qe,ce=R?r:Z(e);return Ut(ce||e,function(X,pe){ce&&(pe=X,X=e[pe]),Nn(w,pe,Vt(X,i,a,pe,e,y))}),w}function Pg(e){var i=Qe(e);return function(a){return Qu(a,e,i)}}function Qu(e,i,a){var u=a.length;if(e==null)return!u;for(e=Ae(e);u--;){var l=a[u],y=i[l],w=e[l];if(w===r&&!(l in e)||!y(w))return!1}return!0}function Yu(e,i,a){if(typeof e!="function")throw new Ht(h);return Bn(function(){e.apply(r,a)},i)}function Fn(e,i,a,u){var l=-1,y=Ts,w=!0,_=e.length,x=[],C=i.length;if(!_)return x;a&&(i=Ne(i,Rt(a))),u?(y=wa,w=!1):i.length>=o&&(y=An,w=!1,i=new vi(i));e:for(;++l<_;){var R=e[l],F=a==null?R:a(R);if(R=u||R!==0?R:0,w&&F===F){for(var j=C;j--;)if(i[j]===F)continue e;x.push(R)}else y(i,F,u)||x.push(R)}return x}var Wr=Ph(fr),Zu=Ph(Da,!0);function xg(e,i){var a=!0;return Wr(e,function(u,l,y){return a=!!i(u,l,y),a}),a}function Qs(e,i,a){for(var u=-1,l=e.length;++u<l;){var y=e[u],w=i(y);if(w!=null&&(_===r?w===w&&!Nt(w):a(w,_)))var _=w,x=y}return x}function Sg(e,i,a,u){var l=e.length;for(a=se(a),a<0&&(a=-a>l?0:l+a),u=u===r||u>l?l:se(u),u<0&&(u+=l),u=a>u?0:gl(u);a<u;)e[a++]=i;return e}function Xu(e,i){var a=[];return Wr(e,function(u,l,y){i(u,l,y)&&a.push(u)}),a}function tt(e,i,a,u,l){var y=-1,w=e.length;for(a||(a=dy),l||(l=[]);++y<w;){var _=e[y];i>0&&a(_)?i>1?tt(_,i-1,a,u,l):Vr(l,_):u||(l[l.length]=_)}return l}var Fa=xh(),eh=xh(!0);function fr(e,i){return e&&Fa(e,i,Qe)}function Da(e,i){return e&&eh(e,i,Qe)}function Ys(e,i){return kr(i,function(a){return Rr(e[a])})}function wi(e,i){i=Qr(i,e);for(var a=0,u=i.length;e!=null&&a<u;)e=e[dr(i[a++])];return a&&a==u?e:r}function th(e,i,a){var u=i(e);return ne(e)?u:Vr(u,a(e))}function lt(e){return e==null?e===r?Ri:gn:gi&&gi in Ae(e)?cy(e):_y(e)}function qa(e,i){return e>i}function Ag(e,i){return e!=null&&Ee.call(e,i)}function Og(e,i){return e!=null&&i in Ae(e)}function $g(e,i,a){return e>=st(i,a)&&e<Ge(i,a)}function ja(e,i,a){for(var u=a?wa:Ts,l=e[0].length,y=e.length,w=y,_=O(y),x=1/0,C=[];w--;){var R=e[w];w&&i&&(R=Ne(R,Rt(i))),x=st(R.length,x),_[w]=!a&&(i||l>=120&&R.length>=120)?new vi(w&&R):r}R=e[0];var F=-1,j=_[0];e:for(;++F<l&&C.length<x;){var H=R[F],Z=i?i(H):H;if(H=a||H!==0?H:0,!(j?An(j,Z):u(C,Z,a))){for(w=y;--w;){var ce=_[w];if(!(ce?An(ce,Z):u(e[w],Z,a)))continue e}j&&j.push(Z),C.push(H)}}return C}function Cg(e,i,a,u){return fr(e,function(l,y,w){i(u,a(l),y,w)}),u}function Dn(e,i,a){i=Qr(i,e),e=Uh(e,i);var u=e==null?e:e[dr(Gt(i))];return u==null?r:Je(u,e,a)}function rh(e){return je(e)&&lt(e)==Y}function Rg(e){return je(e)&&lt(e)==zt}function Tg(e){return je(e)&&lt(e)==ze}function qn(e,i,a,u,l){return e===i?!0:e==null||i==null||!je(e)&&!je(i)?e!==e&&i!==i:Ng(e,i,a,u,qn,l)}function Ng(e,i,a,u,l,y){var w=ne(e),_=ne(i),x=w?qe:ot(e),C=_?qe:ot(i);x=x==Y?$t:x,C=C==Y?$t:C;var R=x==$t,F=C==$t,j=x==C;if(j&&Zr(e)){if(!Zr(i))return!1;w=!0,R=!1}if(j&&!R)return y||(y=new er),w||nn(e)?Dh(e,i,a,u,l,y):oy(e,i,x,a,u,l,y);if(!(a&S)){var H=R&&Ee.call(e,"__wrapped__"),Z=F&&Ee.call(i,"__wrapped__");if(H||Z){var ce=H?e.value():e,X=Z?i.value():i;return y||(y=new er),l(ce,X,a,u,y)}}return j?(y||(y=new er),ay(e,i,a,u,l,y)):!1}function Fg(e){return je(e)&&ot(e)==Xe}function za(e,i,a,u){var l=a.length,y=l,w=!u;if(e==null)return!y;for(e=Ae(e);l--;){var _=a[l];if(w&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<y;){_=a[l];var x=_[0],C=e[x],R=_[1];if(w&&_[2]){if(C===r&&!(x in e))return!1}else{var F=new er;if(u)var j=u(C,R,x,e,i,F);if(!(j===r?qn(R,C,S|D,u,F):j))return!1}}return!0}function ih(e){if(!De(e)||yy(e))return!1;var i=Rr(e)?Fd:ia;return i.test(_i(e))}function Dg(e){return je(e)&&lt(e)==ar}function qg(e){return je(e)&&ot(e)==et}function jg(e){return je(e)&&go(e.length)&&!!Pe[lt(e)]}function nh(e){return typeof e=="function"?e:e==null?mt:typeof e=="object"?ne(e)?ah(e[0],e[1]):oh(e):Sl(e)}function La(e){if(!Ln(e))return Bd(e);var i=[];for(var a in Ae(e))Ee.call(e,a)&&a!="constructor"&&i.push(a);return i}function zg(e){if(!De(e))return by(e);var i=Ln(e),a=[];for(var u in e)u=="constructor"&&(i||!Ee.call(e,u))||a.push(u);return a}function Ba(e,i){return e<i}function sh(e,i){var a=-1,u=yt(e)?O(e.length):[];return Wr(e,function(l,y,w){u[++a]=i(l,y,w)}),u}function oh(e){var i=tc(e);return i.length==1&&i[0][2]?Bh(i[0][0],i[0][1]):function(a){return a===e||za(a,e,i)}}function ah(e,i){return ic(e)&&Lh(i)?Bh(dr(e),i):function(a){var u=pc(a,e);return u===r&&u===i?dc(a,e):qn(i,u,S|D)}}function Zs(e,i,a,u,l){e!==i&&Fa(i,function(y,w){if(l||(l=new er),De(y))Lg(e,i,w,a,Zs,u,l);else{var _=u?u(sc(e,w),y,w+"",e,i,l):r;_===r&&(_=y),Ta(e,w,_)}},vt)}function Lg(e,i,a,u,l,y,w){var _=sc(e,a),x=sc(i,a),C=w.get(x);if(C){Ta(e,a,C);return}var R=y?y(_,x,a+"",e,i,w):r,F=R===r;if(F){var j=ne(x),H=!j&&Zr(x),Z=!j&&!H&&nn(x);R=x,j||H||Z?ne(_)?R=_:Be(_)?R=gt(_):H?(F=!1,R=wh(x,!0)):Z?(F=!1,R=bh(x,!0)):R=[]:Mn(x)||Ei(x)?(R=_,Ei(_)?R=yl(_):(!De(_)||Rr(_))&&(R=zh(x))):F=!1}F&&(w.set(x,R),l(R,x,u,y,w),w.delete(x)),Ta(e,a,R)}function ch(e,i){var a=e.length;if(a)return i+=i<0?a:0,Cr(i,a)?e[i]:r}function uh(e,i,a){i.length?i=Ne(i,function(y){return ne(y)?function(w){return wi(w,y.length===1?y[0]:y)}:y}):i=[mt];var u=-1;i=Ne(i,Rt(W()));var l=sh(e,function(y,w,_){var x=Ne(i,function(C){return C(y)});return{criteria:x,index:++u,value:y}});return fd(l,function(y,w){return Zg(y,w,a)})}function Bg(e,i){return hh(e,i,function(a,u){return dc(e,u)})}function hh(e,i,a){for(var u=-1,l=i.length,y={};++u<l;){var w=i[u],_=wi(e,w);a(_,w)&&jn(y,Qr(w,e),_)}return y}function Mg(e){return function(i){return wi(i,e)}}function Ma(e,i,a,u){var l=u?ld:Ki,y=-1,w=i.length,_=e;for(e===i&&(i=gt(i)),a&&(_=Ne(e,Rt(a)));++y<w;)for(var x=0,C=i[y],R=a?a(C):C;(x=l(_,R,x,u))>-1;)_!==e&&Us.call(_,x,1),Us.call(e,x,1);return e}function lh(e,i){for(var a=e?i.length:0,u=a-1;a--;){var l=i[a];if(a==u||l!==y){var y=l;Cr(l)?Us.call(e,l,1):Va(e,l)}}return e}function Ua(e,i){return e+Vs(Vu()*(i-e+1))}function Ug(e,i,a,u){for(var l=-1,y=Ge(ks((i-e)/(a||1)),0),w=O(y);y--;)w[u?y:++l]=e,e+=a;return w}function Ha(e,i){var a="";if(!e||i<1||i>K)return a;do i%2&&(a+=e),i=Vs(i/2),i&&(e+=e);while(i);return a}function he(e,i){return oc(Mh(e,i,mt),e+"")}function Hg(e){return Wu(sn(e))}function kg(e,i){var a=sn(e);return co(a,mi(i,0,a.length))}function jn(e,i,a,u){if(!De(e))return e;i=Qr(i,e);for(var l=-1,y=i.length,w=y-1,_=e;_!=null&&++l<y;){var x=dr(i[l]),C=a;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(l!=w){var R=_[x];C=u?u(R,x,_):r,C===r&&(C=De(R)?R:Cr(i[l+1])?[]:{})}Nn(_,x,C),_=_[x]}return e}var fh=Ks?function(e,i){return Ks.set(e,i),e}:mt,Vg=Hs?function(e,i){return Hs(e,"toString",{configurable:!0,enumerable:!1,value:yc(i),writable:!0})}:mt;function Kg(e){return co(sn(e))}function Kt(e,i,a){var u=-1,l=e.length;i<0&&(i=-i>l?0:l+i),a=a>l?l:a,a<0&&(a+=l),l=i>a?0:a-i>>>0,i>>>=0;for(var y=O(l);++u<l;)y[u]=e[u+i];return y}function Gg(e,i){var a;return Wr(e,function(u,l,y){return a=i(u,l,y),!a}),!!a}function Xs(e,i,a){var u=0,l=e==null?u:e.length;if(typeof i=="number"&&i===i&&l<=be){for(;u<l;){var y=u+l>>>1,w=e[y];w!==null&&!Nt(w)&&(a?w<=i:w<i)?u=y+1:l=y}return l}return ka(e,i,mt,a)}function ka(e,i,a,u){var l=0,y=e==null?0:e.length;if(y===0)return 0;i=a(i);for(var w=i!==i,_=i===null,x=Nt(i),C=i===r;l<y;){var R=Vs((l+y)/2),F=a(e[R]),j=F!==r,H=F===null,Z=F===F,ce=Nt(F);if(w)var X=u||Z;else C?X=Z&&(u||j):_?X=Z&&j&&(u||!H):x?X=Z&&j&&!H&&(u||!ce):H||ce?X=!1:X=u?F<=i:F<i;X?l=R+1:y=R}return st(y,Oe)}function ph(e,i){for(var a=-1,u=e.length,l=0,y=[];++a<u;){var w=e[a],_=i?i(w):w;if(!a||!tr(_,x)){var x=_;y[l++]=w===0?0:w}}return y}function dh(e){return typeof e=="number"?e:Nt(e)?le:+e}function Tt(e){if(typeof e=="string")return e;if(ne(e))return Ne(e,Tt)+"";if(Nt(e))return Ku?Ku.call(e):"";var i=e+"";return i=="0"&&1/e==-V?"-0":i}function Jr(e,i,a){var u=-1,l=Ts,y=e.length,w=!0,_=[],x=_;if(a)w=!1,l=wa;else if(y>=o){var C=i?null:ny(e);if(C)return Fs(C);w=!1,l=An,x=new vi}else x=i?[]:_;e:for(;++u<y;){var R=e[u],F=i?i(R):R;if(R=a||R!==0?R:0,w&&F===F){for(var j=x.length;j--;)if(x[j]===F)continue e;i&&x.push(F),_.push(R)}else l(x,F,a)||(x!==_&&x.push(F),_.push(R))}return _}function Va(e,i){return i=Qr(i,e),e=Uh(e,i),e==null||delete e[dr(Gt(i))]}function gh(e,i,a,u){return jn(e,i,a(wi(e,i)),u)}function eo(e,i,a,u){for(var l=e.length,y=u?l:-1;(u?y--:++y<l)&&i(e[y],y,e););return a?Kt(e,u?0:y,u?y+1:l):Kt(e,u?y+1:0,u?l:y)}function yh(e,i){var a=e;return a instanceof ge&&(a=a.value()),ba(i,function(u,l){return l.func.apply(l.thisArg,Vr([u],l.args))},a)}function Ka(e,i,a){var u=e.length;if(u<2)return u?Jr(e[0]):[];for(var l=-1,y=O(u);++l<u;)for(var w=e[l],_=-1;++_<u;)_!=l&&(y[l]=Fn(y[l]||w,e[_],i,a));return Jr(tt(y,1),i,a)}function vh(e,i,a){for(var u=-1,l=e.length,y=i.length,w={};++u<l;){var _=u<y?i[u]:r;a(w,e[u],_)}return w}function Ga(e){return Be(e)?e:[]}function Wa(e){return typeof e=="function"?e:mt}function Qr(e,i){return ne(e)?e:ic(e,i)?[e]:Kh(_e(e))}var Wg=he;function Yr(e,i,a){var u=e.length;return a=a===r?u:a,!i&&a>=u?e:Kt(e,i,a)}var mh=Dd||function(e){return ye.clearTimeout(e)};function wh(e,i){if(i)return e.slice();var a=e.length,u=Bu?Bu(a):new e.constructor(a);return e.copy(u),u}function Ja(e){var i=new e.constructor(e.byteLength);return new Bs(i).set(new Bs(e)),i}function Jg(e,i){var a=i?Ja(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.byteLength)}function Qg(e){var i=new e.constructor(e.source,Bt.exec(e));return i.lastIndex=e.lastIndex,i}function Yg(e){return Tn?Ae(Tn.call(e)):{}}function bh(e,i){var a=i?Ja(e.buffer):e.buffer;return new e.constructor(a,e.byteOffset,e.length)}function _h(e,i){if(e!==i){var a=e!==r,u=e===null,l=e===e,y=Nt(e),w=i!==r,_=i===null,x=i===i,C=Nt(i);if(!_&&!C&&!y&&e>i||y&&w&&x&&!_&&!C||u&&w&&x||!a&&x||!l)return 1;if(!u&&!y&&!C&&e<i||C&&a&&l&&!u&&!y||_&&a&&l||!w&&l||!x)return-1}return 0}function Zg(e,i,a){for(var u=-1,l=e.criteria,y=i.criteria,w=l.length,_=a.length;++u<w;){var x=_h(l[u],y[u]);if(x){if(u>=_)return x;var C=a[u];return x*(C=="desc"?-1:1)}}return e.index-i.index}function Eh(e,i,a,u){for(var l=-1,y=e.length,w=a.length,_=-1,x=i.length,C=Ge(y-w,0),R=O(x+C),F=!u;++_<x;)R[_]=i[_];for(;++l<w;)(F||l<y)&&(R[a[l]]=e[l]);for(;C--;)R[_++]=e[l++];return R}function Ih(e,i,a,u){for(var l=-1,y=e.length,w=-1,_=a.length,x=-1,C=i.length,R=Ge(y-_,0),F=O(R+C),j=!u;++l<R;)F[l]=e[l];for(var H=l;++x<C;)F[H+x]=i[x];for(;++w<_;)(j||l<y)&&(F[H+a[w]]=e[l++]);return F}function gt(e,i){var a=-1,u=e.length;for(i||(i=O(u));++a<u;)i[a]=e[a];return i}function pr(e,i,a,u){var l=!a;a||(a={});for(var y=-1,w=i.length;++y<w;){var _=i[y],x=u?u(a[_],e[_],_,a,e):r;x===r&&(x=e[_]),l?Ar(a,_,x):Nn(a,_,x)}return a}function Xg(e,i){return pr(e,rc(e),i)}function ey(e,i){return pr(e,qh(e),i)}function to(e,i){return function(a,u){var l=ne(a)?sd:Eg,y=i?i():{};return l(a,e,W(u,2),y)}}function en(e){return he(function(i,a){var u=-1,l=a.length,y=l>1?a[l-1]:r,w=l>2?a[2]:r;for(y=e.length>3&&typeof y=="function"?(l--,y):r,w&&ft(a[0],a[1],w)&&(y=l<3?r:y,l=1),i=Ae(i);++u<l;){var _=a[u];_&&e(i,_,u,y)}return i})}function Ph(e,i){return function(a,u){if(a==null)return a;if(!yt(a))return e(a,u);for(var l=a.length,y=i?l:-1,w=Ae(a);(i?y--:++y<l)&&u(w[y],y,w)!==!1;);return a}}function xh(e){return function(i,a,u){for(var l=-1,y=Ae(i),w=u(i),_=w.length;_--;){var x=w[e?_:++l];if(a(y[x],x,y)===!1)break}return i}}function ty(e,i,a){var u=i&k,l=zn(e);function y(){var w=this&&this!==ye&&this instanceof y?l:e;return w.apply(u?a:this,arguments)}return y}function Sh(e){return function(i){i=_e(i);var a=Gi(i)?Xt(i):r,u=a?a[0]:i.charAt(0),l=a?Yr(a,1).join(""):i.slice(1);return u[e]()+l}}function tn(e){return function(i){return ba(Pl(Il(i).replace(xn,"")),e,"")}}function zn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var a=Xi(e.prototype),u=e.apply(a,i);return De(u)?u:a}}function ry(e,i,a){var u=zn(e);function l(){for(var y=arguments.length,w=O(y),_=y,x=rn(l);_--;)w[_]=arguments[_];var C=y<3&&w[0]!==x&&w[y-1]!==x?[]:Kr(w,x);if(y-=C.length,y<a)return Rh(e,i,ro,l.placeholder,r,w,C,r,r,a-y);var R=this&&this!==ye&&this instanceof l?u:e;return Je(R,this,w)}return l}function Ah(e){return function(i,a,u){var l=Ae(i);if(!yt(i)){var y=W(a,3);i=Qe(i),a=function(_){return y(l[_],_,l)}}var w=e(i,a,u);return w>-1?l[y?i[w]:w]:r}}function Oh(e){return $r(function(i){var a=i.length,u=a,l=kt.prototype.thru;for(e&&i.reverse();u--;){var y=i[u];if(typeof y!="function")throw new Ht(h);if(l&&!w&&oo(y)=="wrapper")var w=new kt([],!0)}for(u=w?u:a;++u<a;){y=i[u];var _=oo(y),x=_=="wrapper"?ec(y):r;x&&nc(x[0])&&x[1]==(re|N|Q|oe)&&!x[4].length&&x[9]==1?w=w[oo(x[0])].apply(w,x[3]):w=y.length==1&&nc(y)?w[_]():w.thru(y)}return function(){var C=arguments,R=C[0];if(w&&C.length==1&&ne(R))return w.plant(R).value();for(var F=0,j=a?i[F].apply(this,C):R;++F<a;)j=i[F].call(this,j);return j}})}function ro(e,i,a,u,l,y,w,_,x,C){var R=i&re,F=i&k,j=i&U,H=i&(N|z),Z=i&we,ce=j?r:zn(e);function X(){for(var pe=arguments.length,ve=O(pe),Ft=pe;Ft--;)ve[Ft]=arguments[Ft];if(H)var pt=rn(X),Dt=dd(ve,pt);if(u&&(ve=Eh(ve,u,l,H)),y&&(ve=Ih(ve,y,w,H)),pe-=Dt,H&&pe<C){var Me=Kr(ve,pt);return Rh(e,i,ro,X.placeholder,a,ve,Me,_,x,C-pe)}var rr=F?a:this,Nr=j?rr[e]:e;return pe=ve.length,_?ve=Ey(ve,_):Z&&pe>1&&ve.reverse(),R&&x<pe&&(ve.length=x),this&&this!==ye&&this instanceof X&&(Nr=ce||zn(Nr)),Nr.apply(rr,ve)}return X}function $h(e,i){return function(a,u){return Cg(a,e,i(u),{})}}function io(e,i){return function(a,u){var l;if(a===r&&u===r)return i;if(a!==r&&(l=a),u!==r){if(l===r)return u;typeof a=="string"||typeof u=="string"?(a=Tt(a),u=Tt(u)):(a=dh(a),u=dh(u)),l=e(a,u)}return l}}function Qa(e){return $r(function(i){return i=Ne(i,Rt(W())),he(function(a){var u=this;return e(i,function(l){return Je(l,u,a)})})})}function no(e,i){i=i===r?" ":Tt(i);var a=i.length;if(a<2)return a?Ha(i,e):i;var u=Ha(i,ks(e/Wi(i)));return Gi(i)?Yr(Xt(u),0,e).join(""):u.slice(0,e)}function iy(e,i,a,u){var l=i&k,y=zn(e);function w(){for(var _=-1,x=arguments.length,C=-1,R=u.length,F=O(R+x),j=this&&this!==ye&&this instanceof w?y:e;++C<R;)F[C]=u[C];for(;x--;)F[C++]=arguments[++_];return Je(j,l?a:this,F)}return w}function Ch(e){return function(i,a,u){return u&&typeof u!="number"&&ft(i,a,u)&&(a=u=r),i=Tr(i),a===r?(a=i,i=0):a=Tr(a),u=u===r?i<a?1:-1:Tr(u),Ug(i,a,u,e)}}function so(e){return function(i,a){return typeof i=="string"&&typeof a=="string"||(i=Wt(i),a=Wt(a)),e(i,a)}}function Rh(e,i,a,u,l,y,w,_,x,C){var R=i&N,F=R?w:r,j=R?r:w,H=R?y:r,Z=R?r:y;i|=R?Q:fe,i&=~(R?fe:Q),i&J||(i&=-4);var ce=[e,i,l,H,F,Z,j,_,x,C],X=a.apply(r,ce);return nc(e)&&Hh(X,ce),X.placeholder=u,kh(X,e,i)}function Ya(e){var i=Ke[e];return function(a,u){if(a=Wt(a),u=u==null?0:st(se(u),292),u&&ku(a)){var l=(_e(a)+"e").split("e"),y=i(l[0]+"e"+(+l[1]+u));return l=(_e(y)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return i(a)}}var ny=Yi&&1/Fs(new Yi([,-0]))[1]==V?function(e){return new Yi(e)}:wc;function Th(e){return function(i){var a=ot(i);return a==Xe?Aa(i):a==et?_d(i):pd(i,e(i))}}function Or(e,i,a,u,l,y,w,_){var x=i&U;if(!x&&typeof e!="function")throw new Ht(h);var C=u?u.length:0;if(C||(i&=-97,u=l=r),w=w===r?w:Ge(se(w),0),_=_===r?_:se(_),C-=l?l.length:0,i&fe){var R=u,F=l;u=l=r}var j=x?r:ec(e),H=[e,i,a,u,l,R,F,y,w,_];if(j&&wy(H,j),e=H[0],i=H[1],a=H[2],u=H[3],l=H[4],_=H[9]=H[9]===r?x?0:e.length:Ge(H[9]-C,0),!_&&i&(N|z)&&(i&=-25),!i||i==k)var Z=ty(e,i,a);else i==N||i==z?Z=ry(e,i,_):(i==Q||i==(k|Q))&&!l.length?Z=iy(e,i,a,u):Z=ro.apply(r,H);var ce=j?fh:Hh;return kh(ce(Z,H),e,i)}function Nh(e,i,a,u){return e===r||tr(e,Qi[a])&&!Ee.call(u,a)?i:e}function Fh(e,i,a,u,l,y){return De(e)&&De(i)&&(y.set(i,e),Zs(e,i,r,Fh,y),y.delete(i)),e}function sy(e){return Mn(e)?r:e}function Dh(e,i,a,u,l,y){var w=a&S,_=e.length,x=i.length;if(_!=x&&!(w&&x>_))return!1;var C=y.get(e),R=y.get(i);if(C&&R)return C==i&&R==e;var F=-1,j=!0,H=a&D?new vi:r;for(y.set(e,i),y.set(i,e);++F<_;){var Z=e[F],ce=i[F];if(u)var X=w?u(ce,Z,F,i,e,y):u(Z,ce,F,e,i,y);if(X!==r){if(X)continue;j=!1;break}if(H){if(!_a(i,function(pe,ve){if(!An(H,ve)&&(Z===pe||l(Z,pe,a,u,y)))return H.push(ve)})){j=!1;break}}else if(!(Z===ce||l(Z,ce,a,u,y))){j=!1;break}}return y.delete(e),y.delete(i),j}function oy(e,i,a,u,l,y,w){switch(a){case Lt:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case zt:return!(e.byteLength!=i.byteLength||!y(new Bs(e),new Bs(i)));case Ce:case ze:case wr:return tr(+e,+i);case ut:return e.name==i.name&&e.message==i.message;case ar:case cr:return e==i+"";case Xe:var _=Aa;case et:var x=u&S;if(_||(_=Fs),e.size!=i.size&&!x)return!1;var C=w.get(e);if(C)return C==i;u|=D,w.set(e,i);var R=Dh(_(e),_(i),u,l,y,w);return w.delete(e),R;case br:if(Tn)return Tn.call(e)==Tn.call(i)}return!1}function ay(e,i,a,u,l,y){var w=a&S,_=Za(e),x=_.length,C=Za(i),R=C.length;if(x!=R&&!w)return!1;for(var F=x;F--;){var j=_[F];if(!(w?j in i:Ee.call(i,j)))return!1}var H=y.get(e),Z=y.get(i);if(H&&Z)return H==i&&Z==e;var ce=!0;y.set(e,i),y.set(i,e);for(var X=w;++F<x;){j=_[F];var pe=e[j],ve=i[j];if(u)var Ft=w?u(ve,pe,j,i,e,y):u(pe,ve,j,e,i,y);if(!(Ft===r?pe===ve||l(pe,ve,a,u,y):Ft)){ce=!1;break}X||(X=j=="constructor")}if(ce&&!X){var pt=e.constructor,Dt=i.constructor;pt!=Dt&&"constructor"in e&&"constructor"in i&&!(typeof pt=="function"&&pt instanceof pt&&typeof Dt=="function"&&Dt instanceof Dt)&&(ce=!1)}return y.delete(e),y.delete(i),ce}function $r(e){return oc(Mh(e,r,Qh),e+"")}function Za(e){return th(e,Qe,rc)}function Xa(e){return th(e,vt,qh)}var ec=Ks?function(e){return Ks.get(e)}:wc;function oo(e){for(var i=e.name+"",a=Zi[i],u=Ee.call(Zi,i)?a.length:0;u--;){var l=a[u],y=l.func;if(y==null||y==e)return l.name}return i}function rn(e){var i=Ee.call(d,"placeholder")?d:e;return i.placeholder}function W(){var e=d.iteratee||vc;return e=e===vc?nh:e,arguments.length?e(arguments[0],arguments[1]):e}function ao(e,i){var a=e.__data__;return gy(i)?a[typeof i=="string"?"string":"hash"]:a.map}function tc(e){for(var i=Qe(e),a=i.length;a--;){var u=i[a],l=e[u];i[a]=[u,l,Lh(l)]}return i}function bi(e,i){var a=md(e,i);return ih(a)?a:r}function cy(e){var i=Ee.call(e,gi),a=e[gi];try{e[gi]=r;var u=!0}catch{}var l=zs.call(e);return u&&(i?e[gi]=a:delete e[gi]),l}var rc=$a?function(e){return e==null?[]:(e=Ae(e),kr($a(e),function(i){return Uu.call(e,i)}))}:bc,qh=$a?function(e){for(var i=[];e;)Vr(i,rc(e)),e=Ms(e);return i}:bc,ot=lt;(Ca&&ot(new Ca(new ArrayBuffer(1)))!=Lt||$n&&ot(new $n)!=Xe||Ra&&ot(Ra.resolve())!=$i||Yi&&ot(new Yi)!=et||Cn&&ot(new Cn)!=ur)&&(ot=function(e){var i=lt(e),a=i==$t?e.constructor:r,u=a?_i(a):"";if(u)switch(u){case kd:return Lt;case Vd:return Xe;case Kd:return $i;case Gd:return et;case Wd:return ur}return i});function uy(e,i,a){for(var u=-1,l=a.length;++u<l;){var y=a[u],w=y.size;switch(y.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=st(i,e+w);break;case"takeRight":e=Ge(e,i-w);break}}return{start:e,end:i}}function hy(e){var i=e.match(Er);return i?i[1].split(Qo):[]}function jh(e,i,a){i=Qr(i,e);for(var u=-1,l=i.length,y=!1;++u<l;){var w=dr(i[u]);if(!(y=e!=null&&a(e,w)))break;e=e[w]}return y||++u!=l?y:(l=e==null?0:e.length,!!l&&go(l)&&Cr(w,l)&&(ne(e)||Ei(e)))}function ly(e){var i=e.length,a=new e.constructor(i);return i&&typeof e[0]=="string"&&Ee.call(e,"index")&&(a.index=e.index,a.input=e.input),a}function zh(e){return typeof e.constructor=="function"&&!Ln(e)?Xi(Ms(e)):{}}function fy(e,i,a){var u=e.constructor;switch(i){case zt:return Ja(e);case Ce:case ze:return new u(+e);case Lt:return Jg(e,a);case Mr:case nt:case Ni:case Fi:case yn:case Di:case Ur:case qi:case ji:return bh(e,a);case Xe:return new u;case wr:case cr:return new u(e);case ar:return Qg(e);case et:return new u;case br:return Yg(e)}}function py(e,i){var a=i.length;if(!a)return e;var u=a-1;return i[u]=(a>1?"& ":"")+i[u],i=i.join(a>2?", ":" "),e.replace(En,`{
/* [wrapped with `+i+`] */
`)}function dy(e){return ne(e)||Ei(e)||!!(Hu&&e&&e[Hu])}function Cr(e,i){var a=typeof e;return i=i??K,!!i&&(a=="number"||a!="symbol"&&sa.test(e))&&e>-1&&e%1==0&&e<i}function ft(e,i,a){if(!De(a))return!1;var u=typeof i;return(u=="number"?yt(a)&&Cr(i,a.length):u=="string"&&i in a)?tr(a[i],e):!1}function ic(e,i){if(ne(e))return!1;var a=typeof e;return a=="number"||a=="symbol"||a=="boolean"||e==null||Nt(e)?!0:Go.test(e)||!ui.test(e)||i!=null&&e in Ae(i)}function gy(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function nc(e){var i=oo(e),a=d[i];if(typeof a!="function"||!(i in ge.prototype))return!1;if(e===a)return!0;var u=ec(a);return!!u&&e===u[0]}function yy(e){return!!Lu&&Lu in e}var vy=qs?Rr:_c;function Ln(e){var i=e&&e.constructor,a=typeof i=="function"&&i.prototype||Qi;return e===a}function Lh(e){return e===e&&!De(e)}function Bh(e,i){return function(a){return a==null?!1:a[e]===i&&(i!==r||e in Ae(a))}}function my(e){var i=fo(e,function(u){return a.size===g&&a.clear(),u}),a=i.cache;return i}function wy(e,i){var a=e[1],u=i[1],l=a|u,y=l<(k|U|re),w=u==re&&a==N||u==re&&a==oe&&e[7].length<=i[8]||u==(re|oe)&&i[7].length<=i[8]&&a==N;if(!(y||w))return e;u&k&&(e[2]=i[2],l|=a&k?0:J);var _=i[3];if(_){var x=e[3];e[3]=x?Eh(x,_,i[4]):_,e[4]=x?Kr(e[3],v):i[4]}return _=i[5],_&&(x=e[5],e[5]=x?Ih(x,_,i[6]):_,e[6]=x?Kr(e[5],v):i[6]),_=i[7],_&&(e[7]=_),u&re&&(e[8]=e[8]==null?i[8]:st(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function by(e){var i=[];if(e!=null)for(var a in Ae(e))i.push(a);return i}function _y(e){return zs.call(e)}function Mh(e,i,a){return i=Ge(i===r?e.length-1:i,0),function(){for(var u=arguments,l=-1,y=Ge(u.length-i,0),w=O(y);++l<y;)w[l]=u[i+l];l=-1;for(var _=O(i+1);++l<i;)_[l]=u[l];return _[i]=a(w),Je(e,this,_)}}function Uh(e,i){return i.length<2?e:wi(e,Kt(i,0,-1))}function Ey(e,i){for(var a=e.length,u=st(i.length,a),l=gt(e);u--;){var y=i[u];e[u]=Cr(y,a)?l[y]:r}return e}function sc(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Hh=Vh(fh),Bn=jd||function(e,i){return ye.setTimeout(e,i)},oc=Vh(Vg);function kh(e,i,a){var u=i+"";return oc(e,py(u,Iy(hy(u),a)))}function Vh(e){var i=0,a=0;return function(){var u=Md(),l=mr-(u-a);if(a=u,l>0){if(++i>=xt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function co(e,i){var a=-1,u=e.length,l=u-1;for(i=i===r?u:i;++a<i;){var y=Ua(a,l),w=e[y];e[y]=e[a],e[a]=w}return e.length=i,e}var Kh=my(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Wo,function(a,u,l,y){i.push(l?y.replace(Xo,"$1"):u||a)}),i});function dr(e){if(typeof e=="string"||Nt(e))return e;var i=e+"";return i=="0"&&1/e==-V?"-0":i}function _i(e){if(e!=null){try{return js.call(e)}catch{}try{return e+""}catch{}}return""}function Iy(e,i){return Ut($e,function(a){var u="_."+a[0];i&a[1]&&!Ts(e,u)&&e.push(u)}),e.sort()}function Gh(e){if(e instanceof ge)return e.clone();var i=new kt(e.__wrapped__,e.__chain__);return i.__actions__=gt(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Py(e,i,a){(a?ft(e,i,a):i===r)?i=1:i=Ge(se(i),0);var u=e==null?0:e.length;if(!u||i<1)return[];for(var l=0,y=0,w=O(ks(u/i));l<u;)w[y++]=Kt(e,l,l+=i);return w}function xy(e){for(var i=-1,a=e==null?0:e.length,u=0,l=[];++i<a;){var y=e[i];y&&(l[u++]=y)}return l}function Sy(){var e=arguments.length;if(!e)return[];for(var i=O(e-1),a=arguments[0],u=e;u--;)i[u-1]=arguments[u];return Vr(ne(a)?gt(a):[a],tt(i,1))}var Ay=he(function(e,i){return Be(e)?Fn(e,tt(i,1,Be,!0)):[]}),Oy=he(function(e,i){var a=Gt(i);return Be(a)&&(a=r),Be(e)?Fn(e,tt(i,1,Be,!0),W(a,2)):[]}),$y=he(function(e,i){var a=Gt(i);return Be(a)&&(a=r),Be(e)?Fn(e,tt(i,1,Be,!0),r,a):[]});function Cy(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),Kt(e,i<0?0:i,u)):[]}function Ry(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),i=u-i,Kt(e,0,i<0?0:i)):[]}function Ty(e,i){return e&&e.length?eo(e,W(i,3),!0,!0):[]}function Ny(e,i){return e&&e.length?eo(e,W(i,3),!0):[]}function Fy(e,i,a,u){var l=e==null?0:e.length;return l?(a&&typeof a!="number"&&ft(e,i,a)&&(a=0,u=l),Sg(e,i,a,u)):[]}function Wh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=a==null?0:se(a);return l<0&&(l=Ge(u+l,0)),Ns(e,W(i,3),l)}function Jh(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return a!==r&&(l=se(a),l=a<0?Ge(u+l,0):st(l,u-1)),Ns(e,W(i,3),l,!0)}function Qh(e){var i=e==null?0:e.length;return i?tt(e,1):[]}function Dy(e){var i=e==null?0:e.length;return i?tt(e,V):[]}function qy(e,i){var a=e==null?0:e.length;return a?(i=i===r?1:se(i),tt(e,i)):[]}function jy(e){for(var i=-1,a=e==null?0:e.length,u={};++i<a;){var l=e[i];u[l[0]]=l[1]}return u}function Yh(e){return e&&e.length?e[0]:r}function zy(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=a==null?0:se(a);return l<0&&(l=Ge(u+l,0)),Ki(e,i,l)}function Ly(e){var i=e==null?0:e.length;return i?Kt(e,0,-1):[]}var By=he(function(e){var i=Ne(e,Ga);return i.length&&i[0]===e[0]?ja(i):[]}),My=he(function(e){var i=Gt(e),a=Ne(e,Ga);return i===Gt(a)?i=r:a.pop(),a.length&&a[0]===e[0]?ja(a,W(i,2)):[]}),Uy=he(function(e){var i=Gt(e),a=Ne(e,Ga);return i=typeof i=="function"?i:r,i&&a.pop(),a.length&&a[0]===e[0]?ja(a,r,i):[]});function Hy(e,i){return e==null?"":Ld.call(e,i)}function Gt(e){var i=e==null?0:e.length;return i?e[i-1]:r}function ky(e,i,a){var u=e==null?0:e.length;if(!u)return-1;var l=u;return a!==r&&(l=se(a),l=l<0?Ge(u+l,0):st(l,u-1)),i===i?Id(e,i,l):Ns(e,Ru,l,!0)}function Vy(e,i){return e&&e.length?ch(e,se(i)):r}var Ky=he(Zh);function Zh(e,i){return e&&e.length&&i&&i.length?Ma(e,i):e}function Gy(e,i,a){return e&&e.length&&i&&i.length?Ma(e,i,W(a,2)):e}function Wy(e,i,a){return e&&e.length&&i&&i.length?Ma(e,i,r,a):e}var Jy=$r(function(e,i){var a=e==null?0:e.length,u=Na(e,i);return lh(e,Ne(i,function(l){return Cr(l,a)?+l:l}).sort(_h)),u});function Qy(e,i){var a=[];if(!(e&&e.length))return a;var u=-1,l=[],y=e.length;for(i=W(i,3);++u<y;){var w=e[u];i(w,u,e)&&(a.push(w),l.push(u))}return lh(e,l),a}function ac(e){return e==null?e:Hd.call(e)}function Yy(e,i,a){var u=e==null?0:e.length;return u?(a&&typeof a!="number"&&ft(e,i,a)?(i=0,a=u):(i=i==null?0:se(i),a=a===r?u:se(a)),Kt(e,i,a)):[]}function Zy(e,i){return Xs(e,i)}function Xy(e,i,a){return ka(e,i,W(a,2))}function ev(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i);if(u<a&&tr(e[u],i))return u}return-1}function tv(e,i){return Xs(e,i,!0)}function rv(e,i,a){return ka(e,i,W(a,2),!0)}function iv(e,i){var a=e==null?0:e.length;if(a){var u=Xs(e,i,!0)-1;if(tr(e[u],i))return u}return-1}function nv(e){return e&&e.length?ph(e):[]}function sv(e,i){return e&&e.length?ph(e,W(i,2)):[]}function ov(e){var i=e==null?0:e.length;return i?Kt(e,1,i):[]}function av(e,i,a){return e&&e.length?(i=a||i===r?1:se(i),Kt(e,0,i<0?0:i)):[]}function cv(e,i,a){var u=e==null?0:e.length;return u?(i=a||i===r?1:se(i),i=u-i,Kt(e,i<0?0:i,u)):[]}function uv(e,i){return e&&e.length?eo(e,W(i,3),!1,!0):[]}function hv(e,i){return e&&e.length?eo(e,W(i,3)):[]}var lv=he(function(e){return Jr(tt(e,1,Be,!0))}),fv=he(function(e){var i=Gt(e);return Be(i)&&(i=r),Jr(tt(e,1,Be,!0),W(i,2))}),pv=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Jr(tt(e,1,Be,!0),r,i)});function dv(e){return e&&e.length?Jr(e):[]}function gv(e,i){return e&&e.length?Jr(e,W(i,2)):[]}function yv(e,i){return i=typeof i=="function"?i:r,e&&e.length?Jr(e,r,i):[]}function cc(e){if(!(e&&e.length))return[];var i=0;return e=kr(e,function(a){if(Be(a))return i=Ge(a.length,i),!0}),xa(i,function(a){return Ne(e,Ea(a))})}function Xh(e,i){if(!(e&&e.length))return[];var a=cc(e);return i==null?a:Ne(a,function(u){return Je(i,r,u)})}var vv=he(function(e,i){return Be(e)?Fn(e,i):[]}),mv=he(function(e){return Ka(kr(e,Be))}),wv=he(function(e){var i=Gt(e);return Be(i)&&(i=r),Ka(kr(e,Be),W(i,2))}),bv=he(function(e){var i=Gt(e);return i=typeof i=="function"?i:r,Ka(kr(e,Be),r,i)}),_v=he(cc);function Ev(e,i){return vh(e||[],i||[],Nn)}function Iv(e,i){return vh(e||[],i||[],jn)}var Pv=he(function(e){var i=e.length,a=i>1?e[i-1]:r;return a=typeof a=="function"?(e.pop(),a):r,Xh(e,a)});function el(e){var i=d(e);return i.__chain__=!0,i}function xv(e,i){return i(e),e}function uo(e,i){return i(e)}var Sv=$r(function(e){var i=e.length,a=i?e[0]:0,u=this.__wrapped__,l=function(y){return Na(y,e)};return i>1||this.__actions__.length||!(u instanceof ge)||!Cr(a)?this.thru(l):(u=u.slice(a,+a+(i?1:0)),u.__actions__.push({func:uo,args:[l],thisArg:r}),new kt(u,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function Av(){return el(this)}function Ov(){return new kt(this.value(),this.__chain__)}function $v(){this.__values__===r&&(this.__values__=dl(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Cv(){return this}function Rv(e){for(var i,a=this;a instanceof Ws;){var u=Gh(a);u.__index__=0,u.__values__=r,i?l.__wrapped__=u:i=u;var l=u;a=a.__wrapped__}return l.__wrapped__=e,i}function Tv(){var e=this.__wrapped__;if(e instanceof ge){var i=e;return this.__actions__.length&&(i=new ge(this)),i=i.reverse(),i.__actions__.push({func:uo,args:[ac],thisArg:r}),new kt(i,this.__chain__)}return this.thru(ac)}function Nv(){return yh(this.__wrapped__,this.__actions__)}var Fv=to(function(e,i,a){Ee.call(e,a)?++e[a]:Ar(e,a,1)});function Dv(e,i,a){var u=ne(e)?$u:xg;return a&&ft(e,i,a)&&(i=r),u(e,W(i,3))}function qv(e,i){var a=ne(e)?kr:Xu;return a(e,W(i,3))}var jv=Ah(Wh),zv=Ah(Jh);function Lv(e,i){return tt(ho(e,i),1)}function Bv(e,i){return tt(ho(e,i),V)}function Mv(e,i,a){return a=a===r?1:se(a),tt(ho(e,i),a)}function tl(e,i){var a=ne(e)?Ut:Wr;return a(e,W(i,3))}function rl(e,i){var a=ne(e)?od:Zu;return a(e,W(i,3))}var Uv=to(function(e,i,a){Ee.call(e,a)?e[a].push(i):Ar(e,a,[i])});function Hv(e,i,a,u){e=yt(e)?e:sn(e),a=a&&!u?se(a):0;var l=e.length;return a<0&&(a=Ge(l+a,0)),yo(e)?a<=l&&e.indexOf(i,a)>-1:!!l&&Ki(e,i,a)>-1}var kv=he(function(e,i,a){var u=-1,l=typeof i=="function",y=yt(e)?O(e.length):[];return Wr(e,function(w){y[++u]=l?Je(i,w,a):Dn(w,i,a)}),y}),Vv=to(function(e,i,a){Ar(e,a,i)});function ho(e,i){var a=ne(e)?Ne:sh;return a(e,W(i,3))}function Kv(e,i,a,u){return e==null?[]:(ne(i)||(i=i==null?[]:[i]),a=u?r:a,ne(a)||(a=a==null?[]:[a]),uh(e,i,a))}var Gv=to(function(e,i,a){e[a?0:1].push(i)},function(){return[[],[]]});function Wv(e,i,a){var u=ne(e)?ba:Nu,l=arguments.length<3;return u(e,W(i,4),a,l,Wr)}function Jv(e,i,a){var u=ne(e)?ad:Nu,l=arguments.length<3;return u(e,W(i,4),a,l,Zu)}function Qv(e,i){var a=ne(e)?kr:Xu;return a(e,po(W(i,3)))}function Yv(e){var i=ne(e)?Wu:Hg;return i(e)}function Zv(e,i,a){(a?ft(e,i,a):i===r)?i=1:i=se(i);var u=ne(e)?bg:kg;return u(e,i)}function Xv(e){var i=ne(e)?_g:Kg;return i(e)}function em(e){if(e==null)return 0;if(yt(e))return yo(e)?Wi(e):e.length;var i=ot(e);return i==Xe||i==et?e.size:La(e).length}function tm(e,i,a){var u=ne(e)?_a:Gg;return a&&ft(e,i,a)&&(i=r),u(e,W(i,3))}var rm=he(function(e,i){if(e==null)return[];var a=i.length;return a>1&&ft(e,i[0],i[1])?i=[]:a>2&&ft(i[0],i[1],i[2])&&(i=[i[0]]),uh(e,tt(i,1),[])}),lo=qd||function(){return ye.Date.now()};function im(e,i){if(typeof i!="function")throw new Ht(h);return e=se(e),function(){if(--e<1)return i.apply(this,arguments)}}function il(e,i,a){return i=a?r:i,i=e&&i==null?e.length:i,Or(e,re,r,r,r,r,i)}function nl(e,i){var a;if(typeof i!="function")throw new Ht(h);return e=se(e),function(){return--e>0&&(a=i.apply(this,arguments)),e<=1&&(i=r),a}}var uc=he(function(e,i,a){var u=k;if(a.length){var l=Kr(a,rn(uc));u|=Q}return Or(e,u,i,a,l)}),sl=he(function(e,i,a){var u=k|U;if(a.length){var l=Kr(a,rn(sl));u|=Q}return Or(i,u,e,a,l)});function ol(e,i,a){i=a?r:i;var u=Or(e,N,r,r,r,r,r,i);return u.placeholder=ol.placeholder,u}function al(e,i,a){i=a?r:i;var u=Or(e,z,r,r,r,r,r,i);return u.placeholder=al.placeholder,u}function cl(e,i,a){var u,l,y,w,_,x,C=0,R=!1,F=!1,j=!0;if(typeof e!="function")throw new Ht(h);i=Wt(i)||0,De(a)&&(R=!!a.leading,F="maxWait"in a,y=F?Ge(Wt(a.maxWait)||0,i):y,j="trailing"in a?!!a.trailing:j);function H(Me){var rr=u,Nr=l;return u=l=r,C=Me,w=e.apply(Nr,rr),w}function Z(Me){return C=Me,_=Bn(pe,i),R?H(Me):w}function ce(Me){var rr=Me-x,Nr=Me-C,Al=i-rr;return F?st(Al,y-Nr):Al}function X(Me){var rr=Me-x,Nr=Me-C;return x===r||rr>=i||rr<0||F&&Nr>=y}function pe(){var Me=lo();if(X(Me))return ve(Me);_=Bn(pe,ce(Me))}function ve(Me){return _=r,j&&u?H(Me):(u=l=r,w)}function Ft(){_!==r&&mh(_),C=0,u=x=l=_=r}function pt(){return _===r?w:ve(lo())}function Dt(){var Me=lo(),rr=X(Me);if(u=arguments,l=this,x=Me,rr){if(_===r)return Z(x);if(F)return mh(_),_=Bn(pe,i),H(x)}return _===r&&(_=Bn(pe,i)),w}return Dt.cancel=Ft,Dt.flush=pt,Dt}var nm=he(function(e,i){return Yu(e,1,i)}),sm=he(function(e,i,a){return Yu(e,Wt(i)||0,a)});function om(e){return Or(e,we)}function fo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Ht(h);var a=function(){var u=arguments,l=i?i.apply(this,u):u[0],y=a.cache;if(y.has(l))return y.get(l);var w=e.apply(this,u);return a.cache=y.set(l,w)||y,w};return a.cache=new(fo.Cache||Sr),a}fo.Cache=Sr;function po(e){if(typeof e!="function")throw new Ht(h);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function am(e){return nl(2,e)}var cm=Wg(function(e,i){i=i.length==1&&ne(i[0])?Ne(i[0],Rt(W())):Ne(tt(i,1),Rt(W()));var a=i.length;return he(function(u){for(var l=-1,y=st(u.length,a);++l<y;)u[l]=i[l].call(this,u[l]);return Je(e,this,u)})}),hc=he(function(e,i){var a=Kr(i,rn(hc));return Or(e,Q,r,i,a)}),ul=he(function(e,i){var a=Kr(i,rn(ul));return Or(e,fe,r,i,a)}),um=$r(function(e,i){return Or(e,oe,r,r,r,i)});function hm(e,i){if(typeof e!="function")throw new Ht(h);return i=i===r?i:se(i),he(e,i)}function lm(e,i){if(typeof e!="function")throw new Ht(h);return i=i==null?0:Ge(se(i),0),he(function(a){var u=a[i],l=Yr(a,0,i);return u&&Vr(l,u),Je(e,this,l)})}function fm(e,i,a){var u=!0,l=!0;if(typeof e!="function")throw new Ht(h);return De(a)&&(u="leading"in a?!!a.leading:u,l="trailing"in a?!!a.trailing:l),cl(e,i,{leading:u,maxWait:i,trailing:l})}function pm(e){return il(e,1)}function dm(e,i){return hc(Wa(i),e)}function gm(){if(!arguments.length)return[];var e=arguments[0];return ne(e)?e:[e]}function ym(e){return Vt(e,A)}function vm(e,i){return i=typeof i=="function"?i:r,Vt(e,A,i)}function mm(e){return Vt(e,b|A)}function wm(e,i){return i=typeof i=="function"?i:r,Vt(e,b|A,i)}function bm(e,i){return i==null||Qu(e,i,Qe(i))}function tr(e,i){return e===i||e!==e&&i!==i}var _m=so(qa),Em=so(function(e,i){return e>=i}),Ei=rh(function(){return arguments}())?rh:function(e){return je(e)&&Ee.call(e,"callee")&&!Uu.call(e,"callee")},ne=O.isArray,Im=ht?Rt(ht):Rg;function yt(e){return e!=null&&go(e.length)&&!Rr(e)}function Be(e){return je(e)&&yt(e)}function Pm(e){return e===!0||e===!1||je(e)&&lt(e)==Ce}var Zr=zd||_c,xm=Zt?Rt(Zt):Tg;function Sm(e){return je(e)&&e.nodeType===1&&!Mn(e)}function Am(e){if(e==null)return!0;if(yt(e)&&(ne(e)||typeof e=="string"||typeof e.splice=="function"||Zr(e)||nn(e)||Ei(e)))return!e.length;var i=ot(e);if(i==Xe||i==et)return!e.size;if(Ln(e))return!La(e).length;for(var a in e)if(Ee.call(e,a))return!1;return!0}function Om(e,i){return qn(e,i)}function $m(e,i,a){a=typeof a=="function"?a:r;var u=a?a(e,i):r;return u===r?qn(e,i,r,a):!!u}function lc(e){if(!je(e))return!1;var i=lt(e);return i==ut||i==At||typeof e.message=="string"&&typeof e.name=="string"&&!Mn(e)}function Cm(e){return typeof e=="number"&&ku(e)}function Rr(e){if(!De(e))return!1;var i=lt(e);return i==Ot||i==Br||i==St||i==Ci}function hl(e){return typeof e=="number"&&e==se(e)}function go(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=K}function De(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function je(e){return e!=null&&typeof e=="object"}var ll=Mt?Rt(Mt):Fg;function Rm(e,i){return e===i||za(e,i,tc(i))}function Tm(e,i,a){return a=typeof a=="function"?a:r,za(e,i,tc(i),a)}function Nm(e){return fl(e)&&e!=+e}function Fm(e){if(vy(e))throw new te(c);return ih(e)}function Dm(e){return e===null}function qm(e){return e==null}function fl(e){return typeof e=="number"||je(e)&&lt(e)==wr}function Mn(e){if(!je(e)||lt(e)!=$t)return!1;var i=Ms(e);if(i===null)return!0;var a=Ee.call(i,"constructor")&&i.constructor;return typeof a=="function"&&a instanceof a&&js.call(a)==Td}var fc=lr?Rt(lr):Dg;function jm(e){return hl(e)&&e>=-K&&e<=K}var pl=Sn?Rt(Sn):qg;function yo(e){return typeof e=="string"||!ne(e)&&je(e)&&lt(e)==cr}function Nt(e){return typeof e=="symbol"||je(e)&&lt(e)==br}var nn=di?Rt(di):jg;function zm(e){return e===r}function Lm(e){return je(e)&&ot(e)==ur}function Bm(e){return je(e)&&lt(e)==Ti}var Mm=so(Ba),Um=so(function(e,i){return e<=i});function dl(e){if(!e)return[];if(yt(e))return yo(e)?Xt(e):gt(e);if(On&&e[On])return bd(e[On]());var i=ot(e),a=i==Xe?Aa:i==et?Fs:sn;return a(e)}function Tr(e){if(!e)return e===0?e:0;if(e=Wt(e),e===V||e===-V){var i=e<0?-1:1;return i*de}return e===e?e:0}function se(e){var i=Tr(e),a=i%1;return i===i?a?i-a:i:0}function gl(e){return e?mi(se(e),0,ae):0}function Wt(e){if(typeof e=="number")return e;if(Nt(e))return le;if(De(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=De(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Fu(e);var a=ra.test(e);return a||na.test(e)?ie(e.slice(2),a?2:8):ta.test(e)?le:+e}function yl(e){return pr(e,vt(e))}function Hm(e){return e?mi(se(e),-K,K):e===0?e:0}function _e(e){return e==null?"":Tt(e)}var km=en(function(e,i){if(Ln(i)||yt(i)){pr(i,Qe(i),e);return}for(var a in i)Ee.call(i,a)&&Nn(e,a,i[a])}),vl=en(function(e,i){pr(i,vt(i),e)}),vo=en(function(e,i,a,u){pr(i,vt(i),e,u)}),Vm=en(function(e,i,a,u){pr(i,Qe(i),e,u)}),Km=$r(Na);function Gm(e,i){var a=Xi(e);return i==null?a:Ju(a,i)}var Wm=he(function(e,i){e=Ae(e);var a=-1,u=i.length,l=u>2?i[2]:r;for(l&&ft(i[0],i[1],l)&&(u=1);++a<u;)for(var y=i[a],w=vt(y),_=-1,x=w.length;++_<x;){var C=w[_],R=e[C];(R===r||tr(R,Qi[C])&&!Ee.call(e,C))&&(e[C]=y[C])}return e}),Jm=he(function(e){return e.push(r,Fh),Je(ml,r,e)});function Qm(e,i){return Cu(e,W(i,3),fr)}function Ym(e,i){return Cu(e,W(i,3),Da)}function Zm(e,i){return e==null?e:Fa(e,W(i,3),vt)}function Xm(e,i){return e==null?e:eh(e,W(i,3),vt)}function ew(e,i){return e&&fr(e,W(i,3))}function tw(e,i){return e&&Da(e,W(i,3))}function rw(e){return e==null?[]:Ys(e,Qe(e))}function iw(e){return e==null?[]:Ys(e,vt(e))}function pc(e,i,a){var u=e==null?r:wi(e,i);return u===r?a:u}function nw(e,i){return e!=null&&jh(e,i,Ag)}function dc(e,i){return e!=null&&jh(e,i,Og)}var sw=$h(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=zs.call(i)),e[i]=a},yc(mt)),ow=$h(function(e,i,a){i!=null&&typeof i.toString!="function"&&(i=zs.call(i)),Ee.call(e,i)?e[i].push(a):e[i]=[a]},W),aw=he(Dn);function Qe(e){return yt(e)?Gu(e):La(e)}function vt(e){return yt(e)?Gu(e,!0):zg(e)}function cw(e,i){var a={};return i=W(i,3),fr(e,function(u,l,y){Ar(a,i(u,l,y),u)}),a}function uw(e,i){var a={};return i=W(i,3),fr(e,function(u,l,y){Ar(a,l,i(u,l,y))}),a}var hw=en(function(e,i,a){Zs(e,i,a)}),ml=en(function(e,i,a,u){Zs(e,i,a,u)}),lw=$r(function(e,i){var a={};if(e==null)return a;var u=!1;i=Ne(i,function(y){return y=Qr(y,e),u||(u=y.length>1),y}),pr(e,Xa(e),a),u&&(a=Vt(a,b|E|A,sy));for(var l=i.length;l--;)Va(a,i[l]);return a});function fw(e,i){return wl(e,po(W(i)))}var pw=$r(function(e,i){return e==null?{}:Bg(e,i)});function wl(e,i){if(e==null)return{};var a=Ne(Xa(e),function(u){return[u]});return i=W(i),hh(e,a,function(u,l){return i(u,l[0])})}function dw(e,i,a){i=Qr(i,e);var u=-1,l=i.length;for(l||(l=1,e=r);++u<l;){var y=e==null?r:e[dr(i[u])];y===r&&(u=l,y=a),e=Rr(y)?y.call(e):y}return e}function gw(e,i,a){return e==null?e:jn(e,i,a)}function yw(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:jn(e,i,a,u)}var bl=Th(Qe),_l=Th(vt);function vw(e,i,a){var u=ne(e),l=u||Zr(e)||nn(e);if(i=W(i,4),a==null){var y=e&&e.constructor;l?a=u?new y:[]:De(e)?a=Rr(y)?Xi(Ms(e)):{}:a={}}return(l?Ut:fr)(e,function(w,_,x){return i(a,w,_,x)}),a}function mw(e,i){return e==null?!0:Va(e,i)}function ww(e,i,a){return e==null?e:gh(e,i,Wa(a))}function bw(e,i,a,u){return u=typeof u=="function"?u:r,e==null?e:gh(e,i,Wa(a),u)}function sn(e){return e==null?[]:Sa(e,Qe(e))}function _w(e){return e==null?[]:Sa(e,vt(e))}function Ew(e,i,a){return a===r&&(a=i,i=r),a!==r&&(a=Wt(a),a=a===a?a:0),i!==r&&(i=Wt(i),i=i===i?i:0),mi(Wt(e),i,a)}function Iw(e,i,a){return i=Tr(i),a===r?(a=i,i=0):a=Tr(a),e=Wt(e),$g(e,i,a)}function Pw(e,i,a){if(a&&typeof a!="boolean"&&ft(e,i,a)&&(i=a=r),a===r&&(typeof i=="boolean"?(a=i,i=r):typeof e=="boolean"&&(a=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Tr(e),i===r?(i=e,e=0):i=Tr(i)),e>i){var u=e;e=i,i=u}if(a||e%1||i%1){var l=Vu();return st(e+l*(i-e+xe("1e-"+((l+"").length-1))),i)}return Ua(e,i)}var xw=tn(function(e,i,a){return i=i.toLowerCase(),e+(a?El(i):i)});function El(e){return gc(_e(e).toLowerCase())}function Il(e){return e=_e(e),e&&e.replace(Ir,gd).replace(va,"")}function Sw(e,i,a){e=_e(e),i=Tt(i);var u=e.length;a=a===r?u:mi(se(a),0,u);var l=a;return a-=i.length,a>=0&&e.slice(a,l)==i}function Aw(e){return e=_e(e),e&&ci.test(e)?e.replace(ls,yd):e}function Ow(e){return e=_e(e),e&&Jo.test(e)?e.replace(bn,"\\$&"):e}var $w=tn(function(e,i,a){return e+(a?"-":"")+i.toLowerCase()}),Cw=tn(function(e,i,a){return e+(a?" ":"")+i.toLowerCase()}),Rw=Sh("toLowerCase");function Tw(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;if(!i||u>=i)return e;var l=(i-u)/2;return no(Vs(l),a)+e+no(ks(l),a)}function Nw(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;return i&&u<i?e+no(i-u,a):e}function Fw(e,i,a){e=_e(e),i=se(i);var u=i?Wi(e):0;return i&&u<i?no(i-u,a)+e:e}function Dw(e,i,a){return a||i==null?i=0:i&&(i=+i),Ud(_e(e).replace(_n,""),i||0)}function qw(e,i,a){return(a?ft(e,i,a):i===r)?i=1:i=se(i),Ha(_e(e),i)}function jw(){var e=arguments,i=_e(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var zw=tn(function(e,i,a){return e+(a?"_":"")+i.toLowerCase()});function Lw(e,i,a){return a&&typeof a!="number"&&ft(e,i,a)&&(i=a=r),a=a===r?ae:a>>>0,a?(e=_e(e),e&&(typeof i=="string"||i!=null&&!fc(i))&&(i=Tt(i),!i&&Gi(e))?Yr(Xt(e),0,a):e.split(i,a)):[]}var Bw=tn(function(e,i,a){return e+(a?" ":"")+gc(i)});function Mw(e,i,a){return e=_e(e),a=a==null?0:mi(se(a),0,e.length),i=Tt(i),e.slice(a,a+i.length)==i}function Uw(e,i,a){var u=d.templateSettings;a&&ft(e,i,a)&&(i=r),e=_e(e),i=vo({},i,u,Nh);var l=vo({},i.imports,u.imports,Nh),y=Qe(l),w=Sa(l,y),_,x,C=0,R=i.interpolate||Li,F="__p += '",j=Oa((i.escape||Li).source+"|"+R.source+"|"+(R===zi?ea:Li).source+"|"+(i.evaluate||Li).source+"|$","g"),H="//# sourceURL="+(Ee.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ma+"]")+`
`;e.replace(j,function(X,pe,ve,Ft,pt,Dt){return ve||(ve=Ft),F+=e.slice(C,Dt).replace(oa,vd),pe&&(_=!0,F+=`' +
__e(`+pe+`) +
'`),pt&&(x=!0,F+=`';
`+pt+`;
__p += '`),ve&&(F+=`' +
((__t = (`+ve+`)) == null ? '' : __t) +
'`),C=Dt+X.length,X}),F+=`';
`;var Z=Ee.call(i,"variable")&&i.variable;if(!Z)F=`with (obj) {
`+F+`
}
`;else if(Zo.test(Z))throw new te(p);F=(x?F.replace(Ko,""):F).replace(_r,"$1").replace(us,"$1;"),F="function("+(Z||"obj")+`) {
`+(Z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+F+`return __p
}`;var ce=xl(function(){return me(y,H+"return "+F).apply(r,w)});if(ce.source=F,lc(ce))throw ce;return ce}function Hw(e){return _e(e).toLowerCase()}function kw(e){return _e(e).toUpperCase()}function Vw(e,i,a){if(e=_e(e),e&&(a||i===r))return Fu(e);if(!e||!(i=Tt(i)))return e;var u=Xt(e),l=Xt(i),y=Du(u,l),w=qu(u,l)+1;return Yr(u,y,w).join("")}function Kw(e,i,a){if(e=_e(e),e&&(a||i===r))return e.slice(0,zu(e)+1);if(!e||!(i=Tt(i)))return e;var u=Xt(e),l=qu(u,Xt(i))+1;return Yr(u,0,l).join("")}function Gw(e,i,a){if(e=_e(e),e&&(a||i===r))return e.replace(_n,"");if(!e||!(i=Tt(i)))return e;var u=Xt(e),l=Du(u,Xt(i));return Yr(u,l).join("")}function Ww(e,i){var a=qt,u=jt;if(De(i)){var l="separator"in i?i.separator:l;a="length"in i?se(i.length):a,u="omission"in i?Tt(i.omission):u}e=_e(e);var y=e.length;if(Gi(e)){var w=Xt(e);y=w.length}if(a>=y)return e;var _=a-Wi(u);if(_<1)return u;var x=w?Yr(w,0,_).join(""):e.slice(0,_);if(l===r)return x+u;if(w&&(_+=x.length-_),fc(l)){if(e.slice(_).search(l)){var C,R=x;for(l.global||(l=Oa(l.source,_e(Bt.exec(l))+"g")),l.lastIndex=0;C=l.exec(R);)var F=C.index;x=x.slice(0,F===r?_:F)}}else if(e.indexOf(Tt(l),_)!=_){var j=x.lastIndexOf(l);j>-1&&(x=x.slice(0,j))}return x+u}function Jw(e){return e=_e(e),e&&vn.test(e)?e.replace(hs,Pd):e}var Qw=tn(function(e,i,a){return e+(a?" ":"")+i.toUpperCase()}),gc=Sh("toUpperCase");function Pl(e,i,a){return e=_e(e),i=a?r:i,i===r?wd(e)?Ad(e):hd(e):e.match(i)||[]}var xl=he(function(e,i){try{return Je(e,r,i)}catch(a){return lc(a)?a:new te(a)}}),Yw=$r(function(e,i){return Ut(i,function(a){a=dr(a),Ar(e,a,uc(e[a],e))}),e});function Zw(e){var i=e==null?0:e.length,a=W();return e=i?Ne(e,function(u){if(typeof u[1]!="function")throw new Ht(h);return[a(u[0]),u[1]]}):[],he(function(u){for(var l=-1;++l<i;){var y=e[l];if(Je(y[0],this,u))return Je(y[1],this,u)}})}function Xw(e){return Pg(Vt(e,b))}function yc(e){return function(){return e}}function e0(e,i){return e==null||e!==e?i:e}var t0=Oh(),r0=Oh(!0);function mt(e){return e}function vc(e){return nh(typeof e=="function"?e:Vt(e,b))}function i0(e){return oh(Vt(e,b))}function n0(e,i){return ah(e,Vt(i,b))}var s0=he(function(e,i){return function(a){return Dn(a,e,i)}}),o0=he(function(e,i){return function(a){return Dn(e,a,i)}});function mc(e,i,a){var u=Qe(i),l=Ys(i,u);a==null&&!(De(i)&&(l.length||!u.length))&&(a=i,i=e,e=this,l=Ys(i,Qe(i)));var y=!(De(a)&&"chain"in a)||!!a.chain,w=Rr(e);return Ut(l,function(_){var x=i[_];e[_]=x,w&&(e.prototype[_]=function(){var C=this.__chain__;if(y||C){var R=e(this.__wrapped__),F=R.__actions__=gt(this.__actions__);return F.push({func:x,args:arguments,thisArg:e}),R.__chain__=C,R}return x.apply(e,Vr([this.value()],arguments))})}),e}function a0(){return ye._===this&&(ye._=Nd),this}function wc(){}function c0(e){return e=se(e),he(function(i){return ch(i,e)})}var u0=Qa(Ne),h0=Qa($u),l0=Qa(_a);function Sl(e){return ic(e)?Ea(dr(e)):Mg(e)}function f0(e){return function(i){return e==null?r:wi(e,i)}}var p0=Ch(),d0=Ch(!0);function bc(){return[]}function _c(){return!1}function g0(){return{}}function y0(){return""}function v0(){return!0}function m0(e,i){if(e=se(e),e<1||e>K)return[];var a=ae,u=st(e,ae);i=W(i),e-=ae;for(var l=xa(u,i);++a<e;)i(a);return l}function w0(e){return ne(e)?Ne(e,dr):Nt(e)?[e]:gt(Kh(_e(e)))}function b0(e){var i=++Rd;return _e(e)+i}var _0=io(function(e,i){return e+i},0),E0=Ya("ceil"),I0=io(function(e,i){return e/i},1),P0=Ya("floor");function x0(e){return e&&e.length?Qs(e,mt,qa):r}function S0(e,i){return e&&e.length?Qs(e,W(i,2),qa):r}function A0(e){return Tu(e,mt)}function O0(e,i){return Tu(e,W(i,2))}function $0(e){return e&&e.length?Qs(e,mt,Ba):r}function C0(e,i){return e&&e.length?Qs(e,W(i,2),Ba):r}var R0=io(function(e,i){return e*i},1),T0=Ya("round"),N0=io(function(e,i){return e-i},0);function F0(e){return e&&e.length?Pa(e,mt):0}function D0(e,i){return e&&e.length?Pa(e,W(i,2)):0}return d.after=im,d.ary=il,d.assign=km,d.assignIn=vl,d.assignInWith=vo,d.assignWith=Vm,d.at=Km,d.before=nl,d.bind=uc,d.bindAll=Yw,d.bindKey=sl,d.castArray=gm,d.chain=el,d.chunk=Py,d.compact=xy,d.concat=Sy,d.cond=Zw,d.conforms=Xw,d.constant=yc,d.countBy=Fv,d.create=Gm,d.curry=ol,d.curryRight=al,d.debounce=cl,d.defaults=Wm,d.defaultsDeep=Jm,d.defer=nm,d.delay=sm,d.difference=Ay,d.differenceBy=Oy,d.differenceWith=$y,d.drop=Cy,d.dropRight=Ry,d.dropRightWhile=Ty,d.dropWhile=Ny,d.fill=Fy,d.filter=qv,d.flatMap=Lv,d.flatMapDeep=Bv,d.flatMapDepth=Mv,d.flatten=Qh,d.flattenDeep=Dy,d.flattenDepth=qy,d.flip=om,d.flow=t0,d.flowRight=r0,d.fromPairs=jy,d.functions=rw,d.functionsIn=iw,d.groupBy=Uv,d.initial=Ly,d.intersection=By,d.intersectionBy=My,d.intersectionWith=Uy,d.invert=sw,d.invertBy=ow,d.invokeMap=kv,d.iteratee=vc,d.keyBy=Vv,d.keys=Qe,d.keysIn=vt,d.map=ho,d.mapKeys=cw,d.mapValues=uw,d.matches=i0,d.matchesProperty=n0,d.memoize=fo,d.merge=hw,d.mergeWith=ml,d.method=s0,d.methodOf=o0,d.mixin=mc,d.negate=po,d.nthArg=c0,d.omit=lw,d.omitBy=fw,d.once=am,d.orderBy=Kv,d.over=u0,d.overArgs=cm,d.overEvery=h0,d.overSome=l0,d.partial=hc,d.partialRight=ul,d.partition=Gv,d.pick=pw,d.pickBy=wl,d.property=Sl,d.propertyOf=f0,d.pull=Ky,d.pullAll=Zh,d.pullAllBy=Gy,d.pullAllWith=Wy,d.pullAt=Jy,d.range=p0,d.rangeRight=d0,d.rearg=um,d.reject=Qv,d.remove=Qy,d.rest=hm,d.reverse=ac,d.sampleSize=Zv,d.set=gw,d.setWith=yw,d.shuffle=Xv,d.slice=Yy,d.sortBy=rm,d.sortedUniq=nv,d.sortedUniqBy=sv,d.split=Lw,d.spread=lm,d.tail=ov,d.take=av,d.takeRight=cv,d.takeRightWhile=uv,d.takeWhile=hv,d.tap=xv,d.throttle=fm,d.thru=uo,d.toArray=dl,d.toPairs=bl,d.toPairsIn=_l,d.toPath=w0,d.toPlainObject=yl,d.transform=vw,d.unary=pm,d.union=lv,d.unionBy=fv,d.unionWith=pv,d.uniq=dv,d.uniqBy=gv,d.uniqWith=yv,d.unset=mw,d.unzip=cc,d.unzipWith=Xh,d.update=ww,d.updateWith=bw,d.values=sn,d.valuesIn=_w,d.without=vv,d.words=Pl,d.wrap=dm,d.xor=mv,d.xorBy=wv,d.xorWith=bv,d.zip=_v,d.zipObject=Ev,d.zipObjectDeep=Iv,d.zipWith=Pv,d.entries=bl,d.entriesIn=_l,d.extend=vl,d.extendWith=vo,mc(d,d),d.add=_0,d.attempt=xl,d.camelCase=xw,d.capitalize=El,d.ceil=E0,d.clamp=Ew,d.clone=ym,d.cloneDeep=mm,d.cloneDeepWith=wm,d.cloneWith=vm,d.conformsTo=bm,d.deburr=Il,d.defaultTo=e0,d.divide=I0,d.endsWith=Sw,d.eq=tr,d.escape=Aw,d.escapeRegExp=Ow,d.every=Dv,d.find=jv,d.findIndex=Wh,d.findKey=Qm,d.findLast=zv,d.findLastIndex=Jh,d.findLastKey=Ym,d.floor=P0,d.forEach=tl,d.forEachRight=rl,d.forIn=Zm,d.forInRight=Xm,d.forOwn=ew,d.forOwnRight=tw,d.get=pc,d.gt=_m,d.gte=Em,d.has=nw,d.hasIn=dc,d.head=Yh,d.identity=mt,d.includes=Hv,d.indexOf=zy,d.inRange=Iw,d.invoke=aw,d.isArguments=Ei,d.isArray=ne,d.isArrayBuffer=Im,d.isArrayLike=yt,d.isArrayLikeObject=Be,d.isBoolean=Pm,d.isBuffer=Zr,d.isDate=xm,d.isElement=Sm,d.isEmpty=Am,d.isEqual=Om,d.isEqualWith=$m,d.isError=lc,d.isFinite=Cm,d.isFunction=Rr,d.isInteger=hl,d.isLength=go,d.isMap=ll,d.isMatch=Rm,d.isMatchWith=Tm,d.isNaN=Nm,d.isNative=Fm,d.isNil=qm,d.isNull=Dm,d.isNumber=fl,d.isObject=De,d.isObjectLike=je,d.isPlainObject=Mn,d.isRegExp=fc,d.isSafeInteger=jm,d.isSet=pl,d.isString=yo,d.isSymbol=Nt,d.isTypedArray=nn,d.isUndefined=zm,d.isWeakMap=Lm,d.isWeakSet=Bm,d.join=Hy,d.kebabCase=$w,d.last=Gt,d.lastIndexOf=ky,d.lowerCase=Cw,d.lowerFirst=Rw,d.lt=Mm,d.lte=Um,d.max=x0,d.maxBy=S0,d.mean=A0,d.meanBy=O0,d.min=$0,d.minBy=C0,d.stubArray=bc,d.stubFalse=_c,d.stubObject=g0,d.stubString=y0,d.stubTrue=v0,d.multiply=R0,d.nth=Vy,d.noConflict=a0,d.noop=wc,d.now=lo,d.pad=Tw,d.padEnd=Nw,d.padStart=Fw,d.parseInt=Dw,d.random=Pw,d.reduce=Wv,d.reduceRight=Jv,d.repeat=qw,d.replace=jw,d.result=dw,d.round=T0,d.runInContext=P,d.sample=Yv,d.size=em,d.snakeCase=zw,d.some=tm,d.sortedIndex=Zy,d.sortedIndexBy=Xy,d.sortedIndexOf=ev,d.sortedLastIndex=tv,d.sortedLastIndexBy=rv,d.sortedLastIndexOf=iv,d.startCase=Bw,d.startsWith=Mw,d.subtract=N0,d.sum=F0,d.sumBy=D0,d.template=Uw,d.times=m0,d.toFinite=Tr,d.toInteger=se,d.toLength=gl,d.toLower=Hw,d.toNumber=Wt,d.toSafeInteger=Hm,d.toString=_e,d.toUpper=kw,d.trim=Vw,d.trimEnd=Kw,d.trimStart=Gw,d.truncate=Ww,d.unescape=Jw,d.uniqueId=b0,d.upperCase=Qw,d.upperFirst=gc,d.each=tl,d.eachRight=rl,d.first=Yh,mc(d,function(){var e={};return fr(d,function(i,a){Ee.call(d.prototype,a)||(e[a]=i)}),e}(),{chain:!1}),d.VERSION=n,Ut(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),Ut(["drop","take"],function(e,i){ge.prototype[e]=function(a){a=a===r?1:Ge(se(a),0);var u=this.__filtered__&&!i?new ge(this):this.clone();return u.__filtered__?u.__takeCount__=st(a,u.__takeCount__):u.__views__.push({size:st(a,ae),type:e+(u.__dir__<0?"Right":"")}),u},ge.prototype[e+"Right"]=function(a){return this.reverse()[e](a).reverse()}}),Ut(["filter","map","takeWhile"],function(e,i){var a=i+1,u=a==Lr||a==q;ge.prototype[e]=function(l){var y=this.clone();return y.__iteratees__.push({iteratee:W(l,3),type:a}),y.__filtered__=y.__filtered__||u,y}}),Ut(["head","last"],function(e,i){var a="take"+(i?"Right":"");ge.prototype[e]=function(){return this[a](1).value()[0]}}),Ut(["initial","tail"],function(e,i){var a="drop"+(i?"":"Right");ge.prototype[e]=function(){return this.__filtered__?new ge(this):this[a](1)}}),ge.prototype.compact=function(){return this.filter(mt)},ge.prototype.find=function(e){return this.filter(e).head()},ge.prototype.findLast=function(e){return this.reverse().find(e)},ge.prototype.invokeMap=he(function(e,i){return typeof e=="function"?new ge(this):this.map(function(a){return Dn(a,e,i)})}),ge.prototype.reject=function(e){return this.filter(po(W(e)))},ge.prototype.slice=function(e,i){e=se(e);var a=this;return a.__filtered__&&(e>0||i<0)?new ge(a):(e<0?a=a.takeRight(-e):e&&(a=a.drop(e)),i!==r&&(i=se(i),a=i<0?a.dropRight(-i):a.take(i-e)),a)},ge.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ge.prototype.toArray=function(){return this.take(ae)},fr(ge.prototype,function(e,i){var a=/^(?:filter|find|map|reject)|While$/.test(i),u=/^(?:head|last)$/.test(i),l=d[u?"take"+(i=="last"?"Right":""):i],y=u||/^find/.test(i);l&&(d.prototype[i]=function(){var w=this.__wrapped__,_=u?[1]:arguments,x=w instanceof ge,C=_[0],R=x||ne(w),F=function(pe){var ve=l.apply(d,Vr([pe],_));return u&&j?ve[0]:ve};R&&a&&typeof C=="function"&&C.length!=1&&(x=R=!1);var j=this.__chain__,H=!!this.__actions__.length,Z=y&&!j,ce=x&&!H;if(!y&&R){w=ce?w:new ge(this);var X=e.apply(w,_);return X.__actions__.push({func:uo,args:[F],thisArg:r}),new kt(X,j)}return Z&&ce?e.apply(this,_):(X=this.thru(F),Z?u?X.value()[0]:X.value():X)})}),Ut(["pop","push","shift","sort","splice","unshift"],function(e){var i=Ds[e],a=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var y=this.value();return i.apply(ne(y)?y:[],l)}return this[a](function(w){return i.apply(ne(w)?w:[],l)})}}),fr(ge.prototype,function(e,i){var a=d[i];if(a){var u=a.name+"";Ee.call(Zi,u)||(Zi[u]=[]),Zi[u].push({name:i,func:a})}}),Zi[ro(r,U).name]=[{name:"wrapper",func:r}],ge.prototype.clone=Jd,ge.prototype.reverse=Qd,ge.prototype.value=Yd,d.prototype.at=Sv,d.prototype.chain=Av,d.prototype.commit=Ov,d.prototype.next=$v,d.prototype.plant=Rv,d.prototype.reverse=Tv,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Nv,d.prototype.first=d.prototype.head,On&&(d.prototype[On]=Cv),d},Ji=Od();Le?((Le.exports=Ji)._=Ji,Se._=Ji):ye._=Ji}).call(Jn)})(au,au.exports);var f2=Object.defineProperty,p2=Object.defineProperties,d2=Object.getOwnPropertyDescriptors,Lf=Object.getOwnPropertySymbols,g2=Object.prototype.hasOwnProperty,y2=Object.prototype.propertyIsEnumerable,Bf=(s,t,r)=>t in s?f2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Ao=(s,t)=>{for(var r in t||(t={}))g2.call(t,r)&&Bf(s,r,t[r]);if(Lf)for(var r of Lf(t))y2.call(t,r)&&Bf(s,r,t[r]);return s},v2=(s,t)=>p2(s,d2(t));function si(s,t,r){var n;const o=bb(s);return((n=t.rpcMap)==null?void 0:n[o.reference])||`${l2}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Oi(s){return s.includes(":")?s.split(":")[1]:s}function id(s){return s.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function m2(s,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(s));if(!r.length)return[];const n=[];return r.forEach(o=>{const c=t.namespaces[o].accounts;n.push(...c)}),n}function w2(s={},t={}){const r=Mf(s),n=Mf(t);return au.exports.merge(r,n)}function Mf(s){var t,r,n,o;const c={};if(!Co(s))return c;for(const[h,p]of Object.entries(s)){const f=Zf(h)?[h]:p.chains,g=p.methods||[],v=p.events||[],b=p.rpcMap||{},E=Qn(h);c[E]=v2(Ao(Ao({},c[E]),p),{chains:Ic(f,(t=c[E])==null?void 0:t.chains),methods:Ic(g,(r=c[E])==null?void 0:r.methods),events:Ic(v,(n=c[E])==null?void 0:n.events),rpcMap:Ao(Ao({},b),(o=c[E])==null?void 0:o.rpcMap)})}return c}function b2(s){return s.includes(":")?s.split(":")[2]:s}function _2(s){const t={};for(const[r,n]of Object.entries(s)){const o=n.methods||[],c=n.events||[],h=n.accounts||[],p=Zf(r)?[r]:n.chains?n.chains:id(n.accounts);t[r]={chains:p,methods:o,events:c,accounts:h}}return t}function Uc(s){return typeof s=="number"?s:s.includes("0x")?parseInt(s,16):s.includes(":")?Number(s.split(":")[1]):Number(s)}const nd={},Fe=s=>nd[s],Hc=(s,t)=>{nd[s]=t};class E2{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Oi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}}class I2{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const n=r||si(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=parseInt(Oi(r));t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,n;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const c=parseInt(o,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class P2{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Oi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}}class x2{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Oi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}}class S2{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),o=Oi(r);t[o]=this.createHttpProvider(o,n)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||this.getCardanoRPCUrl(t);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}}class A2{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Oi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}}class O2{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;const o=Oi(r);t[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);return new ai(new oi(n,Fe("disableProviderPing")))}}class $2{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Fe("events"),this.client=Fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const n=r||si(`${this.name}:${t}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,n)}this.events.emit(zr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var n;t[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const n=this.createHttpProvider(t,r);n&&(this.httpProviders[t]=n)}createHttpProvider(t,r){const n=r||si(t,this.namespace);return typeof n>"u"?void 0:new ai(new oi(n,Fe("disableProviderPing")))}}var C2=Object.defineProperty,R2=Object.defineProperties,T2=Object.getOwnPropertyDescriptors,Uf=Object.getOwnPropertySymbols,N2=Object.prototype.hasOwnProperty,F2=Object.prototype.propertyIsEnumerable,Hf=(s,t,r)=>t in s?C2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Oo=(s,t)=>{for(var r in t||(t={}))N2.call(t,r)&&Hf(s,r,t[r]);if(Uf)for(var r of Uf(t))F2.call(t,r)&&Hf(s,r,t[r]);return s},kc=(s,t)=>R2(s,T2(t));class Au{constructor(t){this.events=new fu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Uo(Mo({level:(t==null?void 0:t.logger)||jf})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Au(t);return await r.initialize(),r}async request(t,r){const[n,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Oo({},t),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(t,r,n){const o=new Date().getTime();this.request(t,n).then(c=>r(null,zo(o,c))).catch(c=>r(c,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:at("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(c=>{this.session=c,this.namespaces||(this.namespaces=_2(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==td)throw c;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[n,o]=this.validateChain(t);this.getProvider(n).setDefaultChain(o,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(pn(r)){for(const n of r)t.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await a2.init({logger:this.providerOpts.logger||jf,relayUrl:this.providerOpts.relayUrl||c2,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Qn(r)))];Hc("client",this.client),Hc("events",this.events),Hc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const n=m2(r,this.session),o=id(n),c=w2(this.namespaces,this.optionalNamespaces),h=kc(Oo({},c[r]),{accounts:n,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new I2({namespace:h});break;case"solana":this.rpcProviders[r]=new P2({namespace:h});break;case"cosmos":this.rpcProviders[r]=new x2({namespace:h});break;case"polkadot":this.rpcProviders[r]=new E2({namespace:h});break;case"cip34":this.rpcProviders[r]=new S2({namespace:h});break;case"elrond":this.rpcProviders[r]=new A2({namespace:h});break;case"multiversx":this.rpcProviders[r]=new O2({namespace:h});break;case"near":this.rpcProviders[r]=new $2({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&pn(o)&&this.events.emit("accountsChanged",o.map(b2))}else if(n.name==="chainChanged"){const o=r.chainId,c=r.event.data,h=Qn(o),p=Uc(o)!==Uc(c)?`${h}:${Uc(c)}`:o;this.onChainChanged(p)}else this.events.emit(n.name,n.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var n;const{namespaces:o}=r,c=(n=this.client)==null?void 0:n.session.get(t);this.session=kc(Oo({},c),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",kc(Oo({},at("USER_DISCONNECTED")),{data:t.topic}))}),this.on(zr.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:n,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(t){const[r,n]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(h=>Qn(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const o=Qn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[o].getDefaultChain();return[o,c]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var n;if(!this.namespaces)return;const[o,c]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(c),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${zf}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${zf}/${t}`)}}const D2=Au,q2="wc",j2="ethereum_provider",z2=`${q2}@2:${j2}:`,L2="https://rpc.walletconnect.com/v1/",cu=["eth_sendTransaction","personal_sign"],B2=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],uu=["chainChanged","accountsChanged"],M2=["chainChanged","accountsChanged","message","disconnect","connect"];var U2=Object.defineProperty,H2=Object.defineProperties,k2=Object.getOwnPropertyDescriptors,kf=Object.getOwnPropertySymbols,V2=Object.prototype.hasOwnProperty,K2=Object.prototype.propertyIsEnumerable,Vf=(s,t,r)=>t in s?U2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,Zn=(s,t)=>{for(var r in t||(t={}))V2.call(t,r)&&Vf(s,r,t[r]);if(kf)for(var r of kf(t))K2.call(t,r)&&Vf(s,r,t[r]);return s},Kf=(s,t)=>H2(s,k2(t));function qo(s){return Number(s[0].split(":")[1])}function Vc(s){return`0x${s.toString(16)}`}function G2(s){const{chains:t,optionalChains:r,methods:n,optionalMethods:o,events:c,optionalEvents:h,rpcMap:p}=s;if(!pn(t))throw new Error("Invalid chains");const f={chains:t,methods:n||cu,events:c||uu,rpcMap:Zn({},t.length?{[qo(t)]:p[qo(t)]}:{})},g=c==null?void 0:c.filter(A=>!uu.includes(A)),v=n==null?void 0:n.filter(A=>!cu.includes(A));if(!r&&!h&&!o&&!(g!=null&&g.length)&&!(v!=null&&v.length))return{required:t.length?f:void 0};const b=(g==null?void 0:g.length)&&(v==null?void 0:v.length)||!r,E={chains:[...new Set(b?f.chains.concat(r||[]):r)],methods:[...new Set(f.methods.concat(o!=null&&o.length?o:B2))],events:[...new Set(f.events.concat(h!=null&&h.length?h:M2))],rpcMap:p};return{required:t.length?f:void 0,optional:r.length?E:void 0}}class Ou{constructor(){this.events=new Qt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=z2,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Ou;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:n}=G2(this.rpc);try{const o=await new Promise(async(h,p)=>{var f;this.rpc.showQrModal&&((f=this.modal)==null||f.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),p(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Kf(Zn({namespaces:Zn({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{h(g)}).catch(g=>{p(new Error(g.message))})});if(!o)return;const c=_b(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:Vc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Vc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Kf(Zn({},at("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Vc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,n,o]=t.split(":");return{chainId:`${r}:${n}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,n;const o=(r=t==null?void 0:t.chains)!=null?r:[],c=(n=t==null?void 0:t.optionalChains)!=null?n:[],h=o.concat(c);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const p=o.length?(t==null?void 0:t.methods)||cu:[],f=o.length?(t==null?void 0:t.events)||uu:[],g=(t==null?void 0:t.optionalMethods)||[],v=(t==null?void 0:t.optionalEvents)||[],b=(t==null?void 0:t.rpcMap)||this.buildRpcMap(h,t.projectId),E=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(A=>this.formatChainId(A)),optionalChains:c.map(A=>this.formatChainId(A)),methods:p,events:f,optionalMethods:g,optionalEvents:v,rpcMap:b,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:E,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const n={};return t.forEach(o=>{n[o]=this.getRpcUrl(o,r)}),n}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?qo(this.rpc.chains):qo(this.rpc.optionalChains),this.signer=await D2.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await Eb(()=>import("./index-jqVnxm8M.js").then(o=>o.i),__vite__mapDeps([0,1,2]));r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Zn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:n,rpcMap:o}=t;r&&pn(r)&&(this.rpc.chains=r.map(c=>this.formatChainId(c)),r.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)})),n&&pn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(o==null?void 0:o[c])||this.getRpcUrl(c)}))}getRpcUrl(t,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[t])||`${L2}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const dA=Ou;export{dA as EthereumProvider,M2 as OPTIONAL_EVENTS,B2 as OPTIONAL_METHODS,uu as REQUIRED_EVENTS,cu as REQUIRED_METHODS,Ou as default};
